'use strict';var LTH={CODES:"full serious rot terrain liquid ammo oimo crowd traffic".split(" "),rubriques:[],demoNames:[],libsNames:[],ARCS:{},cRubr:-1,cFile:-1};LTH.ToRad=Math.PI/180;var esprima=esprima||{};esprima.parse=esprima.parse||{};var CodeMirror=CodeMirror||{},GRAD=GRAD||{},history,main;window.onload=init;function init(){main=new LTH.Main}function endTranscode(){main.menu.initHomeland(main.transcode.isWebGl)}
LTH.Main=function(){this.menuSize=60;this.doc=document;this.mainClass=this.doc.body.className="night";this.doc.body.ondragover=function(a){return!1};this.day=!1;this.mode="basic";this.numLesson=4;this.items=[];this.showCode=!1;this.viewType="vertical";this.scriptText=14;this.currentLesson=-1;this.isFirst=!1;this.previewMain=this.previewDoc=this.preview=this.editorFragment=this.editorVertex=this.editor=this.menu=this.transcode=null;this.happ=this.supports_history_api();this.fileSystem=new LTH.FileSystem(this);
this.fileSystem.loadXML("menu.xml")};
LTH.Main.prototype={constructor:LTH.Main,init:function(){this.shader=new LTH.ShaderToy(this);this.editor=new LTH.CodeEditor(this);this.labmenu=new LTH.labsMenu(this);this.menu=new LTH.Menu(this);this.transcode=new LTH.Transcode(this,LTH.CODES,endTranscode,!0);window.onresize=function(a){this.resize(a)}.bind(this)},initHome:function(){console.log("end");this.menu.initHomeland(this.transcode.isWebGl)},switchMode:function(a){a!==this.mode&&("shader"===this.mode&&this.clearShader(),"shader"===a&&this.initShader(),
this.mode=a)},clearShader:function(){this.shader.clear();this.editorVertex.deleteAll();this.editorFragment.deleteAll()},initShader:function(){this.editorVertex=new LTH.CodeEditor(this,"vertex");this.editorFragment=new LTH.CodeEditor(this,"fragment")},supports_history_api:function(){return!(!window.history||!history.pushState)},autoTime:function(){var a=(new Date).getHours();this.day=19<a||6>a?!1:!0},resize:function(){var a=window.innerWidth,b=window.innerHeight,c=this.menuSize,d=Math.floor(0.5*(a-
c)),e=Math.floor(0.5*(b-0)),f=Math.floor((a-c)/3),g=Math.floor(b/3);if(this.showCode){this.editor.content.style.display="block";"shader"===this.mode&&(this.editorVertex.content.style.display="block",this.editorFragment.content.style.display="block");switch(this.viewType){case "vertical":"shader"!==this.mode?this.setStyle(this.editor.content,c,0,d,b):(this.setStyle(this.editor.content,c,0,d,g),this.setStyle(this.editorVertex.content,c,g,d,g),this.setStyle(this.editorFragment.content,c,g+g,d,g));null!==
this.preview&&this.setStyle(this.preview,c+d,0,d,b);break;case "horizon":"shader"!==this.mode?this.setStyle(this.editor.content,c,0,a-c,e):(this.setStyle(this.editor.content,c,0,f,e),this.setStyle(this.editorVertex.content,c+f,0,f,e),this.setStyle(this.editorFragment.content,c+f+f,0,f,e)),null!==this.preview&&this.setStyle(this.preview,c,e,a-c,e)}this.editor.refresh();"shader"===this.mode&&(this.editorVertex.refresh(),this.editorFragment.refresh())}else this.editor.content.style.display="none","shader"===
this.mode&&(this.editorVertex.content.style.display="none",this.editorFragment.content.style.display="none"),null!==this.preview&&this.setStyle(this.preview,c,0,a-c,b)},setTextSize:function(){this.editor.changeFontSize(this.scriptText);"shader"===this.mode&&(this.editorVertex.changeFontSize(this.scriptText),this.editorFragment.changeFontSize(this.scriptText))},setStyle:function(a,b,c,d,e){a.style.left=b+"px";a.style.top=c+"px";a.style.width=d+"px";a.style.height=0==e?"100%":e+"px"},switchStyle:function(){this.day?
(this.editor.changeTheme(0),"shader"===this.mode&&(this.editorVertex.changeTheme(0),this.editorFragment.changeTheme(0))):(this.editor.changeTheme(1),"shader"===this.mode&&(this.editorVertex.changeTheme(1),this.editorFragment.changeTheme(1)));this.previewTheme()},previewTheme:function(){this.previewDoc.body&&(this.previewDoc.body.className=this.mainClass);this.previewMain&&this.previewMain.v&&(this.day?this.previewMain.v.colorBack(13815496):this.previewMain.v.colorBack(2435374));this.preview.style.display=
"block"},previewClearFocus:function(){for(var a=this.previewDoc.getElementsByTagName("*"),b=0,c;c=a[b++];)c.id&&c.blur()},clearPreview:function(){null!==this.preview&&(this.previewDoc.open("text/html","replace"),this.previewDoc.write(""),this.previewDoc.close(),this.doc.getElementById("preview").setAttribute("src",""),this.doc.body.removeChild(this.preview),this.preview=this.previewMain=this.previewDoc=null,console.clear())},initPreview:function(){this.preview=this.doc.createElement("iframe");this.preview.className=
"preview";this.preview.src="about:blank";this.preview.id="preview";this.doc.body.appendChild(this.preview)},update:function(a){if(""!==a){this.clearPreview();this.initPreview();var b,c,d;if(this.transcode.useTrans){b="";c=LTH.libsNames[LTH.cRubr][LTH.cFile];for(d=c.length;d--;)""!==c[d]&&(b+="<script src='"+this.transcode.codes[c[d]]+"'>\x3c/script>");a=["<!DOCTYPE html>\n<html lang='en'><head>\n<title>prev</title>\n<meta charset='utf-8'>\n<link rel='stylesheet' href='css/consolas.css'>\n<link rel='stylesheet' href='css/basic.css'>",
"<script src='"+this.transcode.codes.full+"'>\x3c/script>",b,"<script src='build/v3d.min.js'>\x3c/script>","</head><body class='"+this.mainClass+"'>","<script>\nvar canvas = document.createElement('canvas'); document.body.appendChild( canvas );\nvar info = document.createElement('div'); document.body.appendChild( info ); info.className = 'info';\nvar debug = document.createElement('div'); document.body.appendChild( debug ); debug.className = 'debug';\nvar loader = document.createElement('div'); document.body.appendChild( loader ); loader.className = 'loader';",
a,"\x3c/script>\n</body></html>"].join("\n")}else{b="";c=LTH.libsNames[LTH.cRubr][LTH.cFile];for(d=c.length;d--;)""!==c[d]&&(b+="<script src='js/libs/"+c[d]+".min.js'>\x3c/script>");a=["<!DOCTYPE html>\n<html lang='en'>\n<head>\n<title>prev</title>\n<meta charset='utf-8'>\n<link rel='stylesheet' href='css/consolas.css'>\n<link rel='stylesheet' href='css/basic.css'>\n<script src='js/libs/three.min.js'>\x3c/script>\n<script src='js/libs/three.post.js'>\x3c/script>\n<script src='js/libs/sea3d.min.js'>\x3c/script>\n<script src='js/libs/tween.min.js'>\x3c/script>\n<script src='js/libs/gui.min.js'>\x3c/script>",
b,"<script src='build/v3d.min.js'>\x3c/script>","</head><body class='"+this.mainClass+"'>","<script>\nvar canvas = document.createElement('canvas'); document.body.appendChild( canvas );\nvar info = document.createElement('div'); document.body.appendChild( info ); info.className = 'info';\nvar debug = document.createElement('div'); document.body.appendChild( debug ); debug.className = 'debug';\nvar loader = document.createElement('div'); document.body.appendChild( loader ); loader.className = 'loader';",
a,"\x3c/script>\n</body></html>"].join("\n")}this.previewDoc=this.preview.contentDocument||this.preview.contentWindow.document;this.previewMain=this.preview.contentWindow;this.previewDoc.open("text/html","replace");this.previewDoc.write(a);this.previewDoc.close();this.resize();this.isFirst?this.isFirst=!1:this.menu.modified()}},checkCurrent:function(){for(var a=0;a<this.numLesson;a++)this.items[a].style.background=this.items[a].name==this.currentLesson?"#881288":"#121212"},loadFile:function(a){this.isFirst=
!0;this.fileSystem.load(a)},openFile:function(a){this.fileSystem.open(a)},createLink:function(a,b,c){this.menu.addIconLink(a,b,c)},callSave:function(){this.fileSystem.save()},blur:function(){console.log("blur call !!!");this.editor.blur()}};
LTH.Logos=function(a,b){var c="<path id='Symbole_1_0_Layer0_1_1_STROKES' stroke='#"+a+"' stroke-width='3' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 19.85 53.5 Q 19.85 54.95 18.8 56 17.75 57.05 16.3 57.05 14.85 57.05 13.8 56 12.75 54.95 12.75 53.5 12.75 52.05 13.8 51 14.85 49.95 16.3 49.95 17.75 49.95 18.8 51 19.85 52.05 19.85 53.5 Z'/></defs>";b&&(c="<path id='Symbole_1_0_Layer0_1_1_STROKES' stroke='#"+a+"' stroke-width='3' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 11.5 55.8L 21.55 55.8'/></defs>");
return["<svg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' preserveAspectRatio='none' x='0px' y='0px' width='128px' height='128px' viewBox='0 0 128 128'><defs><g id='copie_Symbole_1_0_Layer0_0_FILL'>","<path fill='#"+a+"' fill-opacity='0.3' stroke='none' d='M 23 37 L 19 37 Q 19 44.9 13.4 50.4 9.6001953125 54.26875 4.65 55.45 L 6.3 62.05 Q 10.253515625 60.838671875 13.55 57.95 12.75 56.9921875 12.75 55.7 12.75 54.25 13.8 53.2 14.85 52.15 16.3 52.15 17.3998046875 52.15 18.25 52.75 23 46.0076171875 23 37 M 7.05 44.05 Q 10 41.15 10 37 10 32.85 7.05 29.9 4.15 27 0 27 L 0 47 Q 1.2853515625 47 2.45 46.7 5.0482421875 46.086328125 7.05 44.05 M 0 0 L 0 10 Q 11.2 10 19.05 17.85 25.74296875 24.54296875 26.8 33.55 27 35.2291015625 27 37 27 43.170703125 24.55 48.3 27.7384765625 51.3177734375 27.2 54.05 26.15 58.85 23.6 60.65 18.55 64.05 16.25 70.75 13.5755859375 77.8880859375 16.05 83.6 18.7349609375 79.5951171875 20.85 73.95 23.15 67.25 28.2 63.85 30.75 62.05 31.8 57.25 34.75 42.3 31.85 27 31.8 26.85 31.8 26.75 30.75 16 22.25 7.9 13.65 -0.35 0 0 Z'/></g>",
"<path id='Symbole_1_0_Layer0_0_1_STROKES' stroke='#"+a+"' stroke-width='3' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 0 93.75 Q 13.6 93.3 20.85 73.95 23.15 67.25 28.2 63.85 30.75 62.05 31.8 57.25 34.75 42.3 31.85 27 31.8 26.85 31.8 26.75 30.75 16 22.25 7.9 13.65 -0.35 0 0 M 38.65 29.45 Q 40.7 42.6 38.65 55.65 M 43.8 52.25 Q 44.95 42.55 43.8 32.85 46.95 42.55 43.8 52.25 Z M 33.45 27 Q 36.4 42.2 33.45 57.35'/>",c,"<g transform='matrix( 1, 0, 0, 1, 64,63.1) '><g transform='matrix( -1, 0, 0, 1, 0,-46.85) '><g transform='matrix( 1, 0, 0, 1, 0,0) '><use xlink:href='#copie_Symbole_1_0_Layer0_0_FILL'/></g></g>\n<g transform='matrix( 1, 0, 0, 1, 0,-46.85) '><g transform='matrix( 1, 0, 0, 1, 0,0) '><use xlink:href='#copie_Symbole_1_0_Layer0_0_FILL'/></g></g>\n<g transform='matrix( 1, 0, 0, 1, 0,-46.85) '><g transform='matrix( 1, 0, 0, 1, 0,0) '><use xlink:href='#Symbole_1_0_Layer0_0_1_STROKES'/></g>\n<g transform='matrix( 1, 0, 0, 1, 0,2.2) '><use xlink:href='#Symbole_1_0_Layer0_1_1_STROKES'/></g></g>\n<g transform='matrix( -1, 0, 0, 1, 0,-46.85) '><g transform='matrix( 1, 0, 0, 1, 0,0) '><use xlink:href='#Symbole_1_0_Layer0_0_1_STROKES'/></g>\n<g transform='matrix( 1, 0, 0, 1, 0,2.2) '><use xlink:href='#Symbole_1_0_Layer0_1_1_STROKES'/></g></g>\n</g></svg>"].join("\n")};
LTH.IconMini=function(a,b){var c=["<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' preserveAspectRatio='none' x='0px' y='0px' width='36px' height='36px' viewBox='0 0 512 512' style='enable-background:new 0 0 36 36;'>"];switch(b){case 0:c[1]="<path fill='#"+a+"' id='twitter' d='M256,50C142.229,50,50,142.229,50,256s92.229,206,206,206s206-92.229,206-206S369.771,50,256,50z M359.599,220.506c3.021,67.199-47.096,142.124-135.802,142.124c-26.981,0-52.096-7.911-73.238-21.466 c25.347,2.987,50.646-4.044,70.734-19.786c-20.907-0.386-38.554-14.198-44.632-33.181c7.486,1.432,14.851,1.013,21.575-0.816 c-22.976-4.617-38.839-25.317-38.321-47.453c6.44,3.58,13.81,5.729,21.642,5.977c-21.278-14.221-27.303-42.318-14.785-63.789 c23.563,28.906,58.77,47.928,98.478,49.92c-6.969-29.886,15.702-58.667,46.542-58.667c13.742,0,26.16,5.802,34.874,15.088 c10.884-2.143,21.108-6.119,30.341-11.594c-3.567,11.157-11.144,20.521-21.008,26.433c9.665-1.153,18.874-3.722,27.441-7.523 C377.035,205.355,368.935,213.771,359.599,220.506z'/></svg>";
break;case 1:c[1]="<path fill='#"+a+"' id='github' d='M256,55.083c-113.764,0-206,92.237-206,206 c0,91.013,59.025,168.246,140.887,195.472c10.293,1.911,13.613-4.459,13.613-9.908v-38.356C147.199,420.764,135.262,384,135.262,384 c-9.354-23.822-22.865-30.159-22.865-30.159c-18.693-12.774,1.408-12.523,1.408-12.523c20.688,1.459,31.584,21.24,31.584,21.24 c18.373,31.483,48.18,22.381,59.949,17.117c1.844-13.312,7.174-22.397,13.076-27.544c-45.768-5.197-93.848-22.867-93.848-101.81 c0-22.498,8.047-40.872,21.225-55.289c-2.146-5.197-9.188-26.152,1.979-54.518c0,0,17.301-5.532,56.662,21.123 c16.445-4.56,34.066-6.856,51.568-6.94c17.502,0.084,35.154,2.381,51.6,6.94c39.33-26.655,56.596-21.123,56.596-21.123 c11.217,28.365,4.158,49.32,2.029,54.518c13.211,14.417,21.207,32.791,21.207,55.289c0,79.127-48.197,96.545-94.064,101.642 c7.375,6.388,14.133,18.943,14.133,38.155c0,27.561,0,49.757,0,56.529c0,5.482,3.301,11.903,13.746,9.892 C403.057,429.264,462,352.08,462,261.084C462,147.321,369.762,55.083,256,55.083z'/></svg>";
break;case 4:c[1]="<path fill='#"+a+"' id='facebook' d='M256.417,50c-113.771,0-206,92.229-206,206s92.229,206,206,206s206-92.229,206-206 S370.188,50,256.417,50z M317.385,171.192c0,0-20.604,0-28.789,0c-10.162,0-12.28,4.163-12.28,14.678c0,8.75,0,25.404,0,25.404 h41.069l-3.951,44.596h-37.118v133.227h-53.2V256.435h-27.666v-45.16h27.666c0,0,0-6.493,0-35.565 c0-33.379,17.849-50.807,57.437-50.807c6.484,0,36.833,0,36.833,0V171.192z'/></svg>";break;case 2:c[1]="<path fill='#"+a+"' id='googleplus' d='M273.369,331.659c0,20.247-16.443,36.065-50.481,36.065c-26.625,0-45.852-16.854-45.852-37.1 c0-19.84,22.562-36.957,49.186-36.664C255.762,293.961,273.369,312.358,273.369,331.659z M462.417,257c0,113.771-92.229,206-206,206 s-206-92.229-206-206s92.229-206,206-206S462.417,143.229,462.417,257z M296.303,329.305c0-18.691-6.979-30.903-28.096-46.725 c-21.417-15.619-26.65-24.443-6.208-40.248c11.519-8.906,19.591-20.778,19.591-35.436c0-15.969-6.53-30.457-18.809-37.492h17.404 l14.816-15.551c0,0-55.854,0-66.303,0c-41.39,0-61.685,24.809-61.685,52.098c0,27.889,19.132,49.854,56.492,49.854 c-5.792,11.693-3.466,22.494,6.011,30.217c-63.807,0-77.461,27.998-77.461,49.566c0,27.945,32.123,44.559,70.643,44.559 C275.367,380.146,296.303,352.234,296.303,329.305z M382.776,187.5h-30.589v-30.588h-15.293V187.5h-30.589v15.294h30.589v30.588 h15.293v-30.588h30.589V187.5z M254.949,207.894c-3.083-23.466-18.371-42.719-36.234-43.256 c-17.869-0.532-29.854,17.427-26.767,40.899c3.085,23.467,20.067,39.859,37.939,40.398 C247.75,246.467,258.031,231.363,254.949,207.894z'/></svg>";
break;case 3:c[1]="<path fill='#"+a+"' id='linkedin' d='M256.417,50c-113.771,0-206,92.229-206,206s92.229,206,206,206s206-92.229,206-206 S370.188,50,256.417,50z M201.456,355.592h-45.229V209.469h45.229V355.592z M178.626,190.333c-14.771,0-26.746-12.072-26.746-26.963 s11.975-26.963,26.746-26.963c14.77,0,26.745,12.072,26.745,26.963S193.396,190.333,178.626,190.333z M370.953,355.592h-45.01 c0,0,0-55.666,0-76.703s-7.991-32.781-24.626-32.781c-18.103,0-27.562,12.231-27.562,32.781c0,22.504,0,76.703,0,76.703h-43.38 V209.469h43.38v19.679c0,0,13.047-24.137,44.032-24.137c30.986,0,53.165,18.918,53.165,58.058 C370.953,302.209,370.953,355.592,370.953,355.592z'/></svg>"}return c.join("\n")};LTH.labsMenu=function(a){this.main=a;this.baseColor="d2cec8";this.topColor="25292e";this.current=null;this.size=800;this.decal=1;this.rdecal=-30;this.center=0.5*this.size;this.radius=10;this.endRadius=110;this.line=1;this.content=document.createElement("div");this.content.className="labsMenu";this.pins=[];this.angles=[];this.anglesEnd=[];this.anglesStart=[];this.colors=[];this.nDemos=[];this.demosNames=[];this.demosIcones=[];this.rubNames=[];this.points=[];this.nRubriques=0;this.isComputed=!1;this.arcs=
LTH.ARCS};
LTH.labsMenu.prototype={constructor:LTH.labsMenu,init:function(){this.title=document.createElement("div");this.title.className="labsTitle";this.content.appendChild(this.title);this.title.style.color="#"+this.topColor;this.subTitle=document.createElement("div");this.subTitle.className="labsSubTitle";this.content.appendChild(this.subTitle);this.subTitle.style.color="#"+this.baseColor;this.canvas=document.createElement("canvas");this.canvas.className="labsCanvas";this.content.appendChild(this.canvas);this.pinsContent=
document.createElement("div");this.pinsContent.className="pinsContent";this.content.appendChild(this.pinsContent);this.ctx=this.canvas.getContext("2d");this.canvas.width=this.canvas.height=this.size;this.isComputed||this.compute();this.radius=this.time=10;this.line=1;this.update()},reset:function(){},update:function(){this.radius==this.endRadius?(clearTimeout(this.anim),this.activeMouse(),this.draw(!0)):(this.draw(),this.time-=0.2,this.anim=setTimeout(function(a){this.update()}.bind(this),this.time));
this.radius++;this.line+=0.2},activeMouse:function(){this.content.onmousemove=function(a){this.mouseMove(a)}.bind(this)},mouseMove:function(a){var b=a.clientX-0.5*window.innerWidth;a=a.clientY-0.5*window.innerHeight;var c=Math.atan2(b,-a),c=Math.round(180/Math.PI*c);0>c&&(c+=360);c+=this.rdecal;Math.round(Math.sqrt(b*b+a*a))>this.radius-50?(this.findRubrique(c),null!==this.current&&(this.title.style.background=this.arcs[this.current].color,this.title.innerHTML=this.current.replace("-"," ").toUpperCase())):
(this.current=null,this.title.style.background="#"+this.topColor,this.subTitle.innerHTML="")},findRubrique:function(a){for(var b=this.nRubriques;b--;)a<this.anglesEnd[b]&&a>this.anglesStart[b]&&(this.current=this.rubNames[b])},compute:function(){var a=0,b,c=0,d;for(d in this.arcs)b=this.arcs[d],this.colors[a]=b.color,this.demosNames[a]=b.demos,this.demosIcones[a]=b.icon,this.nDemos[a]=b.demos.length,c+=this.nDemos[a],a++;b=360/c;var e=c=0,a=0;for(d in this.arcs){c=this.nDemos[a]*b;this.rubNames[a]=
d;this.anglesStart[a]=e+this.decal+this.rdecal;this.anglesEnd[a]=e+c-this.decal+this.rdecal;var f=this.anglesStart[a]+0.5*(this.anglesEnd[a]-this.anglesStart[a])-60;this.angles[a]=f;this.points[a]=this.findPoint(f);e+=c;a++}this.nRubriques=a;this.isComputed=!0},findPoint:function(a){var b=a*LTH.ToRad,c=(a+13)*LTH.ToRad;a=(a-13)*LTH.ToRad;for(var d,e=90,f=this.endRadius,g=[],h=0;13>h;h++)0==h?d=this.radialPos(b,f+25):1==h?d=this.radialPos(b,f+70):1==(h&1)?(d=this.radialPos(a,f+e),e+=45):d=this.radialPos(c,
f+e),g.push(d);return g},radialPos:function(a,b){return{x:Math.cos(a)*b+this.center,y:Math.sin(a)*b+this.center}},draw:function(a){this.ctx.clearRect(0,0,this.size,this.size);for(var b=this.nRubriques;b--;)this.ctx.strokeStyle=this.colors[b],this.ctx.beginPath(),this.ctx.arc(this.center,this.center,this.radius,(this.anglesStart[b]-60)*LTH.ToRad,(this.anglesEnd[b]-60)*LTH.ToRad,!1),this.ctx.lineWidth=this.line,this.ctx.stroke();a&&this.placesPins()},placesPins:function(){this.prevPins=[];this.startPins=
0;this.endPins=13;this.time=100;this.anim=setTimeout(function(a){this.updatePins()}.bind(this),this.time)},updatePins:function(){var a=this.nRubriques,b,c,d;if(this.startPins==this.endPins)clearTimeout(this.anim);else{for(b=this.prevPins.length;b--;)this.prevPins[b].style.display="block";for(b=this.pins.length;b--;)this.pins[b].className="pins pinson",this.prevPins[b]=this.pins[b].childNodes[0];for(;a--;)b=this.points[a],c=this.nDemos[a],d=this.colors[a],this.startPins<c&&(this.liner(b,d,this.startPins),
this.addPins(b[this.startPins+1].x,b[this.startPins+1].y,d,this.startPins,a));this.startPins++;this.anim=setTimeout(function(a){this.updatePins()}.bind(this),this.time)}},liner:function(a,b,c){var d,e;switch(c){case 0:d=a[0];e=a[1];break;case 1:d=a[1];e=a[2];break;case 2:d=a[1];e=a[3];break;case 3:d=a[2];e=a[4];break;case 4:d=a[3];e=a[5];break;case 5:d=a[4];e=a[6];break;case 6:d=a[5];e=a[7];break;case 7:d=a[6];e=a[8];break;case 8:d=a[7];e=a[9];break;case 9:d=a[8];e=a[10];break;case 10:d=a[9];e=a[12];
break;case 11:d=a[10],e=a[13]}this.ctx.strokeStyle=b;this.ctx.beginPath();this.ctx.moveTo(d.x,d.y);this.ctx.lineTo(e.x,e.y);this.ctx.lineWidth=2;this.ctx.stroke()},addPins:function(a,b,c,d,e){var f=this.pins.length,g=document.createElement("div");g.className="pins";g.style.left=a+"px";g.style.top=b+"px";g.style.background=c;g.name=e+"_"+d;a=document.createElement("div");a.className="pinsin";a.innerHTML=LTH.IconMicro(this.topColor,this.demosIcones[e][d]);g.appendChild(a);this.pins[f]=g;this.pins[f].onclick=
function(a){var b=1*a.target.name.substring(0,1);a=1*a.target.name.substring(2,a.target.name.length);this.main.menu.resetHome(b,a)}.bind(this);this.pins[f].onmouseover=function(a){a.target.style.background="#"+this.baseColor;var b=1*a.target.name.substring(0,1);a=1*a.target.name.substring(2,a.target.name.length);this.subTitle.innerHTML=this.demosNames[b][a].replace("_"," ").toUpperCase()}.bind(this);this.pins[f].onmouseout=function(a){a.target.style.background=c;this.subTitle.innerHTML=""}.bind(this);
this.pinsContent.appendChild(this.pins[f])}};
LTH.IconMicro=function(a,b){var c=["<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' preserveAspectRatio='none' x='0px' y='0px' width='30px' height='30px' viewBox='0 0 30 30';'><g id='Layer'>"];switch(b){case 0:c[1]="<path fill='#"+a+"' d='M 16 11 L 14 11 14 14 11 14 11 16 14 16 14 19 16 19 16 16 19 16 19 14 16 14 16 11 Z'/>";break;case 1:c[1]="<path fill='#"+a+"' d='M 26 16 L 26 14 22 14 22 10 20 8 16 8 16 4 14 4 14 8 10 8 8 10 8 14 4 14 4 16 8 16 8 20 10 22 14 22 14 26 16 26 16 22 20 22 22 20 22 16 26 16 M 19 10 L 20 11 20 19 19 20 11 20 10 19 10 11 11 10 19 10 Z'/>";break;
case 2:c[1]="<path fill='#"+a+"' d='M 23 20 L 22 20 22 12 19 12 19 10 18 10 18 12 16 12 16 19 18 19 18 14 20 14 20 22 23 22 23 20 M 7 22 L 10 22 10 10 12 10 12 19 14 19 14 8 8 8 8 20 7 20 7 22 Z'/>";break;case 3:c[1]="<path fill='#"+a+"' d='M 21 8 L 21 10 19 12 18 11 12 11 11 12 9 10 9 8 10 7 9 6 6 9 6 13 8 15 7 16 7 20 8 21 14 21 14 24 16 24 16 21 22 21 23 20 23 16 22 15 24 13 24 9 21 6 20 7 21 8 M 23 10 L 23 12 21 14 20 13 22 11 22 9 23 10 M 21 17 L 21 19 9 19 9 17 13 13 17 13 21 17 M 8 9 L 8 11 10 13 9 14 7 12 7 10 8 9 Z'/>";
break;case 4:c[1]="<path fill='#"+a+"' d='M 26 16 L 26 14 16 4 14 4 4 14 4 16 14 26 16 26 26 16 M 6 15 L 15 6 24 15 15 24 6 15 M 16 10 L 14 10 14 16 16 16 16 10 M 16 18 L 14 18 14 20 16 20 16 18 Z'/>";break;case 5:c[1]="<path fill='#"+a+"' d='M 21.35 21.35 Q 24 18.75 24 15 24 11.25 21.35 8.6 18.75 6 15 6 11.25 6 8.6 8.6 6 11.25 6 15 6 18.75 8.6 21.35 11.25 24 15 24 18.75 24 21.35 21.35 M 14.95 7.95 Q 17.9 7.95 19.9 10 21.95 12.05 21.95 14.95 21.95 17.9 19.9 19.9 17.9 21.95 14.95 21.95 12.05 21.95 10 19.9 7.95 17.9 7.95 14.95 7.95 12.05 10 10 12.05 7.95 14.95 7.95 M 20 17 Q 20 15.75 19.1 14.85 18.25 14 17 14 15.75 14 14.85 14.85 14 15.75 14 17 14 18.25 14.85 19.1 15.75 20 17 20 18.25 20 19.1 19.1 20 18.25 20 17 M 17 16 Q 17.4 16 17.7 16.3 18 16.6 18 17 18 17.4 17.7 17.7 17.4 18 17 18 16.6 18 16.3 17.7 16 17.4 16 17 16 16.6 16.3 16.3 16.6 16 17 16 Z'/>";
break;case 6:c[1]="<path fill='#"+a+"' d='M 25 8.5 L 20.7 4.05 6 9 4 10 4 18 6 22 10 26 25 20 25 8.5 M 8.4 10.35 L 19.8 6.45 22.6 9.05 10.6 12.7 8.4 10.35 M 6 11.7 L 7 11 10 14 10 23 7.75 20.8 6 17 6 11.7 M 23 10 L 23 18.4 11 23 11 13.65 23 10 M 21.6 17.8 L 21.6 11.75 12.5 14.65 12.5 21.2 21.6 17.8 M 20.75 13.05 L 20.75 16.95 13.6 19.65 13.6 15.3 20.75 13.05 Z'/>";break;case 7:c[1]="<path fill='#"+a+"' d='M 20.25 12.7 Q 21.05 13.45 21.35 13.85 21.75 14.4 22.05 15.25 22.35 16.1 21.95 16.3 21.7 16.45 20.8 16.25 L 21.4 18.1 20.85 18.75 Q 21.15 19.8 21 20.15 20.9 20.45 20.2 20.75 19.05 21.1 16.4 19.35 L 14.4 22.8 15.5 24.25 17.3 21.4 Q 19.95 22.65 21.2 22.2 22.85 21.55 22.2 19.35 L 22.75 18.85 22.5 17.5 Q 23.5 17.75 23.85 17.2 24.15 16.75 23.85 15.7 23.05 13.35 22 12.35 21.95 8.9 19.85 6.75 17.8 4.6 14.9 4.8 10 5.15 8.8 9.6 7.630078125 13.894921875 11.75 18.65 L 10 21.6 12.1 21.8 13.95 18.5 Q 11.85 16.15 11.05 14.35 10.15 12.4 10.45 10.6 10.7 9.2 11.5 8.2 12.35 7.05 13.55 6.8 15.55 6.4 16.6 6.7 17.15 6.8 18.3 7.6 20.25 8.9 20.25 12.7 Z'/>";
break;case 8:c[1]="<path fill='#"+a+"' d='M 16 11 L 14 11 14 14 11 14 11 16 14 16 14 19 16 19 16 16 19 16 19 14 16 14 16 11 Z'/>"}c[2]="<use xlink:href='#Layer'/></g></svg>";return c.join("\n")};LTH.logoTimer=null;
LTH.Menu=function(a){this.baseColor="d2cec8";this.baseColorOver="FF0073";this.main=a;this.doc=document;this.content=this.doc.createElement("div");this.content.className="menu";this.doc.body.appendChild(this.content);this.rubriques=[];this.icons=[];this.files=[];this.buttons=[];this.inModif=-1;this.colorSelect="#d2cec8";this.colorModif="#FF0073";this.colorOver="rgba(255,255,255,0.3)";this.logo=this.zone=this.currentLink=null;this.isHome=this.isMenu=!1;this.topColor=this.leftMenu=this.home=null;this.initLogo();
var b=this;this.main.happ&&window.addEventListener("popstate",function(a){b.isHome?history.back():b.initHome(a)})};
LTH.Menu.prototype={constructor:LTH.Menu,initLogo:function(){this.content.appendChild(this.main.labmenu.content);this.logo=this.doc.createElement("div");this.logo.className="logo";this.content.appendChild(this.logo);this.logo.innerHTML=LTH.Logos(this.baseColor);this.title=this.doc.createElement("div");this.title.className="title";this.content.appendChild(this.title);this.title.innerHTML="WELCOME<br>LOADING CODES";this.miniLogos()},initHomeland:function(a){a?(this.initHome(),this.title.innerHTML="LOTH LABS",
this.title.style.height="20px",this.title.style.marginTop="-66px",this.logo.onmousedown=function(a){this.initHome(a)}.bind(this),this.logo.onmouseover=function(a){this.isHome||(this.title.innerHTML="BACK HOME")}.bind(this),this.logo.onmouseout=function(a){this.isHome||(this.title.innerHTML=LTH.rubriques[LTH.cRubr].toUpperCase())}.bind(this)):this.title.innerHTML="SORRY, YOU NEED<br>WEBGL BROWSER"},miniLogos:function(){this.micrologo=this.doc.createElement("div");this.micrologo.className="minilogoOut";
this.content.appendChild(this.micrologo);this.iconsOut=[];for(var a=4;a--;){this.iconsOut[a]=this.doc.createElement("div");this.iconsOut[a].className="mmmlogo";this.iconsOut[a].name=a;var b=document.createElement("div");b.style.cssText="position:relative; left:0px; top:0px; width:36px; height:36px; pointer-events:none;";this.iconsOut[a].appendChild(b);b.innerHTML=LTH.IconMini(this.baseColor,a);this.iconsOut[a].onclick=function(a){this.openLink(a.target.name)}.bind(this);this.iconsOut[a].onmouseover=
function(a){this.iconsOut[a.target.name].childNodes[0].innerHTML=LTH.IconMini(this.baseColorOver,a.target.name)}.bind(this);this.iconsOut[a].onmouseout=function(a){this.iconsOut[a.target.name].childNodes[0].innerHTML=LTH.IconMini(this.baseColor,a.target.name)}.bind(this);this.micrologo.appendChild(this.iconsOut[a])}},redrawMini:function(){for(var a=4;a--;)this.iconsOut[a].childNodes[0].innerHTML=LTH.IconMini(this.baseColor,a)},openLink:function(a){var b;switch(a){case 0:b="https://twitter.com/3dflashlo";
break;case 1:b="https://github.com/lo-th";break;case 2:b="https://plus.google.com/u/0/114170447432405103307";break;case 3:b="https://www.linkedin.com/pub/lo-th/27/202/b3/en";break;case 4:b="https://www.facebook.com/laurent.thillet"}window.open(b,"_blank").focus()},stopBlink:function(){clearTimeout(LTH.logoTimer);this.logo.innerHTML=LTH.Logos(this.baseColor)},blinkOpen:function(a){a.logo.innerHTML=LTH.Logos(a.baseColor,!1);LTH.logoTimer=setTimeout(a.blinkClose,3E3,a)},blinkClose:function(a){a.logo.innerHTML=
LTH.Logos(a.baseColor,!0);LTH.logoTimer=setTimeout(a.blinkOpen,150,a)},initHome:function(){this.doc.body.onmousemove=function(a){return!1};this.logo.className="logo";this.content.className="menu home";this.title.style.top="50%";this.blinkOpen(this);this.micrologo.style.display="block";this.main.shader.clear();this.isMenu&&this.resetMenu();this.isHome||(LTH.cRubr=-1,LTH.cFile=-1,this.title.innerHTML="LOTH LABS",this.main.labmenu.init(),this.isHome=!0)},resetHome:function(a,b){this.stopBlink();this.micrologo.style.display=
"none";LTH.cRubr=a;LTH.cFile=b;this.clearDiv(this.main.labmenu.content);this.isHome=!1;this.initMenu();this.main.happ&&history.pushState(null,null,"index.html")},resetMenu:function(){this.main.editor.clear();"shader"===this.main.mode&&(this.main.editorVertex.clear(),this.main.editorFragment.clear());this.main.clearPreview();this.clearDiv(this.zone);this.clearDiv(this.leftMenu);this.content.removeChild(this.leftMenu);this.content.removeChild(this.zone);this.content.removeChild(this.topColor);this.icons=
[];this.files=[];this.buttons=[];this.isMenu=!1},initMenu:function(){this.doc.body.onmousemove=function(a){this.showHideMenu(a)}.bind(this);this.content.className="menu exemple";this.logo.className="logo lmin";var a="basic";"shaders"===LTH.rubriques[LTH.cRubr]&&(a="shader");this.main.switchMode(a);this.main.resize();this.title.innerHTML="";this.title.style.top="200px";this.initButton();this.initZone();for(var b=LTH.demoNames[LTH.cRubr],c=b.length,d=0;d<c;d++)a=b[d]+".js",this.pushFile(a);this.main.loadFile("demos/"+
LTH.rubriques[LTH.cRubr]+"/"+this.files[LTH.cFile]);this.resetIcon();this.isMenu=!0},clearDiv:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},initZone:function(){this.zone=this.doc.createElement("div");this.zone.className="zone";this.content.appendChild(this.zone);var a=this;this.zone.ondragover=function(b){a.zoneDragOver(b)};this.zone.ondragend=function(b){a.zoneDragEnd(b)};this.zone.ondrop=function(b){a.zoneDrop(b)}},initButton:function(){this.topColor=this.doc.createElement("div");
this.topColor.className="topColor";this.topColor.style.background=this.main.labmenu.colors[LTH.cRubr];this.content.appendChild(this.topColor);this.leftMenu=this.doc.createElement("div");this.leftMenu.className="bottomLeftMenu";this.content.appendChild(this.leftMenu);for(var a,b=0;5>b;b++)a=this.doc.createElement("div"),a.className="b",1<b&&(a.style.display="none"),this.leftMenu.appendChild(a),this.buttons[b]=a;this.buttons[0].innerHTML="N";this.buttons[1].innerHTML="C";this.buttons[2].innerHTML="V";
this.buttons[3].innerHTML="+";this.buttons[4].innerHTML="-";var c=this;this.buttons[0].onclick=function(){c.dayNight()};this.buttons[1].onclick=function(){c.showCode()};this.buttons[2].onclick=function(){c.verticlaHorizon()};this.buttons[3].onclick=function(){c.textPlus()};this.buttons[4].onclick=function(){c.textMoin()}},showCode:function(){this.main.showCode?(this.main.showCode=!1,this.buttons[1].style.textDecoration="none",this.buttons[2].style.display="none",this.buttons[3].style.display="none",
this.buttons[4].style.display="none"):(this.main.showCode=!0,this.buttons[1].style.textDecoration="line-through",this.buttons[2].style.display="inline-block",this.buttons[3].style.display="inline-block",this.buttons[4].style.display="inline-block");this.main.resize()},dayNight:function(){this.main.day?(this.isNight(),this.buttons[0].innerHTML="N"):(this.isDay(),this.buttons[0].innerHTML="D");this.resetIcon(!0);this.main.switchStyle();this.redrawMini()},verticlaHorizon:function(){"vertical"==this.main.viewType?
(this.main.viewType="horizon",this.buttons[2].innerHTML="H"):(this.main.viewType="vertical",this.buttons[2].innerHTML="V");this.main.resize()},textPlus:function(){this.main.scriptText++;this.main.setTextSize()},textMoin:function(){this.main.scriptText--;this.main.setTextSize()},isDay:function(){this.baseColor="25292e";this.main.labmenu.baseColor="25292e";this.main.labmenu.topColor="d2cec8";this.logo.innerHTML=LTH.Logos(this.baseColor);this.main.day=!0;this.main.mainClass="day";this.doc.body.className=
"day";this.colorSelect="#25292e";this.colorOver="rgba(0,0,0,0.3)"},isNight:function(){this.baseColor="d2cec8";this.main.labmenu.baseColor="d2cec8";this.main.labmenu.topColor="25292e";this.logo.innerHTML=LTH.Logos(this.baseColor);this.main.day=!1;this.main.mainClass="night";this.doc.body.className="night";this.colorSelect="#d2cec8";this.colorOver="rgba(255,255,255,0.3)"},zoneDragOver:function(){this.zone.classList.add("hover");return!1},zoneDragEnd:function(){this.zone.classList.remove("hover");return!1},
zoneDrop:function(a){this.zone.classList.remove("hover");a.preventDefault();var b;if(a.dataTransfer.items)for(b=a.dataTransfer.items.length;b--;){var c=a.dataTransfer.items[b].webkitGetAsEntry();c.isFile?this.addFile(a.dataTransfer.items[b].getAsFile()):c.isDirectory&&console.log("dir",a.dataTransfer.items[b].getAsFile(),c.fullPath)}else for(b=a.dataTransfer.files.length;b--;)this.addFile(a.dataTransfer.files[b])},addFile:function(a){var b=this,c=new FileReader;c.onload=function(c){c=a.name;c.substr(c.lastIndexOf(".")+
1,c.length);b.pushFile(c)};c.readAsDataURL(a)},pushFile:function(a){for(var b=this.files.length;b--;)if(a==this.files[b])return;var b=this.icons.length,c=document.createElement("div");c.className="ic";var d=document.createElement("div");d.style.cssText="position:relative; left:10px; top:5px; width:18px; height:18px; pointer-events:none; background-color: none; border:2px solid rgba(0,0,0,0);  border-radius:20px; pointer-events:none;";var e=document.createElement("div");e.style.cssText="position:relative; left:5px; top:-12px; width:148px; height:20px; pointer-events:none; text-align:right; pointer-events:none;";
var f=document.createElement("div");f.style.cssText="position:relative; left:15px; top:-28px; width:8px; height:8px; pointer-events:none; background-color: "+this.colorSelect+";  border-radius:20px;";e.innerHTML=a.substr(0,a.lastIndexOf("."));c.appendChild(d);c.appendChild(e);c.appendChild(f);this.zone.appendChild(c);c.name=b;c.onclick=function(a){this.openFile(a)}.bind(this);c.ondblclick=function(a){this.openFile(a)}.bind(this);c.onmouseover=function(a){this.iconOver(a)}.bind(this);c.onmouseout=
function(a){this.unselected(a)}.bind(this);c.onmouseup=function(a){this.unselected(a)}.bind(this);c.ondragstart=function(a){this.dragstart(a)}.bind(this);c.ondragend=function(a){this.dragend(a)}.bind(this);this.icons[b]=c;this.files[b]=a},iconOver:function(a){a.target.className="ic icover";var b=a.target.name;b!==LTH.cFile&&(this.icons[b].childNodes[0].style.border="2px solid "+this.colorOver);a.preventDefault()},unselected:function(a){a.target.className="ic icout";var b=a.target.name;b!==LTH.cFile&&
(this.icons[b].childNodes[0].style.border="2px solid rgba(0,0,0,0)");a.preventDefault()},addIconLink:function(a,b,c){window.URL=window.webkitURL||window.URL;this.currentLink&&(window.URL.revokeObjectURL(this.currentLink.href),this.currentLink=null);this.currentLink=document.createElement("a");this.currentLink.style.cssText="position:absolute; top:6px; right:65px; width:120px; height:20px; text-align:center;";this.currentLink.download=b;this.currentLink.href=window.URL.createObjectURL(a);this.currentLink.dataset.downloadurl=
[c,this.currentLink.download,this.currentLink.href].join(":")},dragstart:function(a){null!==this.currentLink&&a.dataTransfer.setData("DownloadURL",this.currentLink.dataset.downloadurl)},dragend:function(a){this.resetModified()},openFile:function(a){a.preventDefault();a=a.target.name;LTH.cFile!==a&&(LTH.cFile=a,this.resetModified(),this.main.loadFile("demos/"+LTH.rubriques[LTH.cRubr]+"/"+this.files[a]),this.resetIcon())},resetIcon:function(a){for(var b=this.icons.length,c;b--;)c=this.icons[b].childNodes,
c[0].style.border=b==LTH.cFile?b==this.inModif?"2px solid "+this.colorModif:"2px solid "+this.colorSelect:"2px solid rgba(0,0,0,0)",a&&(b==this.inModif?(c[1].style.color=this.colorModif,c[2].style.backgroundColor=this.colorModif):(c[1].style.color=this.colorSelect,c[2].style.backgroundColor=this.colorSelect))},modified:function(){this.inModif=LTH.cFile;var a=this.icons[LTH.cFile].childNodes;this.icons[LTH.cFile].draggable=!0;this.icons[LTH.cFile].classList.add("dragout");a[0].style.border="2px solid "+
this.colorModif;a[1].style.color=this.colorModif;a[2].style.backgroundColor=this.colorModif;this.main.callSave()},resetModified:function(){this.inModif=-1;for(var a=this.icons.length,b;a--;)this.icons[a].draggable=!1,this.icons[a].classList.remove("dragout"),b=this.icons[a].childNodes,a==LTH.cFile&&(b[0].style.border="1px solid "+this.colorSelect),b[1].style.color=this.colorSelect,b[2].style.backgroundColor=this.colorSelect;this.currentLink&&(window.URL.revokeObjectURL(this.currentLink.href),this.currentLink=
null)},showHideMenu:function(a){var b=this.content.className;a=a.clientX;170<a&&"menu exemple In"===b&&(this.content.className="menu exemple Out",this.logo.className="logo lmin",this.title.innerHTML="");60>a&&("menu exemple"===b||"menu exemple Out"===b)&&(this.content.className="menu exemple In",this.logo.className="logo lmax",this.title.innerHTML=LTH.rubriques[LTH.cRubr].toUpperCase())}};LTH.FileSystem=function(a){this.main=a};
LTH.FileSystem.prototype={constructor:LTH.FileSystem,loadXML:function(a){var b;window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP"));b.onload=function(a){a=b.responseXML.getElementsByTagName("rubrique");for(var d,e=0;e<a.length;e++){d=a[e];LTH.rubriques[e]=d.attributes[0].value;LTH.ARCS[LTH.rubriques[e]]={color:"#"+d.attributes[1].value,demos:[],icon:[]};LTH.demoNames[e]=[];LTH.libsNames[e]=[];d=d.getElementsByTagName("demo");for(var f=0;f<d.length;f++)LTH.demoNames[e][f]=
d[f].attributes[0].value,LTH.ARCS[LTH.rubriques[e]].demos[f]=d[f].attributes[0].value,LTH.ARCS[LTH.rubriques[e]].icon[f]=1*d[f].attributes[2].value,LTH.libsNames[e][f]=d[f].attributes[1].value.split("|").map(function(a){return a})}this.main.init()}.bind(this);b.open("GET",a,!0);b.send()},load:function(a){a.substring(a.lastIndexOf(".")+1,a.length);var b=a.substring(a.lastIndexOf("/")+1,a.lastIndexOf(".")),c;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP"));
c.onload=function(a){this.process(b,c.responseText)}.bind(this);c.open("GET",a,!0);c.send()},open:function(a){var b=a.name,c=new FileReader,d=this;c.onload=function(a){d.process(b,a.target.result)};c.readAsText(a.file)},save:function(){var a=new Blob([this.main.editor.get()],{type:"application/text/javascript;charset=utf-8"});this.main.createLink(a,this.main.editor.currentName+".js","application/text/javascript;charset=utf-8")},process:function(a,b){this.main.editor.editor.setValue(b);this.main.editor.currentName=
a}};LTH.ShaderToy=function(a){this.main=a;this.retour=document.createElement("div");this.retour.innerHTML=".join('&#92;n')";this.shaderName="";this.shaderBase=null;this.uniformValues={};this.uniformColors={};this.uniformNames={};this.isShaderReady=!1;this.interval=null};
LTH.ShaderToy.prototype={constructor:LTH.ShaderToy,clear:function(){this.shaderName="";this.shaderBase=null;this.uniformColors={};this.uniformValues={};this.uniformNames={};this.isShaderReady=!1},pushShader:function(a,b){""!==this.shaderName&&this.clear();this.shaderName=a;this.getUniformValue(b.uniforms);this.main.editorVertex.set(b.vs,!0);this.main.editorFragment.set(b.fs,!0);this.activeUpdate();this.isShaderReady=!0},getUniformValue:function(a){this.uniformValues={};for(var b in a){var c=a[b].type,
d=JSON.stringify(a[b].value);"c"===c?this.uniformColors[b]=d:this.uniformValues[b]=d;"c"===c&&this.main.previewMain.v.gui.color(b,a[b].value);"i"===c&&this.main.previewMain.v.gui.int(b,a[b].value);"f"===c&&this.main.previewMain.v.gui.float(b,a[b].value);"t"===c&&this.main.previewMain.v.gui.textures(b)}},disableUpdate:function(){this.main.editorVertex.editor.on("change",function(){return!1});this.main.editorFragment.editor.on("change",function(){return!1})},activeUpdate:function(){var a=this;this.main.editorVertex.editor.on("change",
function(){a.onChange()});this.main.editorFragment.editor.on("change",function(){a.onChange()})},onChange:function(){var a=this;clearTimeout(this.interval);this.interval=setTimeout(function(){a.compacte()},500)},compacte:function(){if("shader"===this.main.mode&&this.isShaderReady){this.uniform="";var a=this.getShader(this.main.editorVertex.editor),b=this.getShader(this.main.editorFragment.editor),a=["V."+this.shaderName+"={","uniforms:{",this.uniform,"},","fs: ["+b+"]"+this.retour.innerHTML+",","vs: ["+
a+"]"+this.retour.innerHTML,"}"].join("\n");this.main.preview.contentWindow.shader.updateShader(a)}},pushUniform:function(a){var b=a.split(String.fromCharCode(32));a=b[1];var b=b[2].replace(";",""),c=this.isAlphanumeric(b),d=!1,e=null,f=null,g;for(g in this.uniformValues)g===b&&(f=JSON.parse(this.uniformValues[g]));for(g in this.uniformColors)g===b&&(f=JSON.parse(this.uniformColors[g]),d=!0);var h="";switch(a){case "sampler2D":case "samplerCube":h="t";break;case "vec2":h="v2";null!==f&&(e="new THREE.Vector2("+
f.x+","+f.y+")");break;case "vec3":d?(h="c",null!==f&&(e="new THREE.Color("+f.r+","+f.g+","+f.b+")")):(h="v3",null!==f&&(e="new THREE.Vector3("+f.x+","+f.y+","+f.z+")"));break;case "vec4":h="v4";null!==f&&(e="new THREE.Vector3("+f.x+","+f.y+","+f.z+","+f.w+")");break;case "int":h="i";null!==f&&(e=f);break;case "float":h="f";null!==f&&(e=f);break;case "mat4":h="m4"}c||(h+="v");for(g in this.uniformNames)if(g===b)return;this.uniform+=b+" : { type: '"+h+"', value: "+e+" },\n";this.uniformNames[b]=1},
isAlphanumeric:function(a){return/^[0-9a-zA-Z]+$/.test(a)},getShader:function(a){for(var b="",c=a.lineCount(),d,e=0;e<c;e++)d=a.getLine(e),void 0!==d&&("uniform"===d.substring(0,7)&&this.pushUniform(d),b=0==e?b+("\n'"+d+"',\n"):e==c-1?b+("'"+d+"'\n"):b+("'"+d+"',\n"));return b}};LTH.CodeEditor=function(a,b){this.type=b||"base";this.main=a;this.doc=document;this.interval=this.editor=null;this.currentName=this.mode="";this.content=this.doc.createElement("div");this.content.className="editor";this.content.id="editor"+this.type;this.doc.body.appendChild(this.content);this.errorLines=[];this.widgets=[];this.isStart=this.isEnd=!1;this.init()};
LTH.CodeEditor.prototype={constructor:LTH.CodeEditor,init:function(){this.editor=CodeMirror(this.content,{lineNumbers:!0,matchBrackets:!0,indentWithTabs:!0,styleActiveLine:!0,theme:"monokai",mode:"text/javascript",tabSize:4,indentUnit:4,highlightSelectionMatches:{showToken:/\w/}});var a=this;if("base"===this.type)this.editor.on("change",function(){a.onChange()})},onChange:function(){var a=this;this.mode=this.editor.getOption("mode");if(!this.end){clearTimeout(this.interval);var b=this.editor.getValue();
this.validate(b)&&(this.interval=setTimeout(function(){a.main.update(b,!0)},500))}},get:function(){return this.editor.getValue()},set:function(a){this.editor.setValue(a)},changeTheme:function(a){0==a?this.editor.setOption("theme","default"):this.editor.setOption("theme","monokai")},deleteAll:function(){this.clear();this.doc.body.removeChild(this.content);this.content=null},clear:function(){this.isEnd=!0;this.main.showCode=!1;this.content.style.display="none";this.editor.setValue("")},refresh:function(){this.editor.refresh()},
changeFontSize:function(a){this.editor.getWrapperElement().style["font-size"]=a+"px";this.refresh()},close:function(){this.editor.getInputField().blur()},blur:function(){this.editor.getInputField().blur()},validate:function(a){var b=this.editor,c=this;return b.operation(function(){for(;0<c.errorLines.length;)b.removeLineClass(c.errorLines.shift(),"background","errorLine");for(var d=0;d<c.widgets.length;d++)b.removeLineWidget(c.widgets[d]);c.widgets.length=0;try{for(var e=esprima.parse(a,{tolerant:!0}).errors,
d=0;d<e.length;d++){var f=e[d],g=document.createElement("div");g.className="esprima-error";g.textContent=f.message.replace(/Line [0-9]+: /,"");var h=f.lineNumber-1;c.errorLines.push(h);b.addLineClass(h,"background","errorLine");var k=b.addLineWidget(h,g);c.widgets.push(k)}}catch(l){g=document.createElement("div"),g.className="esprima-error",g.textContent=l.message.replace(/Line [0-9]+: /,""),h=l.lineNumber-1,c.errorLines.push(h),b.addLineClass(h,"background","errorLine"),k=b.addLineWidget(h,g),c.widgets.push(k)}return 0===
c.errorLines.length})}};var URL=window.URL||window.webkitURL;LTH.Transcode=function(a,b,c,d){this.main=a;this.list=b;this.callback=c||function(){};this.isDebug=d||!1;this.canvas=document.createElement("canvas");this.ctx=this.gl=null;this.size={w:0,h:0};this.name="";this.time=0;this.codes={};this.isWebGl=this.useTrans=!1;this.init()};
LTH.Transcode.prototype={constructor:LTH.Transcode,init:function(){this.load()},load:function(){this.name=this.list[0];var a=new Image;a.onload=function(){this.time=Date.now();this.canvas.width=this.size.w=a.width;this.canvas.height=this.size.h=a.height;this.canvas3d(a);this.list.shift();this.list.length?this.load():this.callback()}.bind(this);a.src="images/code/"+this.name+".png"},create3dContext:function(){for(var a=["webgl","experimental-webgl"],b=0;b<a.length;++b){try{this.gl=this.canvas.getContext(a[b])}catch(c){}if(this.gl)break}this.gl?
(this.program=this.createProgram(this.gl,LTH.BitmapShader),this.gl.useProgram(this.program)):this.gl=null},canvas3d:function(a){var b=this.size.w,c=this.size.h;null==this.gl&&this.create3dContext();var d=this.gl,e;if(d){this.isWebGl=!0;e=d.getAttribLocation(this.program,"a_position");var f=d.getAttribLocation(this.program,"a_texCoord"),g=d.createBuffer();d.viewport(0,0,b,c);d.bindBuffer(d.ARRAY_BUFFER,g);d.bufferData(d.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),d.STATIC_DRAW);d.enableVertexAttribArray(f);
d.vertexAttribPointer(f,2,d.FLOAT,!1,0,0);f=d.createTexture();d.bindTexture(d.TEXTURE_2D,f);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a);a=d.getUniformLocation(this.program,"u_resolution");d.uniform2f(a,b,c);a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,
a);d.enableVertexAttribArray(e);d.vertexAttribPointer(e,2,d.FLOAT,!1,0,0);d.bufferData(d.ARRAY_BUFFER,new Float32Array([0,c,b,c,0,0,0,0,b,c,b,0]),d.STATIC_DRAW);d.drawArrays(d.TRIANGLES,0,6);e=new Uint8Array(b*c*4);d.readPixels(0,0,b,c,d.RGBA,d.UNSIGNED_BYTE,e);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)}else this.isWebGl=!1,this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(a,0,0),e=this.ctx.getImageData(0,0,this.size.w,this.size.h).data;this.decodeData(e)},decodeData:function(a){var b=
0;0!==a[1]&&(b=1);0!==a[2]&&(b=2);for(var c,d="",e=a.length/4,f=0;f<e;f++)c=4*f+b,c=a[c]+32,c=127==c?10:c,d+=String.fromCharCode(c);this.isDebug&&(this.main.menu.title.innerHTML="WELCOME<br>LOADING CODES<br>"+this.name.toUpperCase()+" "+(Date.now()-this.time)+" MS");"full"==this.name&&(d.substring(3,8),this.useTrans=!1);try{var g=new Blob([d],{type:"application/javascript"});this.codes[this.name]=URL.createObjectURL(g);this.useTrans=!0}catch(h){this.useTrans=!1}this.useTrans||(this.list.length=0)},
createProgram:function(a,b){var c=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(c,b.fs);a.compileShader(c);var d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,b.vs);a.compileShader(d);var e=a.createProgram();a.attachShader(e,d);a.attachShader(e,c);a.linkProgram(e);a.getProgramParameter(e,a.LINK_STATUS)||console.error("Error linking the shader: "+a.getProgramInfoLog(e));return e}};
LTH.BitmapShader={fs:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nvoid main() { gl_FragColor = texture2D(u_image, v_texCoord); }",vs:"attribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\nvoid main() {\nvec2 zeroToOne = a_position / u_resolution;\nvec2 zeroToTwo = zeroToOne * 2.0;\nvec2 clipSpace = zeroToTwo - 1.0;\ngl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\nv_texCoord = a_texCoord;\n}"};
