'use strict';var define,exports,module,WeakMap;
(function(b,a){"function"===typeof define&&define.amd?define("seriously",function(){var c=a(b);b.Seriously||(b.Seriously=c);return c}):"object"===typeof exports?module.exports=a(b):"function"!==typeof b.Seriously&&(b.Seriously=a(b))})(this,function(b){function a(h,a){var b,c;if("string"===typeof h)b=w.querySelector(h);else if(!h)return!1;h.tagName&&(b=h);if(!b)return h;c=b.tagName.toLowerCase();return a&&0>a.indexOf(c)?h:b}function c(h,a){var b,d;h.prototype&&a.prototype&&h.prototype!==a.prototype&&
c(h.prototype,a.prototype);for(b in a)a.hasOwnProperty(b)&&(d=Object.getOwnPropertyDescriptor(a,b),d.get||d.set?Object.defineProperty(h,b,{configurable:!0,enumerable:!0,get:d.get,set:d.set}):h[b]=a[b]);return h}function d(a){var b;if(!x)return ga;if("function"===typeof x[a])b=x[a];else if("function"===typeof x.log)b=x.log;else return ga;return b.bind?b.bind(x):function(){b.apply(x,arguments)}}function f(a,b,c,d,e){function m(a,b,h){h%=1;0>h&&(h+=1);return h<1/6?a+(b-a)*h*6:0.5>h?b:h<2/3?a+(b-a)*(2/
3-h)*6:a}b=0.5>c?c*(b+1):c+b-c*b;c=2*c-b;e||(e=[]);e[0]=m(c,b,a+1/3);e[1]=m(c,b,a);e[2]=m(c,b,a-1/3);e[3]=d;return e}function k(a){var b,c,d,e="#",m=1>a[3]?4:3;for(b=0;b<m;b++)c=Math.min(255,Math.round(255*a[b]||0)),d=c.toString(16),16>c&&(d="0"+d),e+=d;return e}function g(a){return Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a}function l(a){function c(){X.length&&X.shift()()}if("function"!==typeof a)throw Error("setTimeoutZero argument is not a function");X.push(a);"file:"===b.location.protocol?
setTimeout(c,0):b.postMessage("seriously-timeout-message",b.location)}function s(a,c){var q;try{q=b.WebGLDebugUtils&&c&&c.debugContext?b.WebGLDebugUtils.makeDebugContext(a.getContext("webgl",c)):a.getContext("webgl",c)}catch(d){}if(!q)try{q=a.getContext("experimental-webgl",c)}catch(e){}return q}function n(){var a;v&&v.getError()===v.CONTEXT_LOST_WEBGL&&(v=void 0);if(v||!b.WebGLRenderingContext||y)return v;a=w.createElement("canvas");(v=s(a))?a.addEventListener("webglcontextlost",function q(b){b.preventDefault();
v&&v.canvas===this&&(v=void 0,a.removeEventListener("webglcontextlost",q,!1))},!1):p.logger.warn("Unable to access WebGL.");return v}function e(a){function b(a,c){var h,q;g(a)?(h=a[0],q=a[1]||h):h=a;"string"===typeof h?h=h.toLowerCase():"number"===typeof h?h=String(h):h||(h="");e[h]=q;c||(d.firstValue=h)}function c(a){return a}var d,e,m;for(m in a.inputs)if(a.inputs.hasOwnProperty(m)){if(0<=a.reserved.indexOf(m)||Object.prototype[m])throw Error("Reserved input name: "+m);d=a.inputs[m];d.name=m;isNaN(d.min)&&
(d.min=-Infinity);isNaN(d.max)&&(d.max=Infinity);isNaN(d.minCount)&&(d.minCount=-Infinity);isNaN(d.maxCount)&&(d.maxCount=Infinity);isNaN(d.step)&&(d.step=0);"enum"===d.type&&d.options&&g(d.options)&&d.options.length&&(e={},d.options.forEach(b),d.options=e);"vector"===d.type?2>d.dimensions?d.dimensions=2:4<d.dimensions?d.dimensions=4:!d.dimensions||isNaN(d.dimensions)?d.dimensions=4:d.dimensions=Math.round(d.dimensions):d.dimensions=1;d.shaderDirty=!!d.shaderDirty;"function"!==typeof d.validate&&
(d.validate=p.inputValidators[d.type]||c);a.defaultImageInput||"image"!==d.type||(a.defaultImageInput=m)}}function m(a,b,c,d){var e,m;this.type=a.UNSIGNED_BYTE;e=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,e);d&&d.texture?(this.texture=d.texture,a.bindTexture(a.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===a.FLOAT?(m=new Float32Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.FLOAT,m)):(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.type=a.UNSIGNED_BYTE)}catch(f){this.type=a.UNSIGNED_BYTE,m=new Uint8Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,
a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,m)}d=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,d);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,d);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);m=a.checkFramebufferStatus(a.FRAMEBUFFER);if(m===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(m===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
if(m===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(m===a.FRAMEBUFFER_UNSUPPORTED)throw Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(m!==a.FRAMEBUFFER_COMPLETE)throw Error("Incomplete framebuffer: "+m);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);this.gl=a;this.frameBuffer=e;this.renderBuffer=d;this.width=b;this.height=c}function t(a,b,c){function d(b,
c){var q,e;q=c?a.createShader(a.FRAGMENT_SHADER):a.createShader(a.VERTEX_SHADER);a.shaderSource(q,b);a.compileShader(q);if(!a.getShaderParameter(q,a.COMPILE_STATUS)){b=b.split(/[\n\r]/);for(e=0;e<b.length;e++)b[e]=e+1+":\t"+b[e];b.unshift("Error compiling "+(c?"fragment":"vertex")+" shader:");p.logger.error(b.join("\n"));throw Error("Shader error: "+a.getShaderInfoLog(q));}return q}function e(b,c){if(b.type===a.SAMPLER_2D)return function(d){b.glTexture=a["TEXTURE"+d];a.uniform1i(c,d)};if(b.type===
a.BOOL||b.type===a.INT)return 1<b.size?function(b){a.uniform1iv(c,b)}:function(b){a.uniform1i(c,b)};if(b.type===a.FLOAT)return 1<b.size?function(b){a.uniform1fv(c,b)}:function(b){a.uniform1f(c,b)};if(b.type===a.FLOAT_VEC2)return function(b){a.uniform2f(c,b[0],b[1])};if(b.type===a.FLOAT_VEC3)return function(b){a.uniform3f(c,b[0],b[1],b[2])};if(b.type===a.FLOAT_VEC4)return function(b){a.uniform4f(c,b[0],b[1],b[2],b[3])};if(b.type===a.FLOAT_MAT3)return function(b){a.uniformMatrix3fv(c,!1,b)};if(b.type===
a.FLOAT_MAT4)return function(b){a.uniformMatrix4fv(c,!1,b)};throw Error("Unknown shader uniform type: "+b.type);}function m(b){return function(){return a.getUniform(f,b)}}var f,g,k,l="";g=d(b);k=d(c,!0);f=a.createProgram();a.attachShader(f,g);(b=a.getShaderInfoLog(g))&&(l+="Vertex shader error: "+b+"\n");a.attachShader(f,k);(b=a.getShaderInfoLog(k))&&(l+="Fragment shader error: "+b+"\n");a.linkProgram(f);if(!a.getProgramParameter(f,a.LINK_STATUS))throw l+=a.getProgramInfoLog(f),a.deleteProgram(f),
a.deleteShader(g),a.deleteShader(k),Error("Could not initialise shader: "+l);a.useProgram(f);this.uniforms={};b=a.getProgramParameter(f,a.ACTIVE_UNIFORMS);for(l=0;l<b;++l)c={info:a.getActiveUniform(f,l)},c.name=c.info.name,c.loc=a.getUniformLocation(f,c.name),c.set=e(c.info,c.loc),c.get=m(c.loc),this.uniforms[c.name]=c,this[c.name]||(this[c.name]=c);this.attributes={};this.location={};b=a.getProgramParameter(f,a.ACTIVE_ATTRIBUTES);for(l=0;l<b;++l)c={info:a.getActiveAttrib(f,l)},c.name=c.info.name,
c.location=a.getAttribLocation(f,c.name),this.attributes[c.name]=c,this.location[c.name]=c.location;this.gl=a;this.program=f;this.destroy=function(){var b;a&&(a.deleteProgram(f),a.deleteShader(g),a.deleteShader(k));for(b in this)this.hasOwnProperty(b)&&delete this[b];k=g=f=null}}function p(d){function f(a,b){var c,d,h;if(!b)return!1;c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW);c.size=3;d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.indices,b.STATIC_DRAW);h=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,h);b.bufferData(b.ARRAY_BUFFER,a.coords,b.STATIC_DRAW);h.size=2;return{vertex:c,index:d,texCoord:h,length:a.indices.length,mode:a.mode||b.TRIANGLES}}function q(a){var b={};b.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);b.indices=new Uint16Array([0,1,2,0,2,3]);b.coords=new Float32Array([0,0,1,0,1,1,0,1]);return f(b,a)}function g(a){var b;if(!r)if(a.canvas.addEventListener("webglcontextlost",
v,!1),a.canvas.addEventListener("webglcontextrestored",n,!1),a.isContextLost())p.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");else{r=a;na=a.canvas;K=q(r);Q=new t(r,X,oa);for(a=0;a<ha.length;a++)b=ha[a],b.gl=r,b.initialize(),b.buildShader();for(a=0;a<R.length;a++)b=R[a],b.initialize();for(a=0;a<L.length;a++)b=L[a],b.model||(b.model=K,b.shader=Q)}}function n(){var a,b;if(Z&&!r)if(a=Z.target,a instanceof WebGLFramebuffer)p.logger.error("Unable to restore target built on WebGLFramebuffer");
else if(a=s(a,{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!0,debugContext:Z.debugContext}))if(a.isContextLost())p.logger.error("Unable to restore WebGL Context");else{g(a);Z.frameBuffer=Z.renderToTexture?new m(r,Z.width,Z.height,!1):{frameBuffer:null};for(a=0;a<Y.length;a++)b=Y[a],b.setDirty(),b.emit("webglcontextrestored");p.logger.log("WebGL context restored")}}function v(a){var b,c;a&&(p.logger.warn("WebGL context lost"),a.preventDefault());S&&(ua(S),S=0);na&&na.removeEventListener("webglcontextlost",
v,!1);for(b=0;b<ha.length;b++)c=ha[b],c.gl=null,c.initialized=!1,c.baseShader=null,c.model=null,c.frameBuffer=null,c.texture=null,c.shader&&c.shader.destroy&&c.shader.destroy(),c.shaderDirty=!0,c.shader=null,c.effect.lostContext&&c.effect.lostContext.call(c),a&&c.emit("webglcontextlost");for(b=0;b<R.length;b++)c=R[b],c.texture=null,c.initialized=!1,c.allowRefresh=!1,a&&c.emit("webglcontextlost");for(b=0;b<pa.length;b++)c=pa[b],c.frameBuffer=null,c.texture=null,a&&c.emit("webglcontextlost");for(b=
0;b<L.length;b++)c=L[b],c.model=!1,c.frameBuffer=null,a&&c.emit("webglcontextlost");Q&&Q.destroy&&Q.destroy();r&&(r.deleteBuffer(K.vertex),r.deleteBuffer(K.texCoord),r.deleteBuffer(K.index));K&&(delete K.vertex,delete K.texCoord,delete K.index);na=r=Q=K=null}function ia(a){var b,c=!1;S=0;if(C.length)for(c=!0,b=0;b<C.length;b++)C[b].call(P,a);if(R&&R.length)for(c=!0,b=0;b<R.length;b++)if(a=R[b],a.dirty||a.checkDirty&&a.checkDirty())a.dirty=!1,a.setDirty();for(b=0;b<L.length;b++)a=L[b],a.auto&&a.dirty&&
a.render();if(D.length)for(c=!0,b=0;b<D.length;b++)D[b].call(P);c&&!S&&(S=va(ia))}function J(a,b,c,d,h,q){var e=0,m,f,g=h&&h.gl||r,l;if(g){h?(f=q&&q.width||h.width||g.canvas.width,h=q&&q.height||h.height||g.canvas.height):(f=q&&q.width||g.canvas.width,h=q&&q.height||g.canvas.height);a.use();g.viewport(0,0,f,h);g.bindFramebuffer(g.FRAMEBUFFER,d);g.enableVertexAttribArray(a.location.position);g.enableVertexAttribArray(a.location.texCoord);b.texCoord&&(g.bindBuffer(g.ARRAY_BUFFER,b.texCoord),g.vertexAttribPointer(a.location.texCoord,
b.texCoord.size,g.FLOAT,!1,0,0));g.bindBuffer(g.ARRAY_BUFFER,b.vertex);g.vertexAttribPointer(a.location.position,b.vertex.size,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,b.index);q&&q.depth?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);q?void 0===q.blend||q.blend?(r.enable(r.BLEND),d=void 0===q.srcRGB?r.ONE:q.srcRGB,h=q.dstRGB||r.ZERO,f=void 0===q.srcAlpha?d:q.srcAlpha,l=void 0===q.dstAlpha?h:q.dstAlpha,r.blendFuncSeparate(d,h,f,l),r.blendEquation(q.blendEquation||r.FUNC_ADD)):r.disable(r.BLEND):
(r.enable(r.BLEND),r.blendFunc(r.ONE,r.ZERO),r.blendEquation(r.FUNC_ADD));for(m in c)c.hasOwnProperty(m)&&(d=c[m],f=a.uniforms[m])&&(d instanceof WebGLTexture?(g.activeTexture(g.TEXTURE0+e),g.bindTexture(g.TEXTURE_2D,d),f.set(e),e++):d instanceof T||d instanceof G||d instanceof H?d.texture&&(g.activeTexture(g.TEXTURE0+e),g.bindTexture(g.TEXTURE_2D,d.texture),f.set(e),e++):void 0!==d&&null!==d&&f.set(d));if(!q||void 0===q.clear||q.clear)g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);
g.drawElements(b.mode,b.length,g.UNSIGNED_SHORT,0);r.enable(r.DEPTH_TEST)}}function x(b,c,d){var h,q;if("string"!==typeof b||!c&&0!==c)d&&"object"===typeof d||(d=c),c=b;"string"===typeof b&&M[b]||(b=null);if(c instanceof T||c instanceof G||c instanceof H)h=c;else if(c instanceof fa||c instanceof sa||c instanceof ta){if(h=aa[c.id],!h)throw Error("Cannot connect a foreign node");}else{"string"===typeof c&&isNaN(c)&&(c=a(c,["canvas","img","video"]));for(q=0;q<R.length;q++)if(h=R[q],(!b||b===h.hook)&&
h.compare&&h.compare(c,d))return h;h=new T(b,c,d)}return h}function E(a,b){var c,d,h;if(!(a instanceof G||a instanceof H))return!1;if(a===b)return!0;h=a.sources;for(c in h)if(h.hasOwnProperty(c)&&(d=h[c],d===b||E(d,b)))return!0;return!1}if(b===this||!(this instanceof p)||void 0!==this.id)return new p(d);var y=++za,P=this,Y=[],aa={},N=0,R=[],L=[],pa=[],ha=[],z={},C=[],D=[],V={},na,r,Z,K,ca={},Q,X,oa,B,T,G,H,U,fa,sa,ta,ja,qa=!1,ra=!1,S;B=function(){this.ready=!1;this.height=this.width=1;this.gl=r;this.uniforms=
{resolution:[this.width,this.height],transform:null};this.dirty=!0;this.isDestroyed=!1;this.seriously=P;this.listeners={};this.id=N;N++};B.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};B.prototype.setUnready=function(){var a;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setUnready()};B.prototype.setDirty=function(){var a;
if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setDirty()};B.prototype.initFrameBuffer=function(a){r&&(this.frameBuffer=new m(r,this.width,this.height,a))};B.prototype.readPixels=function(a,b,c,d,h){var q=this.gl||r;if(!r)throw Error("Cannot read pixels until a canvas is connected");this.frameBuffer||(this.initFrameBuffer(),this.setDirty());this.render();if(void 0===h)h=new Uint8Array(c*d*4);else if(!h instanceof Uint8Array)throw Error("Incompatible array type");
q.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer.frameBuffer);q.readPixels(a,b,c,d,r.RGBA,r.UNSIGNED_BYTE,h);return h};B.prototype.resize=function(){var a,b;this.source?(a=this.source.width,b=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,b=this.sources.source.height):this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=Math.floor(b);if(this.width!==a||this.height!==
b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b);this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(a,b)};B.prototype.on=function(a,b){var c,d=-1;a&&"function"===typeof b&&((c=this.listeners[a])?d=c.indexOf(b):c=this.listeners[a]=[],0>d&&c.push(b))};B.prototype.off=function(a,b){var c,d=-1;a&&"function"===typeof b&&(c=this.listeners[a])&&(d=c.indexOf(b),0<=d&&c.splice(d,
1))};B.prototype.emit=function(a){var b=this.listeners[a];if(b&&b.length)for(a=0;a<b.length;a++)l(b[a])};B.prototype.destroy=function(){var a,b;delete this.gl;delete this.seriously;for(b in this.listeners)this.listeners.hasOwnProperty(b)&&delete this.listeners[b];for(a in this.uniforms)this.uniforms.hasOwnProperty(a)&&delete this.uniforms[a];this.targets&&delete this.targets;this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer);a=Y.indexOf(this);0<=a&&Y.splice(a,
1);delete aa[this.id];this.isDestroyed=!0};fa=function(b){function d(b,c){var u,h,q;q=f.effect.inputs[b];u=f.inputElements[b];"string"===typeof c&&isNaN(c)&&("enum"===q.type?q.options.hasOwnProperty(c)||(c=a(c,["select"])):"number"===q.type||"boolean"===q.type?c=a(c,["input","select"]):"image"===q.type&&(c=a(c,["canvas","img","video"])));c instanceof HTMLInputElement||c instanceof HTMLSelectElement?(h=c.value,u&&u.element!==c&&(u.element.removeEventListener("change",u.listener,!0),u.element.removeEventListener("input",
u.listener,!0),delete f.inputElements[b],u=null),u||(u={element:c,listener:function(a,b){return function(){var u,d;u="checkbox"===c.type?c.checked:b.value;d=f.setInput(a,u);"color"===q.type&&(d=k(d).substr(0,7));d!==u&&(b.value=d)}}(b,c)},f.inputElements[b]=u,"range"===c.type&&c.addEventListener("input",u.listener,!0),c.addEventListener("change",u.listener,!0)),u&&"checkbox"===c.type&&(h=c.checked)):(u&&(u.element.removeEventListener("change",u.listener,!0),u.element.removeEventListener("input",u.listener,
!0),delete f.inputElements[b]),h=c);f.setInput(b,h);return f.inputs[b]}function h(a){return function(b){return(b=d(a,b))&&b.pub}}function q(a){return function(){var b=f.inputs[a];return b&&b.pub}}function e(a){return function(b){return d(a,b)}}function g(a){return function(){return f.inputs[a]}}var m,f=b;for(m in f.effect.inputs)if(f.effect.inputs.hasOwnProperty(m))if(void 0===this[m])"image"===f.effect.inputs[m].type?Object.defineProperty(this,m,{configurable:!0,enumerable:!0,get:q(m),set:h(m)}):
Object.defineProperty(this,m,{configurable:!0,enumerable:!0,get:g(m),set:e(m)});else throw Error("Cannot overwrite Seriously."+m);Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return f.hook}},title:{enumerable:!0,configurable:!0,get:function(){return f.effect.title||f.hook}},width:{enumerable:!0,configurable:!0,get:function(){return f.width}},height:{enumerable:!0,configurable:!0,get:function(){return f.height}},id:{enumerable:!0,configurable:!0,get:function(){return f.id}}});
this.render=function(){f.render();return this};this.readPixels=function(a,b,c,u,d){return f.readPixels(a,b,c,u,d)};this.on=function(a,b){f.on(a,b)};this.off=function(a,b){f.off(a,b)};this.inputs=function(a){var b,u;b=f.effect.inputs;if(a){b=b[a];if(!b)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=
b.description);return a}a={};for(u in b)b.hasOwnProperty(u)&&(a[u]=this.inputs(u));return a};this.alias=function(a,b){f.alias(a,b);return this};this.matte=function(a){f.matte(a)};this.destroy=function(){var a,b;f.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=ga)};this.isDestroyed=function(){return f.isDestroyed};this.isReady=function(){return f.ready}};G=function(a,
b){var d,h,q,f,m={};B.call(this,b);this.gl=r;this.effectRef=I[a];this.sources={};this.targets=[];this.inputElements={};this.shaderDirty=this.dirty=!0;this.hook=a;this.options=b;this.transform=null;this.effect=c({},this.effectRef);this.effectRef.definition&&c(this.effect,this.effectRef.definition.call(this,b));e(this.effect);this.uniforms.transform=ba;this.inputs={};f=V[a];for(d in this.effect.inputs)if(this.effect.inputs.hasOwnProperty(d)){h=this.effect.inputs[d];if(void 0===h.defaultValue||null===
h.defaultValue)"number"===h.type?h.defaultValue=Math.min(Math.max(0,h.min),h.max):"color"===h.type?h.defaultValue=[0,0,0,0]:"boolean"===h.type?h.defaultValue=!1:"string"===h.type?h.defaultValue="":"enum"===h.type&&(h.defaultValue=h.firstValue);q=h.validate.call(this,h.defaultValue,h);f&&void 0!==f[d]&&(q=h.validate.call(this,f[d],h,h.defaultValue,q),f[d]=q,"image"===h.type&&(m[d]=q));this.inputs[d]=q;h.uniform&&(this.uniforms[h.uniform]=h.defaultValue)}r&&(this.initialize(),this.effect.commonShader&&
this.buildShader());this.updateReady();this.inPlace=this.effect.inPlace;this.pub=new fa(this);Y.push(this);aa[this.id]=this;ha.push(this);da[a].push(this);for(d in m)m.hasOwnProperty(d)&&this.setInput(d,m[d])};c(G,B);G.prototype.initialize=function(){if(!this.initialized){var a=this;this.baseShader=Q;this.model=this.shape?f(this.shape,this.gl):K;"function"===typeof this.effect.initialize?this.effect.initialize.call(this,function(){a.initFrameBuffer(!0)},r):this.initFrameBuffer(!0);this.frameBuffer&&
(this.texture=this.frameBuffer.texture);this.initialized=!0}};G.prototype.resize=function(){var a;B.prototype.resize.call(this);this.effect.resize&&this.effect.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize()};G.prototype.updateReady=function(){var a,b,c,d=!0;c=this.effect;for(b in c.inputs)if(c.inputs.hasOwnProperty(b)&&(a=this.effect.inputs[b],"image"===a.type&&!(this.sources[b]&&this.sources[b].ready||c.requires&&!c.requires.call(this,b,this.inputs)))){d=!1;break}if(this.ready!==
d&&(this.ready=d,this.emit(d?"ready":"unready"),b=d?"setReady":"setUnready",this.targets))for(a=0;a<this.targets.length;a++)this.targets[a][b]()};G.prototype.setReady=G.prototype.updateReady;G.prototype.setUnready=G.prototype.updateReady;G.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};G.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};G.prototype.removeSource=function(a){var b,
c=a&&a.pub;for(b in this.inputs)!this.inputs.hasOwnProperty(b)||this.inputs[b]!==a&&this.inputs[b]!==c||(this.inputs[b]=null);for(b in this.sources)!this.sources.hasOwnProperty(b)||this.sources[b]!==a&&this.sources[b]!==c||(this.sources[b]=null)};G.prototype.buildShader=function(){var a,b=this.effect;this.shaderDirty&&(b.commonShader&&ca[this.hook]?(this.shader||ca[this.hook].count++,this.shader=ca[this.hook].shader):b.shader?(this.shader&&!b.commonShader&&this.shader.destroy(),a=b.shader.call(this,
this.inputs,{vertex:X,fragment:oa},p.util),this.shader=a instanceof t?a:a&&a.vertex&&a.fragment?new t(r,a.vertex,a.fragment):Q,b.commonShader&&(ca[this.hook]={count:1,shader:this.shader})):this.shader=Q,this.shaderDirty=!1)};G.prototype.render=function(){function a(b,c,d,u,q,F){J(b,c,d,u,q||h,F)}var b,c,d=this.effect,h=this,q;if(r){this.initialized||this.initialize();this.shaderDirty&&this.buildShader();if(this.dirty&&this.ready){for(b in this.sources)!this.sources.hasOwnProperty(b)||d.requires&&
!d.requires.call(this,b,this.inputs)||(q="function"===typeof this.inPlace?this.inPlace(b):this.inPlace,this.sources[b].render(!q));this.frameBuffer&&(c=this.frameBuffer.frameBuffer);"function"===typeof d.draw?(d.draw.call(this,this.shader,this.model,this.uniforms,c,a),this.emit("render")):c&&(J(this.shader,this.model,this.uniforms,c,this),this.emit("render"));this.dirty=!1}return this.texture}};G.prototype.setInput=function(a,b){var c,d,h;if(this.effect.inputs.hasOwnProperty(a)){c=this.effect.inputs[a];
if("image"===c.type){if(b){if(b=x(b),b!==this.sources[a]){a:if(d=this.sources[a]){for(h in this.sources)if(h!==a&&this.sources.hasOwnProperty(h)&&this.sources[h]===d)break a;d.removeTarget(this)}if(E(b,this))throw Error("Attempt to make cyclical connection.");this.sources[a]=b;b.addTarget(this)}}else delete this.sources[a],b=!1;d=this.sources[a];h=Object.keys(this.sources);!0===this.inPlace&&1===h.length?(h=this.sources[h[0]],this.uniforms.transform=h&&h.cumulativeMatrix||ba):this.uniforms.transform=
ba}else d=V[this.hook]&&void 0!==V[this.hook][a]?V[this.hook][a]:c.defaultValue,d=b=c.validate.call(this,b,c,d,this.inputs[a]);if(this.inputs[a]===b&&"color"!==c.type&&"vector"!==c.type)return b;this.inputs[a]=b;c.uniform&&(this.uniforms[c.uniform]=d);"image"===c.type?(this.resize(),this.updateReady()):c.updateSources&&this.updateReady();c.shaderDirty&&(this.shaderDirty=!0);this.setDirty();c.update&&c.update.call(this,b);return b}};G.prototype.alias=function(a,b){var c=this;if(0<=ya.indexOf(b))throw Error("'"+
b+"' is a reserved name and cannot be used as an alias.");this.effect.inputs.hasOwnProperty(a)&&(b||(b=a),P.removeAlias(b),z[b]={node:this,input:a},Object.defineProperty(P,b,{configurable:!0,enumerable:!0,get:function(){return c.inputs[a]},set:function(b){return c.setInput(a,b)}}));return this};G.prototype.matte=function(a){function b(a){var c,d,h,u,e,f=[],g;if(!a.simple){for(c=0;c<a.edges.length;c++)for(h=a.edges[c],d=c+1;d<a.edges.length;d++){u=a.edges[d];a:{e=h[0];g=h[1];var F=u[0],k=u[1],l=void 0,
p=void 0,A=void 0,p=l=void 0,l=(k.x-F.x)*(e.y-F.y)-(k.y-F.y)*(e.x-F.x),p=(g.x-e.x)*(e.y-F.y)-(g.y-e.y)*(e.x-F.x);if(A=(k.y-F.y)*(g.x-e.x)-(k.x-F.x)*(g.y-e.y))if(l/=A,p/=A,0<l&&1>=l&&0<p&&1>=p){e={x:e.x+l*(g.x-e.x),y:e.y+l*(g.y-e.y)};break a}e=!1}e&&(e.edge1=h,e.edge2=u,f.push(e))}if(f.length){d=[];for(c=0;c<f.length;c++)e=f[c],h=e.edge1,u=e.edge2,g={x:e.x,y:e.y,prev:h[0],next:u[1],id:m.length},a.vertices.push(g),m.push(g),h={x:e.x,y:e.y,prev:u[0],next:h[1],id:m.length},a.vertices.push(h),m.push(g),
g.prev.next=g,g.next.prev=g,h.prev.next=h,h.next.prev=h;do{f={edges:[],vertices:[],simple:!0};d.push(f);h=u=a.vertices[0];do c=a.vertices.indexOf(u),a.vertices.splice(c,1),f.edges.push([u,u.next]),f.vertices.push(u),u=u.next;while(u!==h)}while(a.vertices.length);c=q.indexOf(a);q.splice(c,1);for(c=0;c<d.length;c++)q.push(d[c])}else a.simple=!0}}function c(a){var b,d,h=a.vertices.length,u,q=0;b=h-1;for(d=0;d<h;b=d,d++)b=a.vertices[b],u=a.vertices[d],q+=b.x*u.y-u.x*b.y;return 0<q}function d(a){var b,
c=a.vertices,h,u=[],q=[],f,g,m,F;h=c.length;if(a.clockWise)for(b=0;b<h;b++)u[b]=b;else for(b=0;b<h;b++)u[b]=h-1-b;f=2*h;g=0;for(b=h-1;2<h;){if(0>=f--)return q;m=b;h<=m&&(m=0);b=m+1;h<=b&&(b=0);F=b+1;h<F&&(F=0);var l;a:{var p=l=void 0,k=void 0,A=void 0,t=void 0,p=c[u[m]],k=c[u[b]],A=c[u[F]];if(0>(k.x-p.x)*(A.y-p.y)-(k.y-p.y)*(A.x-p.x))l=!1;else{for(l=0;l<h;l++)if(l!==m&&l!==b&&l!==F){var t=c[u[l]],n=void 0,wa=void 0,w=void 0,s=void 0,r=void 0,ka=void 0,N=void 0,J=void 0,aa=void 0,xa=void 0,ia=void 0,
v=void 0,n=w=r=void 0,n=A.x-k.x,wa=A.y-k.y,w=p.x-A.x,s=p.y-A.y,r=k.x-p.x,ka=k.y-p.y,N=t.x-p.x,J=t.y-p.y,aa=t.x-k.x,xa=t.y-k.y,ia=t.x-A.x,v=t.y-A.y,n=n*xa-wa*aa,r=r*J-ka*N,w=w*v-s*ia;if(0<=n&&0<=w&&0<=r){l=!1;break a}}l=!0}}if(l){f=u[m];m=u[b];F=u[F];a.clockWise?(q.push(c[f]),q.push(c[m]),q.push(c[F])):(q.push(c[F]),q.push(c[m]),q.push(c[f]));g++;F=b;for(f=b+1;f<h;F++,f++)u[F]=u[f];h--;f=2*h}}e.indices=q}var h,q=[],e,m=[],g,l,k,p,n,t={};h=function(a){return a&&a.length&&Array.isArray(a)?!Array.isArray(a[0])||
Array.isArray(a[0])&&!isNaN(a[0][0])?[a]:a:[]}(a);for(g=0;g<h.length;g++){a=h[g];n=null;e={vertices:[],edges:[]};for(l=0;l<a.length;l++)k=a[l],"object"!==typeof k||isNaN(k.x)||isNaN(k.y)?2<=k.length&&!isNaN(k[0])&&!isNaN(k[1])&&(p={x:k[0],y:k[1],id:m.length}):p={x:k.x,y:k.y,id:m.length},p&&(n?(n.next=p,p.prev=n,p.next=e.vertices[0],e.vertices[0].prev=p):(e.head=p,p.next=p,p.prev=p),m.push(p),e.vertices.push(p),n=p);if(2<e.vertices.length)for(3===e.vertices.length&&(e.simple=!0),q.push(e),l=0;l<e.vertices.length;l++)p=
e.vertices[l],e.edges.push([p,p.next])}for(g=q.length-1;0<=g;g--)e=q[g],b(e);for(g=0;g<q.length;g++)e=q[g],e.clockWise=c(e),d(e);t.vertices=[];t.coords=[];for(g=0;g<m.length;g++)k=m[g],t.vertices.push(2*k.x-1),t.vertices.push(-2*k.y+1),t.vertices.push(-1),t.coords.push(k.x),t.coords.push(-1*k.y+1);t.vertices=new Float32Array(t.vertices);t.coords=new Float32Array(t.coords);t.indices=[];for(g=0;g<q.length;g++)for(e=q[g],l=0;l<e.indices.length;l++)k=e.indices[l],t.indices.push(k.id);t.indices=new Uint16Array(t.indices);
this.shape=t;this.gl&&f(t,this.gl)};G.prototype.destroy=function(){var a,b,c=this.hook;this.effect.destroy&&"function"===typeof this.effect.destroy&&this.effect.destroy.call(this);delete this.effect;ca[c]&&(ca[c].count--,ca[c].count||delete ca[c]);this.shader&&this.shader.destroy&&this.shader!==Q&&!ca[c]&&this.shader.destroy();delete this.shader;for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(b=this.inputElements[a],b.element.removeEventListener("change",b.listener,!0),b.element.removeEventListener("input",
b.listener,!0));for(a in this.sources)this.sources.hasOwnProperty(a)&&((b=this.sources[a])&&b.removeTarget&&b.removeTarget(this),delete this.sources[a]);for(;this.targets.length;)(b=this.targets.pop())&&b.removeSource&&b.removeSource(this);for(a in this)this.hasOwnProperty(a)&&"id"!==a&&delete this[a];for(a in z)z.hasOwnProperty(a)&&(b=z[a],b.node===this&&P.removeAlias(a));a=ha.indexOf(this);0<=a&&ha.splice(a,1);a=da[c].indexOf(this);0<=a&&da[c].splice(a,1);B.prototype.destroy.call(this)};sa=function(a){Object.defineProperties(this,
{original:{enumerable:!0,configurable:!0,get:function(){return a.source}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}},width:{enumerable:!0,configurable:!0,get:function(){return a.width}},height:{enumerable:!0,configurable:!0,get:function(){return a.height}}});this.render=function(){a.render()};this.update=function(){a.setDirty()};this.readPixels=function(b,c,d,h,q){return a.readPixels(b,c,d,h,q)};this.on=function(b,c){a.on(b,c)};this.off=function(b,c){a.off(b,c)};this.destroy=function(){var b,
c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=ga)};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};T=function(b,d,h){function q(a,b,d,h){var u=M[a];if(u.definition)if(u=u.definition.call(k,b,d,h))u=c(c({},M[a]),u);else return null;return u}function e(a){return k.source===a}var f=h||{},g=void 0===f.flip?!0:f.flip,m=
f.width,l=f.height,p=!1,k=this,A=!1,t,n;B.call(this);if(b&&"string"!==typeof b||!d&&0!==d)h&&"object"===typeof h||(h=d),d=b;"string"===typeof d&&isNaN(d)&&(d=a(d,["canvas","img","video"]));"string"===typeof b&&M[b]&&(n=q(b,d,h,!0))&&(this.hook=b,A=!0,p=n.deferTexture,this.plugin=n,this.compare=n.compare,this.checkDirty=n.checkDirty,n.source&&(d=n.source));if(!n&&d instanceof HTMLElement)"CANVAS"===d.tagName?(this.width=d.width,this.height=d.height,this.render=this.renderImageCanvas,A=!0,this.hook=
"canvas",this.compare=e):"IMG"===d.tagName&&(this.width=d.naturalWidth||1,this.height=d.naturalHeight||1,d.complete&&d.naturalWidth||(p=!0),d.addEventListener("load",function(){if(!k.isDestroyed){if(k.width!==d.naturalWidth||k.height!==d.naturalHeight)k.width=d.naturalWidth,k.height=d.naturalHeight,k.resize();k.setDirty();k.setReady()}},!0),this.render=this.renderImageCanvas,A=!0,this.hook="image",this.compare=e);else if(!n&&d instanceof WebGLTexture){if(r&&!r.isTexture(d))throw Error("Not a valid WebGL texture.");
isNaN(m)?isNaN(l)||(m=l):isNaN(l)&&(l=m);this.width=m;this.height=l;void 0===f.flip&&(g=!1);A=!0;this.texture=d;this.initialized=!0;this.hook="texture";this.compare=e;this.render=function(){}}if(!A&&!n)for(t in M)if(M.hasOwnProperty(t)&&M[t]&&(n=q(t,d,h,!1))){this.hook=t;A=!0;p=n.deferTexture;this.plugin=n;this.compare=n.compare;this.checkDirty=n.checkDirty;n.source&&(d=n.source);break}if(!A)throw Error("Unknown source type");this.source=d;void 0===this.flip&&(this.flip=g);this.targets=[];p||k.setReady();
this.pub=new sa(this);Y.push(this);aa[this.id]=this;R.push(this);ea[this.hook].push(this);R.length&&!S&&ia()};c(T,B);T.prototype.initialize=function(){var a;r&&!this.texture&&this.ready&&(a=r.createTexture(),r.bindTexture(r.TEXTURE_2D,a),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,
r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this.texture=a,this.allowRefresh=this.initialized=!0,this.setDirty())};T.prototype.initFrameBuffer=function(a){r&&(this.frameBuffer=new m(r,this.width,this.height,{texture:this.texture,useFloat:a}))};T.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};T.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};
T.prototype.resize=function(){var a,b;this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.framebuffer&&this.framebuffer.resize(this.width,this.height);this.emit("resize");this.setDirty();if(this.targets)for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};T.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};
T.prototype.render=function(){var a=this.source;r&&(a||0===a)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,r,J,K,Q)&&(this.dirty=!1,this.emit("render")))};T.prototype.renderImageCanvas=function(){var a=this.source;if(r&&a&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){r.bindTexture(r.TEXTURE_2D,this.texture);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,
this.flip);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a),this.dirty=!1,this.emit("render"),!0}catch(c){c.code===b.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,p.logger.error("Unable to access cross-domain image"))}return!1}};T.prototype.destroy=function(){var a,b;this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);for(r&&this.texture&&r.deleteTexture(this.texture);this.targets.length;)(a=this.targets.pop())&&
a.removeSource&&a.removeSource(this);a=R.indexOf(this);0<=a&&R.splice(a,1);a=ea[this.hook].indexOf(this);0<=a&&ea[this.hook].splice(a,1);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];B.prototype.destroy.call(this)};ja=function(a){Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(a.source)return a.source.pub},set:function(b){a.setSource(b)}},original:{enumerable:!0,configurable:!0,get:function(){return a.target}},width:{enumerable:!0,configurable:!0,
get:function(){return a.width},set:function(b){!isNaN(b)&&0<b&&a.width!==b&&(a.width=b,a.resize(),a.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return a.height},set:function(b){!isNaN(b)&&0<b&&a.height!==b&&(a.height=b,a.resize(),a.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}}});this.render=function(){a.render()};this.readPixels=function(b,c,d,h,q){return a.readPixels(b,c,d,h,q)};this.on=function(b,c){a.on(b,c)};this.off=function(b,
c){a.off(b,c)};this.go=function(b){a.go(b)};this.stop=function(){a.stop()};this.getTexture=function(){return a.frameBuffer.texture};this.destroy=function(){var b,c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=ga)};this.inputs=function(a){return{source:{type:"image"}}};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};
U=function(a,b,d){function h(a,b,d,q){var e=$[a];if(e.definition){e=e.definition.call(k,b,d,q);if(!e)return null;e=c(c({},$[a]),e);k.hook=J;A=!0;k.plugin=e;k.compare=e.compare;e.gl&&!k.gl&&(k.gl=e.gl,r||g(e.gl));k.gl===r&&(k.model=K,k.shader=Q)}return e}var e,f,l,k=this,A=!1,n,w,ka,N,J;B.call(this);if(a&&"string"!==typeof a||!b&&0!==b)d&&"object"===typeof d||(d=b),b=a;d=d||{};e=void 0===d.flip?!0:d.flip;f=parseInt(d.width,10);l=parseInt(d.height,10);w=d.debugContext;"string"===typeof a&&$[a]&&h(a,
b,d,!0);this.renderToTexture=d.renderToTexture;if(b instanceof WebGLFramebuffer)if(ka=b,d instanceof HTMLCanvasElement)b=d;else if(d instanceof WebGLRenderingContext)b=d.canvas;else if(d.canvas instanceof HTMLCanvasElement)b=d.canvas;else if(d.context instanceof WebGLRenderingContext)b=d.context.canvas;else throw Error("Must provide a canvas with WebGLFramebuffer target");if(b instanceof HTMLElement&&"CANVAS"===b.tagName){f=b.width;l=b.height;if(!r||r.canvas!==b&&d.allowSecondaryWebGL)n=s(b,{alpha:!0,
premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!0,debugContext:w});if(n)r&&r!==n?(this.gl=n,this.frameBuffer={frameBuffer:ka||null},this.shader=new t(this.gl,X,oa),this.model=q.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(r.TEXTURE_2D,this.texture),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),
this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(Z||(Z=this),r||g(n),this.render=this.renderWebGL,d.renderToTexture?r&&(this.frameBuffer=new m(r,f,l,!1)):this.frameBuffer={frameBuffer:ka||null});else{if(!d.allowSecondaryWebGL&&r&&r.canvas!==b)throw Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");this.render=ga;p.logger.log("Unable to create WebGL context.")}A=!0}if(!A)for(J in $)if($.hasOwnProperty(J)&&
$[J]&&h(J,b,d,!1))break;if(!A)throw Error("Unknown target type");la&&((N=la.get(b))?p.logger.warn("Target already in use by another instance",b,Object.keys(N).map(function(a){return N[a]})):(N={},la.set(b,N)),N[P.id]=P);this.target=b;this.transform=null;this.transformDirty=!0;this.flip=e;f&&(this.width=f);l&&(this.height=l);this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.auto=void 0!==d.auto?d.auto:qa;this.frames=0;this.pub=new ja(this);Y.push(this);aa[this.id]=
this;L.push(this)};c(U,B);U.prototype.setSource=function(a){a=x(a);a!==this.source&&(this.source&&this.source.removeTarget(this),this.source=a,a.addTarget(this),a&&(this.resize(),a.ready?this.setReady():this.setUnready()),this.setDirty())};U.prototype.setDirty=function(){this.dirty=!0;this.auto&&!S&&(S=va(ia))};U.prototype.resize=function(){if(this.target instanceof HTMLCanvasElement){if(this.width!==this.target.width||this.height!==this.target.height)this.target.width=this.width,this.target.height=
this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()}else this.plugin&&this.plugin.resize&&this.plugin.resize.call(this);!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))};U.prototype.setTransformDirty=function(){this.transformDirty=!0;this.setDirty()};U.prototype.go=function(){this.auto=!0;this.setDirty()};U.prototype.stop=function(){this.auto=
!1};U.prototype.render=function(){r&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,J,Q,K)};U.prototype.renderWebGL=function(){var a,b,c;this.resize();r&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||ba:this.transformDirty&&(a=this.transform,W.copy(a,this.source.cumulativeMatrix||ba),b=this.source.width/this.width,
c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),J(Q,K,this.uniforms,this.frameBuffer.frameBuffer,this),this.emit("render"),this.dirty=!1)};U.prototype.renderSecondaryWebGL=function(){var a,b,c;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),a=this.source.width,b=this.source.height,this.pixels&&this.pixels.length===a*b*4||(this.pixels=new Uint8Array(a*b*4)),this.source.readPixels(0,
0,a,b,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),a===this.width&&b===this.height?this.uniforms.transform=ba:this.transformDirty&&(a=this.transform,W.copy(a,ba),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),this.uniforms.source=this.texture,J(this.shader,this.model,this.uniforms,null,this),this.dirty=
!1)};U.prototype.removeSource=function(a){if(this.source===a||this.source===a.pub)this.source=null};U.prototype.destroy=function(){var a;this.source&&this.source.removeTarget&&this.source.removeTarget(this);la&&(a=la.get(this.target),delete a[P.id],Object.keys(a).length||la.delete(this.target));this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);delete this.source;delete this.target;delete this.pub;delete this.uniforms;delete this.pixels;delete this.auto;a=L.indexOf(this);0<=a&&L.splice(a,
1);B.prototype.destroy.call(this);this===Z&&(na.removeEventListener("webglcontextrestored",n,!1),v(),Z=null)};ta=function(b){function d(b,c,h){var q;q=e.inputElements[b];"string"===typeof h&&isNaN(h)&&("enum"===c.type?c.options.hasOwnProperty(h)||(h=a(h,["select"])):"number"===c.type||"boolean"===c.type?h=a(h,["input","select"]):"image"===c.type&&(h=a(h,["canvas","img","video"])));h instanceof HTMLInputElement||h instanceof HTMLSelectElement?(c=h.value,q&&q.element!==h&&(q.element.removeEventListener("change",
q.listener,!0),q.element.removeEventListener("input",q.listener,!0),delete e.inputElements[b],q=null),q||(q={element:h,listener:function(a){return function(){var c,d;c="checkbox"===h.type?h.checked:a.value;d=e.setInput(b,c);"color"===h.type&&(d=k(d));d!==c&&(a.value=d)}}(h)},e.inputElements[b]=q,"range"===h.type&&h.addEventListener("input",q.listener,!0),h.addEventListener("change",q.listener,!0)),q&&"checkbox"===h.type&&(c=h.checked)):(q&&(q.element.removeEventListener("change",q.listener,!0),q.element.removeEventListener("input",
q.listener,!0),delete e.inputElements[b]),c=h);e.setInput(b,c)}function h(a,b){Object.defineProperty(f,a,{configurable:!0,enumerable:!0,get:function(){return b.get.call(e)},set:function(c){d(a,b,c)}})}function q(a){return function(){a.apply(e,arguments)&&e.setTransformDirty()}}var e=b,f=this,g;Object.defineProperties(this,{transform:{enumerable:!0,configurable:!0,get:function(){return e.hook}},title:{enumerable:!0,configurable:!0,get:function(){return e.plugin.title||e.hook}},width:{enumerable:!0,
configurable:!0,get:function(){return e.width}},height:{enumerable:!0,configurable:!0,get:function(){return e.height}},id:{enumerable:!0,configurable:!0,get:function(){return e.id}},source:{enumerable:!0,configurable:!0,get:function(){return e.source&&e.source.pub},set:function(a){e.setSource(a)}}});for(g in e.methods)e.methods.hasOwnProperty(g)&&(this[g]=q(e.methods[g].bind(e)));for(g in e.inputs)e.inputs.hasOwnProperty(g)&&h(g,e.inputs[g]);this.update=function(){e.setDirty()};this.inputs=function(a){var b,
d;b=e.plugin.inputs;if(a){b=b[a];if(!b||b.method)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&!b[d].method&&(a[d]=this.inputs(d));return a};this.alias=function(a,b){e.alias(a,b);return this};this.on=function(a,b){e.on(a,b)};this.off=function(a,
b){e.off(a,b)};this.destroy=function(){var a,b;e.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=ga)};this.isDestroyed=function(){return e.isDestroyed};this.isReady=function(){return e.ready}};H=function(a,b){var d,h,q,f,g;this.matrix=new Float32Array(16);this.cumulativeMatrix=new Float32Array(16);this.ready=!1;this.height=this.width=1;this.seriously=P;this.transformRef=
O[a];this.hook=a;this.id=N;N++;this.options=b;this.sources=null;this.targets=[];this.inputElements={};this.inputs={};this.methods={};this.listeners={};this.uniforms=this.frameBuffer=this.texture=null;this.transformDirty=this.dirty=!0;this.transformed=this.isDestroyed=this.renderDirty=!1;this.plugin=c({},this.transformRef);this.transformRef.definition&&c(this.plugin,this.transformRef.definition.call(this,b));for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(h=this.plugin.inputs[d],
h.method&&"function"===typeof h.method?this.methods[d]=h.method:"function"===typeof h.set&&"function"===typeof h.get&&(this.inputs[d]=h));e(this.plugin);g=V[a];for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(h=this.plugin.inputs[d],"function"===typeof h.set&&"function"===typeof h.get&&"function"!==typeof h.method&&(q=h.get.call(this),f=void 0===h.defaultValue?q:h.defaultValue,f=h.validate.call(this,f,h,q),g&&void 0!==g[d]&&(f=h.validate.call(this,g[d],h,h.defaultValue,f),g[d]=f),
f!==q&&h.set.call(this,f)));Y.push(this);aa[this.id]=this;this.pub=new ta(this);pa.push(this);ma[a].push(this)};H.prototype.setDirty=function(){this.renderDirty=!0;B.prototype.setDirty.call(this)};H.prototype.setTransformDirty=function(){var a,b;this.renderDirty=this.dirty=this.transformDirty=!0;for(a=0;a<this.targets.length;a++)b=this.targets[a],b.setTransformDirty?b.setTransformDirty():b.setDirty()};H.prototype.resize=function(){var a;B.prototype.resize.call(this);this.plugin.resize&&this.plugin.resize.call(this);
for(a=0;a<this.targets.length;a++)this.targets[a].resize();this.setTransformDirty()};H.prototype.setSource=function(a){a=x(a);if(a!==this.source){if(E(a,this))throw Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this);this.source=a;a.addTarget(this);a&&a.ready?this.setReady():this.setUnready();this.resize()}};H.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};H.prototype.removeTarget=function(a){a=
this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1);this.targets&&this.targets.length&&this.resize()};H.prototype.setInput=function(a,b){var c,d,h;if(this.plugin.inputs.hasOwnProperty(a))return c=this.plugin.inputs[a],d=V[this.hook]&&void 0!==V[this.hook][a]?V[this.hook][a]:c.defaultValue,h=c.get.call(this),void 0===d&&(d=h),b=c.validate.call(this,b,c,d,h),c.set.call(this,b)&&this.setTransformDirty(),c.get.call(this)};H.prototype.alias=function(a,b){var c=this,d,h;if(0<=ya.indexOf(b))throw Error("'"+
b+"' is a reserved name and cannot be used as an alias.");if(this.plugin.inputs.hasOwnProperty(a)){b||(b=a);P.removeAlias(b);if(d=this.inputs[a])h=c.inputs[a],Object.defineProperty(P,b,{configurable:!0,enumerable:!0,get:function(){return h.get.call(c)},set:function(a){h.set.call(c,a)&&c.setTransformDirty()}});else if(d=this.methods[a])h=d,P[b]=function(){h.apply(c,arguments)&&c.setTransformDirty()};d&&(z[b]={node:this,input:a})}return this};H.prototype.render=function(a){if(this.source)return this.source.render(),
this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?W.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):W.copy(this.cumulativeMatrix,this.matrix):W.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||ba),this.transformDirty=!1),a&&r?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,this.height]},this.frameBuffer=new m(r,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||
ba,J(Q,K,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.texture=this.source?this.source.texture:null,this.dirty=!1,this.texture;this.transformDirty&&(W.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=!1);this.texture=null;this.dirty=!1};H.prototype.readPixels=function(a,b,c,d,h){var q=this.gl||r;if(!r)throw Error("Cannot read pixels until a canvas is connected");this.render(!0);if(void 0===h)h=new Uint8Array(c*d*4);else if(!h instanceof
Uint8Array)throw Error("Incompatible array type");q.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer.frameBuffer);q.readPixels(a,b,c,d,r.RGBA,r.UNSIGNED_BYTE,h);return h};H.prototype.destroy=function(){var a,b,c,d=this.hook;this.plugin.destroy&&"function"===typeof this.plugin.destroy&&this.plugin.destroy.call(this);delete this.effect;this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture);for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(c=this.inputElements[a],
c.element.removeEventListener("change",c.listener,!0),c.element.removeEventListener("input",c.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(c=this.targets.pop())&&c.removeSource&&c.removeSource(this);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];for(b in z)z.hasOwnProperty(b)&&(c=z[b],c.node===this&&P.removeAlias(b));a=pa.indexOf(this);0<=a&&pa.splice(a,1);a=ma[d].indexOf(this);0<=a&&ma[d].splice(a,1);B.prototype.destroy.call(this)};H.prototype.setReady=
B.prototype.setReady;H.prototype.setUnready=B.prototype.setUnready;H.prototype.on=B.prototype.on;H.prototype.off=B.prototype.off;H.prototype.emit=B.prototype.emit;d=d instanceof HTMLCanvasElement?{canvas:d}:d||{};this.effect=function(a,b){if(!I[a])throw Error("Unknown effect: "+a);return(new G(a,b)).pub};this.source=function(a,b,c){return x(a,b,c).pub};this.transform=function(a,b){"string"!==typeof a&&(b=a,a=!1);if(a){if(!O[a])throw Error("Unknown transform: "+a);}else if(a=d&&d.defaultTransform||
"2d",!O[a])throw Error("No transform specified");return(new H(a,b)).pub};this.target=function(a,b,c){var d,h;a&&"string"===typeof a&&!$[a]&&(d=w.querySelector(a));if("string"!==typeof a||!b&&0!==b||d)c&&"object"===typeof c||(c=b),b=d||a,a=null;"string"===typeof b&&isNaN(b)&&(b=w.querySelector(b));for(h=0;h<L.length;h++)if(d=L[h],(!a||a===d.hook)&&(d.target===b||d.compare&&d.compare(b,c)))return d.pub;d=new U(a,b,c);return d.pub};this.aliases=function(){return Object.keys(z)};this.removeAlias=function(a){z[a]&&
(delete this[a],delete z[a])};this.defaults=function(a,b){var d;if(a)if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&this.defaults(d,a[d]);else null===b?delete V[a]:"object"===typeof b&&(V[a]=c({},b));else if(null===a)for(d in V)V.hasOwnProperty(d)&&delete V[d]};this.go=function(a,b){var c;"function"===typeof a&&0>C.indexOf(a)&&C.push(a);"function"===typeof b&&0>D.indexOf(b)&&D.push(b);qa=!0;for(c=0;c<L.length;c++)L[c].go();S||!C.length&&!D.length||ia()};this.stop=function(){C.length=0;D.length=
0;ua(S);S=0};this.render=function(){var a;for(a=0;a<L.length;a++)L[a].render(d)};this.destroy=function(){for(var a,b;Y.length;)b=Y.shift(),b.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=ga);P=X=oa=null;R=[];L=[];ha=[];Y=[];C.length=0;D.length=0;ua(S);S=0;ra=!0};this.isDestroyed=function(){return ra};this.incompatible=function(a){var b,c=!1;if(c=p.incompatible(a))return c;
if(!a){for(b in da)if(da.hasOwnProperty(b)&&da[b].length&&(a=I[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"plugin-"+b;for(b in ea)if(ea.hasOwnProperty(b)&&ea[b].length&&(a=M[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"source-"+b}return!1};this.isNode=function(a){return a&&(a=aa[a.id])&&!a.isDestroyed?!0:!1};this.isSource=function(a){return this.isNode(a)&&a instanceof sa};this.isEffect=function(a){return this.isNode(a)&&a instanceof fa};this.isTransform=
function(a){return this.isNode(a)&&a instanceof ta};this.isTarget=function(a){return this.isNode(a)&&a instanceof ja};Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return y}}});X="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
oa="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n}";this.defaults(d.defaults)}var w=b.document,x=b.console,v,E,y,I={},O={},M={},$={},X=[],da={},ma={},ea={canvas:[],image:[],video:[]},ja={},la=b.WeakMap&&new WeakMap,ba,za=0,ga=function(){},fa,qa={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,
128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},Aa=["x","y","z","w"],ra=["r","g","b","a"],W={frustum:function(a,b,c,d,e,f,g){g||(g=W.create());var m=b-a,k=d-c,l=f-e;g[0]=2*e/m;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*e/k;g[6]=0;g[7]=0;g[8]=(b+a)/m;g[9]=(d+c)/k;g[10]=-(f+e)/l;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(f*e*2)/l;g[15]=
0;return g},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return W.frustum(-b,b,-a,a,c,d,e)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],m=b[4],k=b[5],l=b[6],p=b[7],n=b[8],t=b[9],w=b[10],s=b[11],v=b[12],x=b[13],E=b[14];b=b[15];var y=c[0],z=c[1],C=c[2],D=c[3];a[0]=y*d+z*m+C*n+D*v;a[1]=y*e+z*k+C*t+D*x;a[2]=y*f+z*l+C*w+D*E;a[3]=y*g+z*p+C*s+D*b;y=c[4];z=c[5];C=c[6];D=c[7];a[4]=y*d+z*m+C*n+D*v;a[5]=y*e+z*k+C*t+D*x;a[6]=y*f+z*l+C*w+D*E;a[7]=y*g+z*p+C*s+D*b;y=c[8];z=c[9];
C=c[10];D=c[11];a[8]=y*d+z*m+C*n+D*v;a[9]=y*e+z*k+C*t+D*x;a[10]=y*f+z*l+C*w+D*E;a[11]=y*g+z*p+C*s+D*b;y=c[12];z=c[13];C=c[14];D=c[15];a[12]=y*d+z*m+C*n+D*v;a[13]=y*e+z*k+C*t+D*x;a[14]=y*f+z*l+C*w+D*E;a[15]=y*g+z*p+C*s+D*b;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=
b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},va=function(){var a=0;return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(c){var d,e,f;d=(new Date).getTime();e=Math.max(0,16-(d-a));f=b.setTimeout(function(){c(d+e)},e);a=d+e;return f}}(),ua=function(){return b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.oCancelAnimationFrame||b.msCancelAnimationFrame||
function(a){b.cancelTimeout(a)}}(),Ba="alias destroy effect id initialize inputs isDestroyed isReady matte off on readPixels render title update".split(" "),Ca="alias destroy id inputs isDestroyed isReady off on source title update".split(" "),ya=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect",,"isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];b.addEventListener("message",function(a){a.source===b&&"seriously-timeout-message"===
a.data&&(a.stopPropagation(),0<X.length&&X.shift()())},!0);m.prototype.resize=function(a,b){var c=this.gl;if(this.width!==a||this.height!==b)this.width=a,this.height=b,c&&(c.bindTexture(c.TEXTURE_2D,this.texture),c.bindFramebuffer(c.FRAMEBUFFER,this.frameBuffer),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,
c.TEXTURE_2D,this.texture,0),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null))};m.prototype.destroy=function(){var a=this.gl;a&&(a.deleteFramebuffer(this.frameBuffer),a.deleteRenderbuffer(this.renderBuffer),this.ownTexture&&a.deleteTexture(this.texture));delete this.frameBuffer;delete this.renderBuffer;delete this.texture;delete this.gl};t.prototype.use=function(){this.gl.useProgram(this.program)};p.incompatible=function(a){var c,d;void 0===
y&&((c=w.createElement("canvas"))&&c.getContext?b.WebGLRenderingContext?(d=n())||(y="context"):y="webgl":y="canvas");if(y)return y;if(a){if((c=I[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"plugin-"+a;if((c=M[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"source-"+a}return!1};p.plugin=function(a,b,d){if(I[a])p.logger.warn("Effect ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=
Ba,d.inputs&&e(d),d.title||(d.title=a),I[a]=d,da[a]=[],d};p.removePlugin=function(a){var b,c;if(!a||!I[a])return this;if(b=da[a]){for(;b.length;)c=b.shift(),c.destroy();delete da[a]}delete I[a];return this};p.source=function(a,b,d){if(M[a])p.logger.warn("Source ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),M[a]=d,ea[a]=[],d};p.removeSource=function(a){var b,c;if(!a||!M[a])return this;if(b=
ea[a]){for(;b.length;)c=b.shift(),c.destroy();delete ea[a]}delete M[a];return this};p.transform=function(a,b,d){if(O[a])p.logger.warn("Transform ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=Ca,d.inputs&&e(d),d.title||(d.title=a),O[a]=d,ma[a]=[],d};p.removeTransform=function(a){var b,c;if(!a||!O[a])return this;if(b=ma[a]){for(;b.length;)c=b.shift(),c.destroy();delete ma[a]}delete O[a];return this};p.target=
function(a,b,d){if($[a])p.logger.warn("Target ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),$[a]=d,ja[a]=[],d};p.removeTarget=function(a){var b,c;if(!a||!$[a])return this;if(b=ja[a]){for(;b.length;)c=b.shift(),c.destroy();delete ja[a]}delete $[a];return this};p.inputValidators={color:function(a,c,d,e){var m;d=e||[];if("string"===typeof a){if((m=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i.exec(a))&&
m.length){if(3>m.length)return d[0]=d[1]=d[2]=d[3]=0,d;d[3]=1;for(c=0;3>c;c++)d[c]=parseFloat(m[c+2])/255;isNaN(m[6])||(d[3]=parseFloat(m[6]));return"hsl"===m[1].toLowerCase()?f(d[0],d[1],d[2],d[3],d):d}if((m=/^#(([0-9a-fA-F]{3,8}))/.exec(a))&&m.length)return m=m[1],3===m.length?(d[0]=parseInt(m[0],16)/15,d[1]=parseInt(m[1],16)/15,d[2]=parseInt(m[2],16)/15,d[3]=1):4===m.length?(d[0]=parseInt(m[0],16)/15,d[1]=parseInt(m[1],16)/15,d[2]=parseInt(m[2],16)/15,d[3]=parseInt(m[3],16)/15):6===m.length?(d[0]=
parseInt(m.substr(0,2),16)/255,d[1]=parseInt(m.substr(2,2),16)/255,d[2]=parseInt(m.substr(4,2),16)/255,d[3]=1):8===m.length?(d[0]=parseInt(m.substr(0,2),16)/255,d[1]=parseInt(m.substr(2,2),16)/255,d[2]=parseInt(m.substr(4,2),16)/255,d[3]=parseInt(m.substr(6,2),16)/255):d[0]=d[1]=d[2]=d[3]=0,d;if(m=qa[a.toLowerCase()]){for(c=0;4>c;c++)d[c]=m[c];return d}E||(E=w.createElement("a"));E.style.backgroundColor="";E.style.backgroundColor=a;m=b.getComputedStyle(E);if((m=m.getPropertyValue("background-color")||
m.getPropertyValue("backgroundColor")||E.style.backgroundColor)&&m!==a)return p.inputValidators.color(m,c,e);d[0]=d[1]=d[2]=d[3]=0;return d}if(g(a)){d=a;if(3>d.length)return d[0]=d[1]=d[2]=d[3]=0,d;for(c=0;3>c;c++)if(isNaN(d[c]))return d[0]=d[1]=d[2]=d[3]=0,d;4>d.length&&d.push(1);return d}if("number"===typeof a)return d[0]=d[1]=d[2]=a,d[3]=1,d;if("object"===typeof a){for(c=0;4>c;c++)m=ra[c],null===a[m]||isNaN(a[m])?d[c]=3===c?1:0:d[c]=a[m];return d}d[0]=d[1]=d[2]=d[3]=0;return d},number:function(a,
b,c){if(isNaN(a))return c||0;a=parseFloat(a);return a<b.min?b.min:a>b.max?b.max:b.step?Math.round(a/b.step)*b.step:a},"enum":function(a,b,c){b=b.options||[];"string"===typeof a?a=a.toLowerCase():"number"===typeof a?a=a.toString():a||(a="");return b.hasOwnProperty(a)?a:c||""},vector:function(a,b,c,d){var e;b=b.dimensions||4;d=d||[];if(g(a)){for(c=0;c<b;c++)d[c]=a[c]||0;return d}if("object"===typeof a){for(c=0;c<b;c++)e=Aa[c],void 0===a[e]&&(e=ra[c]),d[c]=a[e]||0;return d}a=parseFloat(a)||0;for(c=0;c<
b;c++)d[c]=a;return d},"boolean":function(a){return!a||a&&a.toLowerCase&&"false"===a.toLowerCase()?!1:!0},string:function(a){return"string"===typeof a?a:0===a||a?a.toString?a.toString():String(a):""}};p.prototype.effects=p.effects=function(){var a,b,c,d={},e,m;for(a in I)if(I.hasOwnProperty(a)){b=I[a];c={title:b.title||a,description:b.description||"",inputs:{}};for(m in b.inputs)b.inputs.hasOwnProperty(m)&&(e=b.inputs[m],c.inputs[m]={type:e.type,defaultValue:e.defaultValue,step:e.step,min:e.min,max:e.max,
minCount:e.minCount,maxCount:e.maxCount,dimensions:e.dimensions,title:e.title||m,description:e.description||"",options:e.options||[]});d[a]=c}return d};b.Float32Array&&(ba=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));b.Seriously&&"object"===typeof b.Seriously&&function(){for(var a in b.Seriously)b.Seriously.hasOwnProperty(a)&&"plugin"!==a&&"object"===typeof b.Seriously[a]&&p.plugin(a,b.Seriously[a])}();p.logger={log:d("log"),info:d("info"),warn:d("warn"),error:d("error")};p.util={mat4:W,checkSource:function(c){var d,
e;c=a(c,["img","canvas","video"]);if(!c)return!1;d=w.createElement("canvas");if(!d)return p.logger.warn("Browser does not support canvas or Seriously.js"),!1;if(0===c.naturalWidth&&"IMG"===c.tagName)return p.logger.warn("Image not loaded"),!1;if(0===c.readyState&&0===c.videoWidth&&"VIDEO"===c.tagName)return p.logger.warn("Video not loaded"),!1;if(e=n()){(d=e.createTexture())||p.logger.error("Test WebGL context has been lost");e.bindTexture(e.TEXTURE_2D,d);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,
e.UNSIGNED_BYTE,c)}catch(m){return m.code===b.DOMException.SECURITY_ERR?p.logger.log("Unable to access cross-domain image"):p.logger.error("Error storing image to texture: "+m.message),e.deleteTexture(d),!1}e.deleteTexture(d)}else{e=d.getContext("2d");try{e.drawImage(c,0,0),e.getImageData(0,0,1,1)}catch(f){return f.code===b.DOMException.SECURITY_ERR?p.logger.log("Unable to access cross-domain image"):p.logger.error("Error drawing image to canvas: "+f.message),!1}}return!0},hslToRgb:f,colors:qa,setTimeoutZero:l,
ShaderProgram:t,FrameBuffer:m,requestAnimationFrame:va,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}};p.source("video",function(a,c,d){function e(){a.removeEventListener("loadedmetadata",
e,!0);if(!n)if(a.videoWidth){if(g.width!==a.videoWidth||g.height!==a.videoHeight)g.width=a.videoWidth,g.height=a.videoHeight,g.resize();t&&g.setReady()}else t=!0,setTimeout(e,50)}function m(){s=!0}function f(){s=!1;g.setDirty()}var g=this,k,l,n=!1,t=!1,s=!1,v=0;if(a instanceof b.HTMLVideoElement)return a.readyState?e():(t=!0,a.addEventListener("loadedmetadata",e,!0)),a.addEventListener("seeking",m,!1),a.addEventListener("seeked",f,!1),{deferTexture:t,source:a,render:function N(c){var d,e;v=a.currentTime;
if(!a.videoHeight||!a.videoWidth)return!1;fa?(l||(l=w.createElement("canvas").getContext("2d"),k=l.canvas,k.width=g.width,k.height=g.height),d=k,l.drawImage(a,0,0,g.width,g.height)):d=a;c.bindTexture(c.TEXTURE_2D,g.texture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,g.flip);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,d);if(void 0===fa){e=c.getError();if(e===c.INVALID_VALUE)return fa=!0,N(c);fa=!1}return!0}catch(m){m.code===b.DOMException.SECURITY_ERR?
(g.allowRefresh=!1,p.logger.error("Unable to access cross-domain image")):p.logger.error("Error rendering video source",m)}return!1},checkDirty:function(){return!s&&a.currentTime!==v},compare:function(a){return g.source===a},destroy:function(){n=!0;a.removeEventListener("seeking",m,!1);a.removeEventListener("seeked",f,!1);a.removeEventListener("loadedmetadata",e,!0)}}},{title:"Video"});p.transform("2d",function(a){function b(){function a(b,c){h[12]=h[0]*b+h[4]*c+h[12];h[13]=h[1]*b+h[5]*c+h[13];h[14]=
h[2]*b+h[6]*c+h[14];h[15]=h[3]*b+h[7]*c+h[15]}var h=c.matrix,w,s,v,x,y,E,A,I,O,r;k||l||p||n||t||1!==g||1!==f?(W.identity(h),a(k+e,l+m),n&&(h[4]=n/c.width),t&&(h[1]=t/c.height),p&&(v=h[0],x=h[1],y=h[2],E=h[3],A=h[4],I=h[5],O=h[6],r=h[7],w=-(d?p*Math.PI/180:p),s=Math.sin(w),w=Math.cos(w),h[0]=v*w+A*s,h[1]=x*w+I*s,h[2]=y*w+O*s,h[3]=E*w+r*s,h[4]=A*w-v*s,h[5]=I*w-x*s,h[6]=O*w-y*s,h[7]=r*w-E*s),1!==g&&(h[0]*=g,h[1]*=g,h[2]*=g,h[3]*=g),1!==f&&(h[4]*=f,h[5]*=f,h[6]*=f,h[7]*=f),a(-e,-m),c.transformed=!0):
c.transformed=!1}var c=this,d=!(a&&a.radians),e=0,m=0,g=1,f=1,k=0,l=0,p=0,n=0,t=0;return{inputs:{reset:{method:function(){m=e=0;f=g=1;t=n=p=l=k=0;return c.transformed?(c.transformed=!1,!0):!1}},translate:{method:function(a,c){isNaN(a)&&(a=k);isNaN(c)&&(c=l);if(a===k&&c===l)return!1;k=a;l=c;b();return!0},type:["number","number"]},translateX:{get:function(){return k},set:function(a){if(a===k)return!1;k=a;b();return!0},type:"number"},translateY:{get:function(){return l},set:function(a){if(a===l)return!1;
l=a;b();return!0},type:"number"},rotation:{get:function(){return p},set:function(a){if(a===p)return!1;p=parseFloat(a);b();return!0},type:"number"},center:{method:function(a,c){isNaN(a)&&(a=e);isNaN(c)&&(c=m);if(a===e&&c===m)return!1;e=a;m=c;b();return!0},type:["number","number"]},centerX:{get:function(){return e},set:function(a){if(a===e)return!1;e=a;b();return!0},type:"number"},centerY:{get:function(){return m},set:function(a){if(a===m)return!1;m=a;b();return!0},type:"number"},skew:{method:function(a,
c){isNaN(a)&&(a=n);isNaN(c)&&(c=t);if(a===n&&c===t)return!1;n=a;t=c;b();return!0},type:["number","number"]},skewX:{get:function(){return n},set:function(a){if(a===n)return!1;n=a;b();return!0},type:"number"},skewY:{get:function(){return t},set:function(a){if(a===t)return!1;t=a;b();return!0},type:"number"},scale:{method:function(a,c){var d,e;d=isNaN(a)?g:a;if(isNaN(c)){if(isNaN(a))return!1;e=d}else e=c;if(d===g&&e===f)return!1;g=d;f=e;b();return!0},type:["number","number"]},scaleX:{get:function(){return g},
set:function(a){if(a===g)return!1;g=a;b();return!0},type:"number"},scaleY:{get:function(){return f},set:function(a){if(a===f)return!1;f=a;b();return!0},type:"number"}}}},{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"});p.transform("flip",function(){function a(){var d=b.matrix;c?(d[0]=-1,d[5]=1):(d[0]=1,d[5]=-1)}var b=this,c=!0;W.identity(b.matrix);a();b.transformDirty=!0;b.transformed=!0;return{inputs:{direction:{get:function(){return c?"horizontal":"vertical"},set:function(b){b=
"vertical"===b?!1:!0;if(b===c)return!1;c=b;a();return!0},type:"string"}}}},{title:"Flip",description:"Flip Horizontal/Vertical"});p.transform("reformat",function(){function a(){var b=d.matrix,c=e||d.width,f=m||d.height,h=d.source,k=h&&h.width||1,h=h&&h.height||1,l,p;"distort"===g||c===k&&f===h?d.transformed=!1:(l=k/h,p=c/f,"none"===g?(c=k/c,f=h/f):"width"===g||"contain"===g&&p<=l?(c=1,f=p/l):"height"===g||"contain"===g&&p>l?(c=l/p,f=1):p>l?(c=1,f=p/l):(c=l/p,f=1),1===c&&1===f?d.transformed=!1:(W.identity(b),
1!==c&&(b[0]*=c,b[1]*=c,b[2]*=c,b[3]*=c),1!==f&&(b[4]*=f,b[5]*=f,b[6]*=f,b[7]*=f),d.transformed=!0))}function b(){return e||d.source&&d.source.width||1}function c(){return m||d.source&&d.source.height||1}var d=this,e,m,g="contain";this.resize=function(){var d=b(),e=c();if(this.width!==d||this.height!==e)for(this.width=d,this.height=e,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=d,this.uniforms.resolution[1]=e),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(d,
e),d=0;d<this.targets.length;d++)this.targets[d].resize();this.setTransformDirty();a()};return{inputs:{width:{get:b,set:function(a){a=Math.floor(a);if(a===e)return!1;e=a;this.resize();return!1},type:"number"},height:{get:c,set:function(a){a=Math.floor(a);if(a===m)return!1;m=a;this.resize();return!1},type:"number"},mode:{get:function(){return g},set:function(b){if(b===g)return!1;g=b;a();return!0},type:"enum",options:"cover contain distort width height none".split(" ")}}}},{title:"Reformat",description:"Change output dimensions"});
p.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n";
p.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n";
p.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n";
p.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n";
return p});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("array",function(a,b,d){var f,k,g;if(b&&(Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a))if(f=b.width,k=b.height,f&&k)if(f*k*4!==a.length){if(d)throw"Array length must be height x width x 4.";}else return this.width=f,this.height=k,void 0===b.flip&&(this.flip=!1),a instanceof Uint8Array||(g=new Uint8Array(a.length)),{render:function(b){var c;
if(this.dirty){if(g)for(c=0;c<g.length;c++)g[c]=a[c];b.bindTexture(b.TEXTURE_2D,this.texture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.width,this.height,0,b.RGBA,b.UNSIGNED_BYTE,g||a);this.lastRenderTime=Date.now()/1E3;return!0}}};else if(d)throw"Height and width must be provided with an Array";},{title:"Array",description:"Array or Uint8Array"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,c=window.URL||window.webkitURL||window.mozURL||window.msURL;b.source("camera",function(d,f,k){function g(){n&&(n.pause(),n.src="",n.load());t&&t.stop&&t.stop();t=null}function l(){m||(n.videoWidth?(s.width=n.videoWidth,s.height=n.videoHeight,s.setReady()):
setTimeout(l,50))}var s=this,n,e,m=!1,t,p=0;if(k){if(!a)throw"Camera source type unavailable. Browser does not support getUserMedia";f={};if(d&&"object"===typeof d)for(e in d)d.hasOwnProperty(e)&&(f[e]=d[e]);f.video||(f.video=!0);n=document.createElement("video");a.call(navigator,f,function(a){t=a;m?g():(n.mozCaptureStream?n.mozSrcObject=t:n.src=c&&c.createObjectURL(t)||t,n.readyState?l():n.addEventListener("loadedmetadata",l,!1),n.play())},function(a){console.log("Unable to access video camera",
a)});return{deferTexture:!0,source:n,render:function(a){p=n.currentTime;a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.flip);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,n),!0}catch(c){b.logger.error("Error rendering camera video source",c)}return!1},checkDirty:function(){return n.currentTime!==p},destroy:function(){m=!0;g()}}}},{compatible:function(){return!!a},title:"Camera"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(a,b,c,g,l){a=new Uint8Array(a,b,l);c=new Uint8Array(c,g,l);a.set(c)}var c=/GDepth:Data="([\S]*)"/;b.source("depth",function(d,f,k){function g(){t||(s.width=m.naturalWidth,s.height=m.naturalHeight,s.setReady())}function l(d){var e=new Uint8Array(d),f=[],k="",l,n,t,s;if(255==e[0]&&216==e[1]){for(l=0;l<e.byteLength;l++)255===e[l]&&
225===e[l+1]&&(f.push(l),l++);f.push(e.byteLength);for(l=0;l<f.length-1;l++)255===e[f[l]]&&225===e[f[l]+1]&&(t=256*e[f[l]+2]+e[f[l]+3],s=79,s>t&&(s=0),t+=2,n=new ArrayBuffer(t-s),a(n,0,d,f[l]+s,t-s),n=String.fromCharCode.apply(null,new Uint8Array(n)),k+=n);d=c.exec(k);if(null===d)return b.logger.error("JPEG file does not include depth image."),!1;m||(m=document.createElement("img"));m.src="data:image/png;base64,"+d[1];m.complete&&m.naturalWidth?g():(m.addEventListener("load",g,!0),m.addEventListener("error",
function(a){b.logger.error("Error loading depth image.",a)},!0))}else return b.logger.error("Unable to load depth image. File is not a JPEG."),!1}var s=this,n,e,m,t=!1;if(k)return n="string"===typeof d?document.querySelector(d):d,n instanceof window.ArrayBuffer?l(d):f&&f.url?e=f.url:n&&n instanceof window.HTMLImageElement&&("IMG"===n.tagName||k)&&(e=n.src),e||"string"!==typeof d||(e=d),e&&(m=document.createElement("img"),d=new XMLHttpRequest,d.open("GET",e,!0),d.responseType="arraybuffer",d.onload=
function(){l(this.response)},d.send()),m?{deferTexture:!0,source:m,render:Object.getPrototypeOf(this).renderImageCanvas,destroy:function(){t=!0}}:!1},{title:"Depth Image"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("imagedata",function(a){if(a instanceof Object&&a.data&&a.width&&a.height&&a.width*a.height*4===a.data.length)return this.width=a.width,this.height=a.height,{render:function(b){if(this.dirty)return b.bindTexture(b.TEXTURE_2D,this.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,
a),this.lastRenderTime=Date.now()/1E3,!0}}},{title:"ImageData",description:"2D Canvas ImageData"})});var require,canvas;
(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){var c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),d=b.util.mat4;b.target("three",function(b,k,g){function l(){e&&n&&!s.initialized&&(s.initialized=!0,s.allowRefresh=!0,s.setReady())}var s=this,n,e;if(a&&b instanceof a.WebGLRenderTarget){if(s.gl)n=s.gl;else if(k)if(k.gl)n=k.gl;else if(k.canvas){try{n=
canvas.getContext("webgl")}catch(m){}if(!n)try{n=canvas.getContext("experimental-webgl")}catch(t){}}if(!n)throw Error("Failed to create Three.js target. Missing WebGL context");this.ready=!1;this.width=b.width;this.height=b.height;if(b.__webglFramebuffer){if(!n.isFramebuffer(b.__webglFramebuffer))throw Error("Failed to create Three.js target. WebGL texture is from a different context");e=b.__webglFramebuffer;l()}else Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,get:function(){return e},
set:function(a){a&&(e=a,l())}});this.setReady=function(){e&&this.source&&this.source.ready&&!this.ready&&(this.emit("ready"),this.ready=!0)};this.target=b;return{gl:n,resize:function(){this.width=b.width;this.height=b.height},render:function(a,g,m){var l,k,t;if(n&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||c:this.transformDirty&&
(l=this.transform,d.copy(l,this.source.cumulativeMatrix||c),k=this.source.width/this.width,t=this.source.height/this.height,l[0]*=k,l[1]*=k,l[2]*=k,l[3]*=k,l[4]*=t,l[5]*=t,l[6]*=t,l[7]*=t,this.uniforms.transform=l,this.transformDirty=!1),a(g,m,this.uniforms,e,this),this.emit("render"),this.dirty=!1,b.onUpdate))b.onUpdate()},destroy:function(){Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,value:e})}}}},{title:"THREE.js WebGLRenderTarget Target"});b.source("three",function(b,
c,d){function l(){var a=b.__webglTexture,c=s.gl;if(a&&c&&!s.initialized){if(!c.isTexture(a))throw Error("Failed to create Three.js source. WebGL texture is from a different context");s.texture=a;s.initialized=!0;s.allowRefresh=!0;s.setReady()}}var s=this,n=this.setDirty;if(a&&b instanceof a.WebGLRenderTarget)return c=b.width,d=b.height,this.width=c,this.height=d,l(),this.initialized||(this.setDirty=function(){l();this.initialized&&(this.setDirty=n);n.call(this)}),{deferTexture:!this.initialized,render:function(a){this.lastRenderTime=
Date.now()/1E3;this.dirty=!1;this.emit("render")}}},{title:"Three.js WebGLRenderTarget Source"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var f={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return f[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:!0};b.plugin("accumulator",function(){var a={clear:!1},k,g=0;return{initialize:function(a,
c){a();k=[this.frameBuffer,new b.util.FrameBuffer(c,this.width,this.height)]},shader:function(a,b){var g=a.blendMode||"normal",g=g.toLowerCase();b.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[g],d[g]?"#define MIX_ALPHA":"","varying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D previous;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(source, vTexCoord);\n\tvec4 bottomPixel = texture2D(previous, vTexCoord);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tfloat alpha;\n#ifdef MIX_ALPHA\n\t\talpha = topPixel.a * opacity;\n\t\talpha = alpha + bottomPixel.a * (1.0 - alpha);\n#else\n\t\talpha = bottomPixel.a;\n#endif\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), alpha);\n\t}\n}"].join("\n");
return b},resize:function(){k&&(k[0].resize(this.width,this.height),k[1].resize(this.width,this.height))},draw:function(b,c,d,e,m){this.uniforms.previous=this.frameBuffer.texture;g=(g+1)%2;this.frameBuffer=e=k[g];this.texture=e.texture;this.inputs.clear?m(this.baseShader,c,d,e.frameBuffer,null):m(b,c,d,e.frameBuffer,null,a)},destroy:function(){k&&(k[0].destroy(),k[1].destroy(),k.length=0)}}},{inPlace:!1,title:"Accumulator",description:"Draw on top of previous frame",inputs:{source:{type:"image",uniform:"source"},
clear:{type:"boolean",defaultValue:!1},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},blendMode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight",
"Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]]}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a,c;c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=";
a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("ascii",function(){function d(){n=p.height;s=p.width;e=Math.ceil(s/8);m=Math.ceil(n/8);t.resolution=p.uniforms.resolution;t.transform=a;k&&k.resize(e,m)}var f,k,g,l,s,n,e,m,t={},p=this;return{initialize:function(p){function n(){l.bindTexture(l.TEXTURE_2D,g);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);
l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,c);l.bindTexture(l.TEXTURE_2D,null)}var s=this;p();this.texture=this.frameBuffer.texture;l=this.gl;g=l.createTexture();c.naturalWidth?n():c.addEventListener("load",function(){n();s.setDirty()});t.letters=g;l.bindTexture(l.TEXTURE_2D,this.texture||this.frameBuffer&&this.frameBuffer.texture);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,
l.NEAREST);l.bindTexture(l.TEXTURE_2D,null);d();k=new b.util.FrameBuffer(l,e,m);l.bindTexture(l.TEXTURE_2D,k.texture);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);this.uniforms.transform=a;f=this.baseShader},commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D letters;\nuniform vec4 background;\nuniform vec2 resolution;\nconst vec3 lumcoeff = vec3(0.2125, 0.7154, 0.0721);\nconst vec2 fontSize = vec2(8.0, 8.0);\nvec4 lookup(float ascii) {\n\tvec2 pos = mod(vTexCoord * resolution, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);\n\treturn texture2D(letters, pos);\n}\nvoid main(void) {\n\tvec4 sample = texture2D(source, vTexCoord);\n\tvec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);\n\tfloat luma = dot(sample.rgb,lumcoeff);\n\tfloat char = floor(luma * 94.0) / 94.0;\n\tgl_FragColor = mix(background, clamped, lookup(char).r);\n}";
return b},resize:d,draw:function(a,b,c,d,g){g(f,b,c,k.frameBuffer,!1,{width:e,height:m,blend:!1});t.source=k.texture;t.background=c.background;g(a,b,t,d)},destroy:function(){k&&k.destroy();l&&g&&l.deleteTexture(g)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},background:{type:"color",uniform:"background",defaultValue:[0,0,0,1]}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("bleach-bypass",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n\tfloat luminance = dot(previousmix,lumcoeff);\n\tfloat mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\tvec4 branch1 = two * previousmix * myInput;\n\tvec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\tvec4 result = mix(branch1, branch2, vec4(mixamount) );\n\treturn mix(previousmix, result, amount);\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n\tgl_FragColor = overlay(luma, pixel, vec4(amount));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:'Bleach Bypass film treatment\nhttp://en.wikipedia.org/wiki/Bleach_bypass\nsee: "Saving Private Ryan", "Minority Report"'})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var e={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return e[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:["FUNC_ADD","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA"]},
f=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blend",function(){function a(){var b=n&&d[n.mode];b&&e&&(s.blendEquation=e[b[0]],s.srcRGB=e[b[1]],s.dstRGB=e[b[2]],s.srcAlpha=e[b[3]],s.dstAlpha=e[b[4]])}var b,l,s={clear:!1},n,e;this.resize=function(){var a,c;a=this.inputs.sizeMode;var d;d=this.inputs.bottom;var e=this.inputs.top;"bottom"===a||"top"===a?(c=this.inputs[a])?(a=c.width,c=c.height):c=a=1:d?e?(c="union"===a?Math.max:Math.min,a=c(d.width,e.width),c=c(d.height,e.height)):(a=
d.width,c=d.height):e?(a=e.width,c=e.height):c=a=1;if(this.width!==a||this.height!==c)this.width=a,this.height=c,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=c,this.frameBuffer&&this.frameBuffer.resize(a,c),this.emit("resize"),this.setDirty();this.uniforms.resBottom[0]=d&&d.width||1;this.uniforms.resBottom[1]=d&&d.height||1;this.uniforms.resTop[0]=e&&e.width||1;this.uniforms.resTop[1]=e&&e.height||1;b&&(d&&(l.resolution[0]=d.width,l.resolution[1]=d.height),e&&(b.resolution[0]=e.width,
b.resolution[1]=e.height));for(d=0;d<this.targets.length;d++)this.targets[d].resize()};this.uniforms.resTop=[1,1];this.uniforms.resBottom=[1,1];return{initialize:function(b){n=this.inputs;b();e=this.gl;a()},shader:function(a,e){var k=a.mode||"normal",k=k.toLowerCase();if(d[k])return b||(k=this.inputs.top,b={resolution:[k&&k.width||1,k&&k.height||1],targetRes:this.uniforms.resolution,source:k,transform:k&&k.cumulativeMatrix||f,opacity:this.inputs.opacity},k=this.inputs.bottom,l={resolution:[k&&k.width||
1,k&&k.height||1],targetRes:this.uniforms.resolution,source:k,transform:k&&k.cumulativeMatrix||f,opacity:1}),e.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 targetRes;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.xy *= resolution / targetRes;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n",
e.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor.a *= opacity;\n}",e;l=b=null;e.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resBottom;\nuniform vec2 resTop;\nvarying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordBottom = adjusted / resBottom + HALF;\n\ttexCoordTop = adjusted / resTop + HALF;\n}";
e.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[k],"varying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nuniform sampler2D top;\nuniform sampler2D bottom;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(top, texCoordTop);\n\tvec4 bottomPixel = texture2D(bottom, texCoordBottom);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), bottomPixel.a);\n\t}\n}"].join("\n");
return e},draw:function(a,c,f,k,n){d[this.inputs.mode]?(this.inputs.bottom?n(a,c,l,k):(e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,k),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)),this.inputs.top&&this.inputs.opacity&&n(a,c,b,k,null,s)):n(a,c,f,k)},requires:function(a){return this.inputs.opacity||"top"!==a?!0:!1},inputs:{top:{type:"image",uniform:"top",update:function(){b&&(b.source=this.inputs.top,b.transform=this.inputs.top.cumulativeMatrix||f);
this.resize()}},bottom:{type:"image",uniform:"bottom",update:function(){l&&(l.source=this.inputs.bottom,l.transform=this.inputs.bottom.cumulativeMatrix||f);this.resize()}},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1,updateSources:!0,update:function(a){b&&(b.opacity=a)}},sizeMode:{type:"enum",defaultValue:"bottom",options:["bottom","top","union","intersection"],update:function(){this.resize()}},mode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],
["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight",
"Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]],update:function(){a()}}}}},{inPlace:function(){return!!d[this.inputs.mode]},description:"Blend two layers",title:"Blend"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8,1],c=a.length-1,d=[1,0],f=[0,1],k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blur",function(g){var l,s,n,e={amount:0,inputScale:1,resolution:[this.width,this.height],transform:k,direction:null};return{initialize:function(a){a();if(a=this.gl)n=
this.baseShader,l=new b.util.FrameBuffer(a,this.width,this.height),s=new b.util.FrameBuffer(a,this.width,this.height)},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 direction;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\nvarying vec2 vTexCoord;\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = direction * (inputScale * amount * 5.0 / resolution);\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,g,k,w,x){var v,E,y,I,O={width:0,height:0,blend:!1},M=1;if(E=this.inputs.amount)if(0.01>=E)k.inputScale=1,k.direction=d,k.source=this.inputs.source.texture,x(b,g,k,l.frameBuffer),k.direction=f,k.source=l.texture,x(b,g,k,w);else for(e.amount=E,e.source=this.inputs.source.texture,k=0;k<a.length;k++)v=Math.min(1,a[k]/E),y=Math.floor(v*this.width),I=Math.floor(v*this.height),e.resolution[0]=y,e.resolution[1]=I,e.inputScale=M,M=v,O.width=y,O.height=I,e.direction=d,x(b,g,e,l.frameBuffer,
null,O),e.inputScale=v,e.source=l.texture,e.direction=f,x(b,g,e,k===c?w:s.frameBuffer,null,O),e.source=s.texture;else k.source=this.inputs.source.texture,x(n,g,k,w)},resize:function(){e.resolution[0]=this.width;e.resolution[1]=this.height;l&&(l.resize(this.width,this.height),s.resize(this.width,this.height))},destroy:function(){l&&(l.destroy(),s.destroy(),s=l=null);e=null}}},{inputs:{source:{type:"image",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.2,min:0,max:1}},title:"Gaussian Blur"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("brightness-contrast",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float brightness;\nuniform float saturation;\nuniform float contrast;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 color = pixel.rgb * brightness;\n\tcolor = (color - half3) * contrast + half3;\n\tgl_FragColor = vec4(color, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},brightness:{type:"number",uniform:"brightness",defaultValue:1,min:0},contrast:{type:"number",uniform:"contrast",defaultValue:1,min:0}},title:"Brightness/Contrast",description:"Multiply brightness and contrast values. Works the same as CSS filters."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=["Red","Green","Blue","Alpha"],c={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};b.plugin("channels",function(){function d(a,b,d){"string"===typeof a?(b=a.charAt(0).toLowerCase(),b=c[b],void 0===b&&(b=-1),0>b&&(b=parseFloat(a))):b=a;return 0===b||1===b||2===b||3===b?b:n.inputs[d]}function f(){var a=
n.inputs,b,c,d,f;for(b=0;b<g.length;b++){d=g[b];f=s[b];f||(f=s[b]=[],n.uniforms["channels"+b]=f);for(c=0;16>c;c++)f[c]=0;f[a.red]=a.redSource===d?1:0;f[4+a.green]=a.greenSource===d?1:0;f[8+a.blue]=a.blueSource===d?1:0;f[12+a.alpha]=a.alphaSource===d?1:0}}function k(){function a(c){var d;d=b[c];d||(d=n.sources[c]=b[c]=b.source);c=g.indexOf(d);0>c&&(c=g.length,g.push(d),n.uniforms["source"+c]=d)}var b=n.inputs;g.length=0;a("redSource");a("greenSource");a("blueSource");a("alphaSource");n.resize();f()}
var g=[],l=[],s=[],n=this;this.resize=function(){var a,b;a=this.inputs.sizeMode;var c,d,f;if(g.length)if(1===g.length)f=g[0],a=f.width,b=f.height;else if("union"===a)for(c=b=a=0;c<g.length;c++)f=g[0],a=Math.max(a,f.width),b=Math.max(b,f.height);else if("intersection"===a)for(b=a=Infinity,c=0;c<g.length;c++)f=g[0],a=Math.min(a,f.width),b=Math.min(b,f.height);else(f=n.inputs[a+"Source"])?(a=f.width,b=f.height):b=a=1;else b=a=1;for(c=0;c<g.length;c++)f=g[c],(d=n.uniforms["resolution"+c])?(d[0]=f.width,
d[1]=f.height):n.uniforms["resolution"+c]=[f.width,f.height];if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty();for(c=0;c<this.targets.length;c++)this.targets[c].resize()};return{shader:function(){var a,c,d=c="",f="",k="";if(l[g.length])return l[g.length];for(a=0;a<g.length;a++)f+="varying vec2 vTexCoord"+a+";\n",c+="uniform sampler2D source"+a+
";\nuniform mat4 channels"+a+";\nuniform vec2 resolution"+a+";\n\n",k+="    vTexCoord"+a+" = (position.xy * resolution / resolution"+a+") * 0.5 + 0.5;\n",d+="    if (all(greaterThanEqual(vTexCoord"+a+", vec2(0.0))) && all(lessThan(vTexCoord"+a+", vec2(1.0)))) {\n        gl_FragColor += texture2D(source"+a+", vTexCoord"+a+") * channels"+a+";\n    }\n";a=["precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;",c,f,"void main(void) {",k,"\tgl_Position = position;\n}\n"].join("\n");
c=["precision mediump float;",f,c,"void main(void) {\n\tgl_FragColor = vec4(0.0);",d,"}"].join("\n");c=new b.util.ShaderProgram(this.gl,a,c);return l[g.length]=c},inputs:{sizeMode:{type:"enum",defaultValue:"red",options:"red green blue alpha union intersection".split(" "),update:function(){this.resize()}},source:{type:"image",update:k,shaderDirty:!0},redSource:{type:"image",update:k,shaderDirty:!0},greenSource:{type:"image",update:k,shaderDirty:!0},blueSource:{type:"image",update:k,shaderDirty:!0},
alphaSource:{type:"image",update:k,shaderDirty:!0},red:{type:"enum",options:a,validate:d,update:f,defaultValue:0},green:{type:"enum",options:a,validate:d,update:f,defaultValue:1},blue:{type:"enum",options:a,validate:d,update:f,defaultValue:2},alpha:{type:"enum",options:a,validate:d,update:f,defaultValue:3}}}},{inPlace:!1,title:"Channel Mapping"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("checkerboard",function(){function a(){b.resize()}var b=this;return{initialize:function(b){b();a()},shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 size;\nuniform vec2 anchor;\nvec2 pixelCoord;\nvarying vec2 vGridCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tpixelCoord = resolution * (texCoord - 0.5) / 2.0;\n\tvGridCoord = (pixelCoord - anchor) / size;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec2 vPixelCoord;\nvarying vec2 vGridCoord;\nuniform vec2 resolution;\nuniform vec2 anchor;\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvoid main(void) {\n\tvec2 modGridCoord = floor(mod(vGridCoord, 2.0));\n\tif (modGridCoord.x == modGridCoord.y) {\n\t\tgl_FragColor = color1;\n\t} else  {\n\t\tgl_FragColor = color2;\n\t}\n}";return b},inPlace:!0,inputs:{anchor:{type:"vector",uniform:"anchor",dimensions:2,defaultValue:[0,
0]},size:{type:"vector",uniform:"size",dimensions:2,defaultValue:[4,4]},color1:{type:"color",uniform:"color1",defaultValue:[1,1,1,1]},color2:{type:"color",uniform:"color2",defaultValue:[187/255,187/255,187/255,1]},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{commonShader:!0,title:"Checkerboard",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("chroma",{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform vec4 screen;\nuniform float balance;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat fmin = min(min(screen.r, screen.g), screen.b);\n\tfloat fmax = max(max(screen.r, screen.g), screen.b);\n\tfloat secondaryComponents;\n\tscreenPrimary = step(fmax, screen.rgb);\n\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);\n\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 screen;\nuniform float screenWeight;\nuniform float balance;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool mask;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat pixelSat, secondaryComponents;\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);\n\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);\n\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));\n\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);\n\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);\n\talpha = smoothstep(clipBlack, clipWhite, alpha);\n\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / alpha, alpha);\n\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);\n#ifdef MASK\n\tgl_FragColor = vec4(vec3(pixel.a), 1.0);\n#else\n\tgl_FragColor = pixel;\n#endif\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",
description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color",function(){function a(){c.resize()}var c=this,d={width:1,height:1},f=!0;this.resize=function(){var a,b;this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=
Math.floor(b);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};return{initialize:function(c){this.frameBuffer=new b.util.FrameBuffer(this.gl,1,1);a();f=!0},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nvoid main(void) {\n\tgl_Position = position;\n}\n";b.fragment="precision mediump float;\n\nuniform vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}";
return b},draw:function(a,b,c,s,n){f&&(n(a,b,c,s,null,d),f=!1)},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1],update:function(){f=!0}},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{title:"Color",description:"Generate color",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcomplements",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 guideColor;\nuniform float correlation;\nuniform float amount;\nuniform float concentration;\nfloat hueLerp(float h1, float h2, float v) {\n\tfloat d = abs(h1 - h2);\n\tif (d <= 0.5) {\n\t\treturn mix(h1, h2, v);\n\t} else if (h1 < h2) {\n\t\treturn fract(mix((h1 + 1.0), h2, v));\n\t} else {\n\t\treturn fract(mix(h1, (h2 + 1.0), v));\n\t}\n}\nvec3 rgbToHsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsvToRgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 hsvComplement(vec3 hsv) {\n\tvec3 compl = hsv;\n\tcompl.x = mod(compl.x - 0.5, 1.0);\n\treturn compl;\n}\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 hsv = rgbToHsv(pixel.rgb);\n\tvec3 hsvPole1 = rgbToHsv(guideColor.rgb);\n\tvec3 hsvPole2 = hsvPole1;\n\thsvPole2 = hsvComplement(hsvPole1);\n\tfloat dist1 = abs(hsv.x - hsvPole1.x);\n\tdist1 = dist1 > 0.5 ? 1.0 - dist1 : dist1;\n\tfloat dist2 = abs(hsv.x - hsvPole2.x);\n\tdist2 = dist2 > 0.5 ? 1.0 - dist2 : dist2;\n\tfloat descent = smoothstep(0.0, correlation, hsv.y);\n\tvec3 outputHsv = hsv;\n\tvec3 pole = dist1 < dist2 ? hsvPole1 : hsvPole2;\n\tfloat dist = min(dist1, dist2);\n\tfloat c = descent * amount * (1.0 - pow((dist * 2.0), 1.0 / concentration));\n\toutputHsv.x = hueLerp(hsv.x, pole.x, c);\n\toutputHsv.y = mix(hsv.y, pole.y, c);\n\tgl_FragColor = vec4(hsvToRgb(outputHsv), pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.8},concentration:{type:"number",uniform:"concentration",min:0.1,max:4,defaultValue:2},correlation:{type:"number",uniform:"correlation",min:0,max:1,defaultValue:0.5},guideColor:{type:"color",uniform:"guideColor",defaultValue:[1,0.5,0,1]}},title:"Color Complements",categories:["color"],description:"http://theabyssgazes.blogspot.com/2010/03/teal-and-orange-hollywood-please-stop.html"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcube",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform sampler2D source;\nuniform sampler2D colorCube;\nvarying vec2 vTexCoord;\nvec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {\n\tfloat sliceSize = 1.0 / size;\n\tfloat slicePixelSize = sliceSize / size;\n\tfloat sliceInnerSize = slicePixelSize * (size - 1.0);\n\tfloat zSlice0 = min(floor(coord.z * size), size - 1.0);\n\tfloat zSlice1 = min(zSlice0 + 1.0, size - 1.0);\n\tfloat xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;\n\tfloat s0 = xOffset + (zSlice0 * sliceSize);\n\tfloat s1 = xOffset + (zSlice1 * sliceSize);\n\tvec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;\n\tvec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;\n\tfloat zOffset = mod(coord.z * size, 1.0);\n\treturn mix(slice0Color, slice1Color, zOffset);\n}\nvoid main(void) {\n\tvec4 originalColor = texture2D(source, vTexCoord);\n\tvec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);\n\tgl_FragColor = vec4(color, originalColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color-select",{shader:function(a,b,d){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float hueMin;\nuniform float hueMax;\nuniform float hueMinFalloff;\nuniform float hueMaxFalloff;\nuniform float saturationMin;\nuniform float saturationMax;\nuniform float saturationMinFalloff;\nuniform float saturationMaxFalloff;\nuniform float lightnessMin;\nuniform float lightnessMax;\nuniform float lightnessMinFalloff;\nuniform float lightnessMaxFalloff;\nvarying vec2 vTexCoord;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tfloat hueOffset = hueMin - hueMinFalloff;\n\tadjustedHueRange = mod(vec4(hueOffset, hueMin - hueOffset, hueMax - hueOffset, hueMax + hueMaxFalloff - hueOffset), 360.0);\n\tif (hueMin != hueMax) {\n\t\tif (adjustedHueRange.z == 0.0) {\n\t\t\tadjustedHueRange.z = 360.0;\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t} else if (adjustedHueRange.w == 0.0) {\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t}\n\t}\n\tsaturationRange = vec4(saturationMin - saturationMinFalloff, saturationMin, saturationMax, saturationMax + saturationMaxFalloff );\n\tlightnessRange = vec4(lightnessMin - lightnessMinFalloff, lightnessMin, lightnessMax, lightnessMax + lightnessMaxFalloff );\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform bool mask;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvec3 calcHSL(vec3 c) {\n\tfloat minColor = min(c.r, min(c.g, c.b));\n\tfloat maxColor = max(c.r, max(c.g, c.b));\n\tfloat delta = maxColor - minColor;\n\tvec3 hsl = vec3(0.0, 0.0, (maxColor + minColor) / 2.0);\n\tif (delta > 0.0) {\n\t\tif (hsl.z < 0.5) {\n\t\t\thsl.y = delta / (maxColor + minColor);\n\t\t} else {\n\t\t\thsl.y = delta / (2.0 - maxColor - minColor);\n\t\t}\n\t\tif (c.r == maxColor) {\n\t\t\thsl.x = (c.g - c.b) / delta;\n\t\t} else if (c.g == maxColor) {\n\t\t\thsl.x = 2.0 + (c.b - c.r) / delta;\n\t\t} else {\n\t\t\thsl.x = 4.0 + (c.r - c.g) / delta;\n\t\t}\n\t\thsl.x = hsl.x * 360.0 / 6.0;\n\t\tif (hsl.x < 0.0) {\n\t\t\thsl.x += 360.0;\n\t\t} else {\n\t\t\thsl.x = mod(hsl.x, 360.0);\n\t\t}\n\t}\n\treturn hsl;\n}\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tvec3 hsl = calcHSL(color.rgb);\n\tfloat adjustedHue = mod(hsl.x - adjustedHueRange.x, 360.0);\n\tfloat maskValue;\n\tif (adjustedHue < adjustedHueRange.y) {\n\t\tmaskValue = smoothstep(0.0, adjustedHueRange.y, adjustedHue);\n\t} else if (adjustedHue < adjustedHueRange.z) {\n\t\tmaskValue = 1.0;\n\t} else {\n\t\tmaskValue = 1.0 - smoothstep(adjustedHueRange.z, adjustedHueRange.w, adjustedHue);\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.y < saturationRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(saturationRange.x, saturationRange.y, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(saturationRange.z, saturationRange.w, hsl.y));\n\t\t}\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.z < lightnessRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(lightnessRange.x, lightnessRange.z, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(lightnessRange.z, lightnessRange.w, hsl.z));\n\t\t}\n\t}\n\tif (mask) {\n\t\tgl_FragColor = vec4(maskValue, maskValue, maskValue, 1.0);\n\t} else {\n\t\tcolor.a = min(color.a, maskValue);\n\t\tgl_FragColor = color;\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hueMin:{type:"number",uniform:"hueMin",defaultValue:0},hueMax:{type:"number",uniform:"hueMax",defaultValue:360},hueMinFalloff:{type:"number",uniform:"hueMinFalloff",defaultValue:0,min:0},hueMaxFalloff:{type:"number",uniform:"hueMaxFalloff",defaultValue:0,min:0},saturationMin:{type:"number",uniform:"saturationMin",defaultValue:0,min:0,max:1},saturationMax:{type:"number",uniform:"saturationMax",defaultValue:1,min:0,max:1},saturationMinFalloff:{type:"number",
uniform:"saturationMinFalloff",defaultValue:0,min:0},saturationMaxFalloff:{type:"number",uniform:"saturationMaxFalloff",defaultValue:0,min:0},lightnessMin:{type:"number",uniform:"lightnessMin",defaultValue:0,min:0,max:1},lightnessMax:{type:"number",uniform:"lightnessMax",defaultValue:1,min:0,max:1},lightnessMinFalloff:{type:"number",uniform:"lightnessMinFalloff",defaultValue:0,min:0},lightnessMaxFalloff:{type:"number",uniform:"lightnessMaxFalloff",defaultValue:0,min:0},mask:{type:"boolean",defaultValue:!1,
uniform:"mask"}},title:"Color Select",description:"Create a mask by hue, saturation and lightness range."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("crop",function(){function a(){var a=1,f=1;b.source?(a=b.source.width,f=b.source.height):b.sources&&b.sources.source&&(a=b.sources.source.width,f=b.sources.source.height);a=a-b.inputs.left-b.inputs.right;f=f-b.inputs.top-b.inputs.bottom;a=Math.max(1,Math.floor(a));f=
Math.max(1,Math.floor(f));if(b.width!==a||b.height!==f)b.width=a,b.height=f,b.uniforms.resolution[0]=a,b.uniforms.resolution[1]=f,b.frameBuffer&&b.frameBuffer.resize(b.width,b.height),b.emit("resize"),b.setDirty();for(f=0;f<b.targets.length;f++)a=b.targets[f],a.resize(),a.setTransformDirty&&a.setTransformDirty()}var b=this;b.resize=a;return{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float top;\nuniform float left;\nuniform float bottom;\nuniform float right;\nvarying vec2 vTexCoord;\nconst vec2 ZERO = vec2(0.0);\nconst vec2 ONE = vec2(1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 dim = resolution + vec2(right + left, bottom + top);\n\tvec2 scale = dim / resolution;\n\tvec2 offset = vec2(left, bottom) / resolution;\n\tvTexCoord = max(ZERO, (texCoord + offset) / scale);\n}\n";
return b},inputs:{source:{type:"image",uniform:"source",update:a},top:{type:"number",uniform:"top",min:0,step:1,update:a,defaultValue:0},left:{type:"number",uniform:"left",min:0,step:1,update:a,defaultValue:0},bottom:{type:"number",uniform:"bottom",min:0,step:1,update:a,defaultValue:0},right:{type:"number",uniform:"right",min:0,step:1,update:a,defaultValue:0}}}},{inPlace:!0,title:"Crop"})});(function(b,a){if("function"===typeof define&&define.amd)define(["seriously"],a);else if("object"===typeof exports)a(require("seriously"));else{var c=b.Seriously;c||(c={plugin:function(a,b){this[a]=b}});a(c)}})(this,function(b){b.plugin("daltonize",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_Position = transform * vec4(position, 1.0);\n\tvTexCoord = vec2(texCoord.s, texCoord.t);\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float cbtype;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tif (cbtype == 0.0) {\n\t\tgl_FragColor = color;\n\t\treturn;\n\t}\n\tconst mat3 RGBLMS = mat3( \t\t17.8824, 43.5161, 4.11935,\t\t3.45565, 27.1554, 3.86714,\t\t0.0299566, 0.184309, 1.46709\t);\n\tvec3 LMS = color.rgb * RGBLMS;\n\tvec3 lms = vec3(0.0,0.0,0.0);\n\tif (cbtype < 0.33) {\n\t\tlms = vec3(\t\t\t\t(2.02344 * LMS.g) + (-2.52581 * LMS.b),\t\t\tLMS.g,\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.33 && cbtype < 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\t(0.494207 * LMS.r) + (1.24827 * LMS.b),\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\tLMS.g,\t\t\t(-0.395913 * LMS.r) + (0.801109 * LMS.g)\t\t);\n\t}\n\tconst mat3 LMSRGB = mat3(    \t\t0.0809444479, -0.130504409, 0.116721066,\t\t-0.0102485335, 0.0540193266, -0.113614708,\t\t-0.000365296938, -0.00412161469, 0.693511405\t);\n\tvec3 RGB = lms * LMSRGB;\n\tRGB.rgb = color.rgb - RGB.rgb;\n\tRGB.g = 0.7*RGB.r + RGB.g;\n\tRGB.b = 0.7*RGB.r + RGB.b;\n\tcolor.rgb = color.rgb + RGB.rgb;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},type:{title:"Type",type:"enum",uniform:"cbtype",defaultValue:"0.2",options:[["0.0","Off"],["0.2","Protanope"],["0.6","Deuteranope"],["0.8","Tritanope"]]}},title:"Daltonize",description:"Add contrast to colours to assist CVD (colour-blind) users."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8],c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("directionblur",function(d){var f,k,g={amount:0,angle:0,inputScale:1,resolution:[this.width,this.height],transform:c,projection:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};return{initialize:function(a){a();
(a=this.gl)&&(f=[new b.util.FrameBuffer(a,this.width,this.height),new b.util.FrameBuffer(a,this.width,this.height)])},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";k=this.baseShader;b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = vec2(cos(angle), sin(angle)) * amount * 5.0 / resolution;\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,c,d,e,m){var t,p,w,x,v,E={width:0,height:0,blend:!1},y=1;if(w=this.inputs.amount)if(0.01>=w)m(b,c,d,e);else{g.amount=w;g.angle=this.inputs.angle;g.projection[0]=this.height/this.width;for(d=0;d<a.length;d++)p=Math.min(1,a[d]/w),x=Math.floor(p*this.width),v=Math.floor(p*this.height),g.source=t?t.texture:this.inputs.source.texture,t=f[d%2],g.inputScale=y,y=p,E.width=x,E.height=v,m(b,c,g,t.frameBuffer,null,E);g.source=t.texture;g.inputScale=y;m(b,c,g,e)}else m(k,c,d,e)},resize:function(){g.resolution[0]=
this.width;g.resolution[1]=this.height;f&&(f[0].resize(this.width,this.height),f[1].resize(this.width,this.height))},destroy:function(){f&&(f[0].destroy(),f[1].destroy(),f=null);k&&k.destroy();g=null}}},{inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.4,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Directional Motion Blur"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a={wrap:"pos = mod(pos, 1.0);",clamp:"pos = min(max(pos, 0.0), 1.0);",ignore:"pos = texCoordSource;",color:"gl_FragColor = color;\n\treturn;"};b.plugin("displacement",function(){this.uniforms.resMap=[1,1];this.uniforms.resSource=[1,1];return{shader:function(b,d){var f=a[b.fillMode];
d.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resMap;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordMap = adjusted / resMap + HALF;\n}";d.fragment=["precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nuniform sampler2D source;\nuniform sampler2D map;\nuniform float amount;\nuniform float offset;\nuniform vec2 mapScale;\nuniform vec4 color;\nvoid main(void) {\n\tvec4 mapPixel = texture2D(map, texCoordMap);\n\tvec2 pos = texCoordSource + (mapPixel.xy - offset) * mapScale * amount;\n\tif (pos.x < 0.0 || pos.x > 1.0 || pos.y < 0.0 || pos.y > 1.0) {",
"\t\t"+f,"\t}\n\tgl_FragColor = texture2D(source, pos);\n}"].join("\n");return d},requires:function(a){return this.inputs.mapScale||"map"!==a?!0:!1},resize:function(){var a=this.inputs.source,b=this.inputs.map;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resMap[0]=b.width,this.uniforms.resMap[1]=b.height):(this.uniforms.resMap[0]=1,this.uniforms.resMap[1]=1)}}},{inputs:{source:{type:"image",
uniform:"source"},map:{type:"image",uniform:"map"},fillMode:{type:"enum",shaderDirty:!0,defaultValue:"color",options:["color","wrap","clamp","ignore"]},color:{type:"color",uniform:"color",defaultValue:[0,0,0,0]},offset:{type:"number",uniform:"offset",defaultValue:0.5},mapScale:{type:"vector",dimensions:2,uniform:"mapScale",defaultValue:[1,1],updateSources:!0},amount:{type:"number",uniform:"amount",defaultValue:1}},title:"Displacement Map",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("dither",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n#define mod4(a) (a >= 4 ? a - 4 : a)\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nconst mat4 dither = mat4(1.0, 33.0, 9.0, 41.0,49.0, 17.0, 57.0, 25.0,13.0, 45.0, 5.0, 37.0,61.0, 29.0, 53.0, 21.0);\nfloat find_closest(int x, int y, float c0) {\n\tfloat limit = 0.0;\n\tint x4 = mod4(x);\n\tint y4 = mod4(y);\n\tfor (int i = 0; i < 4; i++) {\n\t\tif (i == x4) {\n\t\t\tfor (int j = 0; j < 4; j++) {\n\t\t\t\tif (j == y4) {\n\t\t\t\t\tlimit = dither[i][j];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (x < 4) {\n\t\tif (y >= 4) {\n\t\t\tlimit += 3.0;\n\t\t}\n\t} else {\n\t\tif (y >= 4) {\n\t\t\tlimit += 1.0;\n\t\t} else {\n\t\t\tlimit += 2.0;\n\t\t}\n\t}\n\tlimit /= 65.0;\n\treturn c0 < limit ? 0.0 : 1.0;\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 coord = vTexCoord * resolution;\n\tint x = int(mod(coord.x, 8.0));\n\tint y = int(mod(coord.y, 8.0));\n\tpixel.r = find_closest(x, y, pixel.r);\n\tpixel.g = find_closest(x, y, pixel.g);\n\tpixel.b = find_closest(x, y, pixel.b);\n\tgl_FragColor = pixel;\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"}},title:"Dither"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b){var c;for(c=0;c<b.length;c++)b[c]*=a;return b}var c=Math.sqrt,d,f=[],k,g,l;k=[a(1/(2*c(2)),[1,c(2),1,0,0,0,-1,-c(2),-1]),a(1/(2*c(2)),[1,0,-1,c(2),0,-c(2),1,0,-1]),a(1/(2*c(2)),[0,-1,c(2),1,0,-1,-c(2),1,0]),a(1/(2*c(2)),[c(2),-1,0,-1,0,1,0,1,-c(2)]),a(0.5,[0,1,
0,-1,0,-1,0,1,0]),a(0.5,[-1,0,1,0,0,0,1,0,-1]),a(1/6,[1,-2,1,-2,4,-2,1,-2,1]),a(1/6,[-2,1,-2,1,4,1,-2,1,-2]),a(1/3,[1,1,1,1,1,1,1,1,1])];for(c=0;c<k.length;c++)for(d=0;d<k[c].length;d++)f.push(k[c][d]);g=new Float32Array(f);l=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]);b.plugin("edge",{initialize:function(a){a();this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height;this.uniforms["G[0]"]="sobel"===this.inputs.mode?l:g},shader:function(a,b){b.fragment=["sobel"===
a.mode?"#define N_MATRICES 2\n#define SOBEL\n":"#define N_MATRICES 9\n","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float pixelWidth;\nuniform float pixelHeight;\nuniform mat3 G[9];\nvoid main(void) {\n\tmat3 I;\n\tfloat dp3, cnv[9];\n\tvec3 tc;\n\tfloat fi = 0.0, fj = 0.0;\n\tfor (int i = 0; i < 3; i++) {\n\t\tfj = 0.0;\n\t\tfor (int j = 0; j < 3; j++) {\n\t\t\tI[i][j] = length( texture2D(source, vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)).rgb );\n\t\t\tfj += 1.0;\n\t\t};\n\t\tfi += 1.0;\n\t};\n\tfor (int i = 0; i < N_MATRICES; i++) {\n\t\tdp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n\t\tcnv[i] = dp3 * dp3;\n\t};\n#ifdef SOBEL\n\ttc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));\n#else\n\tfloat M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);\n\tfloat S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];\n\ttc = vec3(sqrt(M/S));\n#endif\n\tgl_FragColor = vec4(tc, 1.0);\n}"].join("\n");
return b},resize:function(){this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]],update:function(){this.uniforms["G[0]"]="sobel"===this.inputs.mode?l:g}}},description:"Edge Detect",title:"Edge Detect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("emboss",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 offset = 1.0 / resolution;\n\tvTexCoord1 = texCoord - offset;\n\tvTexCoord2 = texCoord + offset;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform sampler2D source;\nuniform float amount;\nconst vec3 average = vec3(1.0 / 3.0);\nvoid main (void)  {\n\tvec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);\n\tpixel -= texture2D(source, vTexCoord1) * amount;\n\tpixel += texture2D(source, vTexCoord2) * amount;\n\tpixel.rgb = vec3(dot(pixel.rgb, average));\n\tgl_FragColor = pixel;\n}";return b},inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",
defaultValue:1,min:-85,max:85}},title:"Emboss",categories:[],description:"Emboss"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("exposure",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float exposure;\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(pow(2.0, exposure) * pixel.rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:1,min:-8,max:8}},title:"Exposure",categories:["film"],description:"Exposure control"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fader",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 color;\nuniform float amount;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = mix(gl_FragColor, color, amount);\n}";
return b},requires:function(a,b){return 1>b.amount},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:0.5,min:0,max:1}},title:"Fader",description:"Fade image to a color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("falsecolor",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nuniform vec4 black;\nuniform vec4 white;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tvec4 result = mix(black, white, luminance);\n\tgl_FragColor = vec4(result.rgb, pixel.a * result.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},black:{type:"color",uniform:"black",defaultValue:[0,0,0.5,1]},white:{type:"color",uniform:"white",defaultValue:[1,0,0,1]}},title:"False Color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("filmgrain",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform float time;\nuniform float amount;\nuniform bool colored;\nfloat timer;\nconst float permTexUnit = 1.0/256.0;\nconst float permTexUnitHalf = 0.5/256.0;\nvec4 rnm(in vec2 tc) {\n\tfloat noise = sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;\n\tfloat noiseR = fract(noise)*2.0-1.0;\n\tfloat noiseG = fract(noise*1.2154)*2.0-1.0; \n\tfloat noiseB = fract(noise*1.3453)*2.0-1.0;\n\tfloat noiseA = fract(noise*1.3647)*2.0-1.0;\n\t\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\nfloat fade(in float t) {\n\treturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = permTexUnit*floor(p)+permTexUnitHalf;\n\tvec3 pf = fract(p);\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3 grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3 grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;\n\tvec3 grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3 grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\tfloat perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;\n\tvec3 grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3 grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\tfloat perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;\n\tvec3 grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3 grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\treturn n_xyz;\n}\nvoid main(void) {\n\ttimer = mod(time, 10000.0) / 10000.0;\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 noise = vec3(pnoise3D(vec3(vTexCoord * resolution, timer + 0.0)));\n\tif (colored) {\n\t\tnoise.g = pnoise3D(vec3(vTexCoord * resolution, timer + 1.0));\n\t\tnoise.b = pnoise3D(vec3(vTexCoord * resolution, timer + 2.0));\n\t}\n\tgl_FragColor = vec4(pixel.rgb + noise * amount, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.03},colored:{type:"boolean",uniform:"colored",defaultValue:!1}},title:"Film Grain",description:"Don't over-do it."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("freeze",{draw:function(a,b,d,f,k){this.inputs.frozen||k(a,b,d,f)},requires:function(){return!this.inputs.frozen},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},frozen:{type:"boolean",defaultValue:!1,updateSources:!0}},title:"Freeze",description:"Freeze Frame"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fxaa",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nconst vec2 diag = vec2(1.0, -1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tvec2 invRes = 1.0 / resolution;\n\tvTexCoordNW = texCoord - invRes;\n\tvTexCoordNE = texCoord + invRes * diag;\n\tvTexCoordSW = texCoord - invRes * diag;\n\tvTexCoordSE = texCoord + invRes;\n}\n";
b.fragment="precision mediump float;\n#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nuniform vec2 resolution;\nuniform sampler2D source;\nconst vec3 luma = vec3(0.299, 0.587, 0.114);\nvoid main(void) {\n\tvec4 original = texture2D(source, vTexCoord);\n\tvec3 rgbNW = texture2D(source, vTexCoordNW).rgb;\n\tvec3 rgbNE = texture2D(source, vTexCoordNE).rgb;\n\tvec3 rgbSW = texture2D(source, vTexCoordSW).rgb;\n\tvec3 rgbSE = texture2D(source, vTexCoordSE).rgb;\n\tfloat lumaNW = dot(rgbNW, luma);\n\tfloat lumaNE = dot(rgbNE, luma);\n\tfloat lumaSW = dot(rgbSW, luma);\n\tfloat lumaSE = dot(rgbSE, luma);\n\tfloat lumaM = dot(original.rgb, luma);\n\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * 0.25 * FXAA_REDUCE_MUL, FXAA_REDUCE_MIN);\n\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\tdir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) / resolution;\n\tvec3 rgbA = 0.5 * (\n\t\ttexture2D(source, vTexCoord + dir * (1.0 / 3.0 - 0.5)).rgb +\n\t\ttexture2D(source, vTexCoord + dir * (2.0 / 3.0 - 0.5)).rgb);\n\tvec3 rgbB = rgbA * 0.5 + 0.25 * (\n\t\ttexture2D(source, vTexCoord - dir * 0.5).rgb +\n\t\ttexture2D(source, vTexCoord + dir * 0.5).rgb);\n\tfloat lumaB = dot(rgbB, luma);\n\tif (lumaB < lumaMin || lumaB > lumaMax) {\n\t\tgl_FragColor = vec4(rgbA, original.a);\n\t} else {\n\t\tgl_FragColor = vec4(rgbB, original.a);\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"FXAA",description:"Fast approximate anti-aliasing"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("gradientwipe",function(){this.uniforms.resGradient=[1,1];this.uniforms.resSource=[1,1];return{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resGradient;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordGradient = adjusted / resGradient + HALF;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nuniform sampler2D source;\nuniform sampler2D gradient;\nuniform float transition;\nuniform float smoothness;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tfloat gradientVal = 1.0 - dot(texture2D(gradient, texCoordGradient).rgb, lumcoeff);\n\tif (invert) {\n\t\tgradientVal = 1.0 - gradientVal;\n\t}\n\tfloat amount = 1.0 - transition;\n\tfloat mn = (amount - smoothness * (1.0 - amount));\n\tfloat mx = (amount + smoothness * amount);\n\tif (gradientVal <= mn) {\n\t\tgl_FragColor = texture2D(source, texCoordSource);\n\t\treturn;\n\t}\n\tif (gradientVal >= mx) {\n\t\tgl_FragColor = vec4(0.0);\n\t\treturn;\n\t}\n\tfloat alpha = mix(1.0, 0.0, smoothstep(mn, mx, gradientVal));\n\tvec4 pixel = texture2D(source, texCoordSource);\n\tgl_FragColor = vec4(pixel.rgb, pixel.a * alpha);\n}";
return b},draw:function(a,b,d,f,k){0>=d.transition?k(this.baseShader,b,d,f):1<=d.transition?(a=this.gl,a.viewport(0,0,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,f),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):k(a,b,d,f)},inPlace:!1,requires:function(a,b){return"source"===a&&1<=b.transition||"gradient"===a&&(0>=b.transition||1<=b.transition)?!1:!0},resize:function(){var a=this.inputs.source,b=this.inputs.gradient;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=
a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resGradient[0]=b.width,this.uniforms.resGradient[1]=b.height):(this.uniforms.resGradient[0]=1,this.uniforms.resGradient[1]=1)}}},{inputs:{source:{type:"image",uniform:"source"},gradient:{type:"image",uniform:"gradient"},transition:{type:"number",uniform:"transition",defaultValue:0},invert:{type:"boolean",uniform:"invert",defaultValue:!1},smoothness:{type:"number",uniform:"smoothness",defaultValue:0,min:0,max:1}},
title:"Gradient Wipe"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hex",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 center;\nuniform float size;\nvoid main(void) {\n\tvec2 aspect = normalize(resolution);\n\tvec2 tex = (vTexCoord * aspect - center) / size;\n\ttex.y /= 0.866025404;\n\ttex.x -= tex.y * 0.5;\n\tvec2 a;\n\tif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n\t\ta = vec2(floor(tex.x), floor(tex.y));\n\t} else {\n\t\ta = vec2(ceil(tex.x), ceil(tex.y));\n\t}\n\tvec2 b = vec2(ceil(tex.x), floor(tex.y));\n\tvec2 c = vec2(floor(tex.x), ceil(tex.y));\n\tvec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n\tvec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);\n\tvec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);\n\tvec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);\n\tfloat alen =length(tex3 - a3);\n\tfloat blen =length(tex3 - b3);\n\tfloat clen =length(tex3 - c3);\n\tvec2 choice;\n\tif (alen < blen) {\n\t\tif (alen < clen) {\n\t\t\tchoice = a;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t} else {\n\t\tif (blen < clen) {\n\t\t\tchoice = b;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t}\n\tchoice.x += choice.y * 0.5;\n\tchoice.y *= 0.866025404;\n\tchoice *= size / aspect;\n\tgl_FragColor = texture2D(source, choice + center / aspect);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:0.4,defaultValue:0.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("highlights-shadows",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float shadows;\nuniform float highlights;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tfloat shadow = clamp((pow(luminance, 1.0 / (shadows + 1.0)) + (-0.76) * pow(luminance, 2.0 / (shadows + 1.0))) - luminance, 0.0, 1.0);\n\tfloat highlight = clamp((1.0 - (pow(1.0 - luminance, 1.0 / (2.0 - highlights)) + (-0.8) * pow(1.0 - luminance, 2.0 / (2.0 - highlights)))) - luminance, -1.0, 0.0);\n\tvec3 rgb = (luminance + shadow + highlight) * (pixel.rgb / vec3(luminance));\n\tgl_FragColor = vec4(rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},highlights:{type:"number",uniform:"highlights",min:0,max:1,defaultValue:1},shadows:{type:"number",uniform:"shadows",min:0,max:1,defaultValue:0}},title:"Highlights/Shadows",description:"Darken highlights, lighten shadows"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hue-saturation",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nuniform float hue;\nuniform float saturation;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nvoid main(void) {\n\tfloat angle = hue * 3.14159265358979323846264;\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tweights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nuniform sampler2D source;\nuniform float hue;\nuniform float saturation;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat len = length(color.rgb);\n\tcolor.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );\n\tvec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;\n\tif (saturation > 0.0) {\n\t\tadjustment *= (1.0 - 1.0 / (1.0 - saturation));\n\t} else {\n\t\tadjustment *= (-saturation);\n\t}\n\tcolor.rgb += adjustment;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:0.4,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("invert",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("kaleidoscope",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float segments;\nuniform float offset;","const float PI = "+Math.PI+";","const float TAU = 2.0 * PI;\nvoid main(void) {\n\tif (segments == 0.0) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t} else {\n\t\tvec2 centered = vTexCoord - 0.5;\n\t\tfloat r = length(centered);\n\t\tfloat theta = atan(centered.y, centered.x);\n\t\ttheta = mod(theta, TAU / segments);\n\t\ttheta = abs(theta - PI / segments);\n\t\tvec2 newCoords = r * vec2(cos(theta), sin(theta)) + 0.5;\n\t\tgl_FragColor = texture2D(source, mod(newCoords - offset, 1.0));\n\t}\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},segments:{type:"number",uniform:"segments",defaultValue:6},offset:{type:"number",uniform:"offset",defaultValue:0}},title:"Kaleidoscope"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c=/\d+/;b.plugin("layers",function(b){function f(){g.resize()}var k,g=this,l={clear:!1},s;"number"===typeof b&&2<=b?k=b:(k=b&&b.count||4,k=Math.max(2,k));s={sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection"],
update:function(){this.resize()}}};for(b=0;b<k;b++)s.sizeMode.options.push(b.toString()),s.sizeMode.options.push("source"+b),s["source"+b]={type:"image",update:f},s["opacity"+b]={type:"number",defaultValue:1,min:0,max:1,updateSources:!0};this.uniforms.layerResolution=[1,1];this.resize=function(){var a,b;a=this.inputs.sizeMode;var d,f;if("union"===a)for(d=b=a=0;d<k;d++){if(f=this.inputs["source"+d])a=Math.max(a,f.width),b=Math.max(b,f.height)}else if("intersection"===a)for(b=a=Infinity,d=0;d<k;d++){if(f=
this.inputs["source"+d])a=Math.min(a,f.width),b=Math.min(b,f.height)}else if(b=a=1,d=k-1,(f=c.exec(this.inputs.sizeMode))&&(d=Math.min(parseInt(f[0],10),d)),f=this.inputs["source"+d])a=f.width,b=f.height;if(this.width!==a||this.height!==b)for(this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty(),d=0;d<this.targets.length;d++)this.targets[d].resize()};return{initialize:function(a){var b=
this.gl;a();l.blendEquation=b.FUNC_ADD;l.srcRGB=b.SRC_ALPHA;l.dstRGB=b.ONE_MINUS_SRC_ALPHA;l.srcAlpha=b.SRC_ALPHA;l.dstAlpha=b.DST_ALPHA},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 layerResolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * layerResolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / layerResolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (layerResolution.x / layerResolution.y);\n\tgl_Position.xy *= layerResolution / resolution;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tif (any(lessThan(vTexCoord, vec2(0.0))) || any(greaterThanEqual(vTexCoord, vec2(1.0)))) {\n\t\tgl_FragColor = vec4(0.0);\n\t} else {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t\tgl_FragColor *= opacity;\n\t}\n}";return b},requires:function(a,b){var d,f=k;(d=c.exec(this.inputs.sizeMode))&&(f=parseInt(d[0],10));return f>=k?!1:!(!b[a]||!b["opacity"+f])},draw:function(b,
c,d,f,g){var s,x,v;s=this.gl;s.viewport(0,0,this.width,this.height);s.bindFramebuffer(s.FRAMEBUFFER,f);s.clearColor(0,0,0,0);s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);for(s=0;s<k;s++)v=this.inputs["source"+s],x=this.inputs["opacity"+s],v&&x&&(d.opacity=x,d.layerResolution[0]=v.width,d.layerResolution[1]=v.height,d.source=v,d.transform=v.cumulativeMatrix||a,g(b,c,d,f,null,l))},inputs:s}},{inPlace:!0,description:"Multiple layers",title:"Layers"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("linear-transfer",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 slope;\nuniform vec4 intercept;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = pixel * slope + intercept;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},slope:{type:"vector",dimensions:4,uniform:"slope",defaultValue:[1,1,1,1]},intercept:{type:"vector",uniform:"intercept",dimensions:4,defaultValue:[0,0,0,0]}},title:"Linear Transfer",description:"For each color channel: [slope] * [value] + [intercept]"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("lumakey",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float threshold;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luma = dot(pixel.rgb,lumcoeff);\n\tfloat alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);\n\tif (invert) alpha = 1.0 - alpha;\n\tgl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},invert:{type:"boolean",uniform:"invert",defaultValue:!1}},title:"Luma Key",categories:["key"],description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("mirror",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform vec2 resolution;\nuniform sampler2D source;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vec2(0.5 - abs(0.5 - vTexCoord.x), vTexCoord.y));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Mirror",description:"Shader Mirror Effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("nightvision",{commonShader:!0,shader:function(a,b,d){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float timer;\nuniform float luminanceThreshold;\nuniform float amplification;\nuniform vec3 nightVisionColor;",d.shader.makeNoise,
"void main(void) {\n\tvec3 noise = vec3(makeNoise(vTexCoord.x, vTexCoord.y, timer), makeNoise(vTexCoord.x, vTexCoord.y, timer * 200.0 + 1.0), makeNoise(vTexCoord.x, vTexCoord.y, timer * 100.0 + 3.0));\n\tvec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);\n\tfloat luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);\n\tpixel.rgb *= step(luminanceThreshold, luminance) * amplification;\n\tgl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);\n}"].join("\n");return b},
inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},timer:{type:"number",uniform:"timer",defaultValue:0},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:0.1,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:1.4,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[0.1,0.95,0.2]}},title:"Night Vision",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("noise",{shader:function(a,b,d){d=["precision mediump float;","#define Blend(base, blend, funcf)\t\tvec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))",
"#define BlendOverlay(base, blend)\t\tBlend(base, blend, BlendOverlayf)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float amount;","uniform float timer;",d.shader.noiseHelpers,d.shader.snoise3d,d.shader.random,"void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat r = random(vec2(timer * vTexCoord.xy));","\tfloat noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), timer)) * 0.5;"];a.overlay?(d.push("\tvec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));"),
d.push("\tpixel.rgb = mix(pixel.rgb, overlay, amount);")):d.push("\tpixel.rgb += noise * amount;");d.push("\tgl_FragColor = pixel;}");b.fragment=d.join("\n");return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},timer:{type:"number",uniform:"timer",defaultValue:0,step:1}},title:"Noise",description:"Add noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("panorama",function(){function a(){b.resize()}var b=this;this.resize=function(){var a=this.width,f=this.height,k=b.inputs.source;this.source?(a=this.source.width,f=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,f=this.sources.source.height):
f=a=1;b.inputs.width?(a=b.inputs.width,b.inputs.height?f=b.inputs.height:k&&(f=a*k.height/k.width)):b.inputs.height&&(f=b.inputs.height,k&&(a=f*k.width/k.height));a=Math.floor(a);f=Math.floor(f);k&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=f);if(this.width!==a||this.height!==f)this.width=a,this.height=f,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)this.targets[a].resize()};return{shader:function(a,
b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D source;\nuniform float fov;\nuniform float yaw;\nuniform float pitch;\nconst float M_PI = 3.141592653589793238462643;\nconst float M_TWOPI = 6.283185307179586476925286;\nmat3 rotationMatrix(vec2 euler) {\n\tvec2 se = sin(euler);\n\tvec2 ce = cos(euler);\n\treturn mat3(ce.x, 0, -se.x, 0, 1, 0, se.x, 0, ce.x) * \n\t\t\tmat3(1, 0, 0, 0, ce.y, -se.y, 0, se.y, ce.y);\n}\nvec3 toCartesian( vec2 st ) {\n\treturn normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));\n}\nvec2 toSpherical(vec3 cartesianCoord) {\n\tvec2 st = vec2(\n\t\tatan(cartesianCoord.x, cartesianCoord.z),\n\t\tacos(cartesianCoord.y)\n\t);\n\tif(st.x < 0.0)\n\t\tst.x += M_TWOPI;\n\treturn st;\n}\nvoid main(void) {\n\tvec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);\n\tsphericalCoord.y *= -resolution.y / resolution.x;\n\tvec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);\n\tgl_FragColor = texture2D(source, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360},yaw:{type:"number",uniform:"yaw",min:0,max:360,defaultValue:0},fov:{type:"number",uniform:"fov",min:0,max:180,defaultValue:80},pitch:{type:"number",uniform:"pitch",min:-90,max:90,defaultValue:0}}}},{commonShader:!0,title:"Panorama"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("pixelate",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 pixelSize;\nvoid main(void) {\n\tvec2 delta = pixelSize / resolution;\n\tgl_FragColor = texture2D(source, delta * floor(vTexCoord / delta));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},pixelSize:{type:"vector",dimensions:2,defaultValue:[8,8],min:0,uniform:"pixelSize"}},title:"Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("polar",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;","const float PI = "+Math.PI+";","void main(void) {\n\tvec2 norm = (1.0 - vTexCoord) * 2.0 - 1.0;\n\tfloat theta = mod(PI + atan(norm.x, norm.y) - angle * (PI / 180.0), PI * 2.0);\n\tvec2 polar = vec2(theta / (2.0 * PI), length(norm));\n\tgl_FragColor = texture2D(source, polar);\n}"].join("\n");
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Polar Coordinates",description:"Convert cartesian to polar coordinates"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("ripple",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float wave;\nuniform float distortion;\nuniform vec2 center;\nvoid main(void) {\n\tfloat scalar = abs(1.0 - abs(distance(vTexCoord, center)));\n\tfloat sinOffset = sin(wave / scalar);\n\tsinOffset = clamp(sinOffset, 0.0, 1.0);\n\tfloat sinSign = cos(wave / scalar);\n\tsinOffset = sinOffset * distortion / 32.0;\n\tgl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/0.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0.5,0.5]}},title:"Ripple Distortion",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("scanlines",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float lines;\nuniform float width;\nuniform float intensity;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat darken = 2.0 * abs( fract(vTexCoord.y * lines / 2.0) - 0.5);\n\tdarken = clamp(darken - width + 0.5, 0.0, 1.0);\n\tdarken = 1.0 - ((1.0 - darken) * intensity);\n\tgl_FragColor = vec4(pixel.rgb * darken, 1.0);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:0.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:0.1,min:0,max:1}},title:"Scan Lines",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=/\d+/;b.plugin("select",function(b){function d(){g.resize()}function f(){var a;a=g.inputs["source"+g.inputs.active];g.texture=a&&a.texture;d()}var k,g=this,l;"number"===typeof b&&2<=b?k=b:(k=b&&b.count||4,k=Math.max(2,k));l={active:{type:"number",step:1,min:0,max:k-1,defaultValue:0,
update:f,updateSources:!0},sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection","active"],update:d}};for(b=0;b<k;b++)l.sizeMode.options.push(b.toString()),l.sizeMode.options.push("source"+b),l["source"+b]={type:"image",update:f};this.uniforms.layerResolution=[1,1];this.resize=function(){var b,c;b=this.inputs.sizeMode;var d,f,g;if("union"===b)for(d=c=b=0;d<k;d++){if(g=this.inputs["source"+d])b=Math.max(b,g.width),c=Math.max(c,g.height)}else if("intersection"===b)for(c=b=Infinity,
d=0;d<k;d++){if(g=this.inputs["source"+d])b=Math.min(b,g.width),c=Math.min(c,g.height)}else if("active"===b)d=this.inputs.active,g=this.inputs["source"+d],b=Math.max(1,g&&g.width||1),c=Math.max(1,g&&g.height||1);else for(c=b=1,f=k-1,(d=a.exec(this.inputs.sizeMode))&&(f=Math.min(parseInt(d[0],10),f)),d=0;d<=f;d++)if(g=this.inputs["source"+d]){b=g.width;c=g.height;break}if(this.width!==b||this.height!==c)this.width=b,this.height=c,this.emit("resize"),this.setDirty();for(d=0;d<this.targets.length;d++)this.targets[d].resize()};
return{initialize:function(){this.initialized=!0;this.shaderDirty=!1},requires:function(a){return!(!this.inputs[a]||a!=="source"+this.inputs.active)},draw:function(){var a;a=g.inputs["source"+g.inputs.active];g.texture=a&&a.texture},inputs:l}},{title:"Select",description:"Select a single source image from a list of source nodes.",inPlace:!1,commonShader:!0})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sepia",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tgl_FragColor = coeff * sourcePixel;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("simplex",function(){function a(){b.resize()}var b=this;return{shader:function(a,b,c){function g(a){return 0===a-Math.floor(a)?a+".0":a}var l=1,s=1,n=0;b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform float amount;\nuniform vec2 noiseScale;\nuniform vec2 noiseOffset;\nuniform float time;\nuniform vec4 black;\nuniform vec4 white;",
c.shader.noiseHelpers,c.shader.snoise3d,"void main(void) {\n\tfloat total = 0.0;\n\tvec3 pos = vec3(vTexCoord.xy * noiseScale + noiseOffset, time);"].join("\n");for(c=0;c<a.octaves;c++)l=Math.pow(2,c),s=Math.pow(a.persistence,c),n+=s,b.fragment+="\ttotal += snoise(pos * "+g(l)+") * "+g(s)+";\n";b.fragment+=["\ttotal *= amount / "+g(n)+";","\ttotal = (total + 1.0)/ 2.0;\n\tgl_FragColor = mix(black, white, total);\n}"].join("\n");return b},inputs:{noiseScale:{type:"vector",dimensions:2,uniform:"noiseScale",
defaultValue:[1,1]},noiseOffset:{type:"vector",dimensions:2,uniform:"noiseOffset",defaultValue:[0,0]},octaves:{type:"number",shaderDirty:!0,min:1,max:8,step:1,defaultValue:1},persistence:{type:"number",defaultValue:0.5,min:0,max:0.5},amount:{type:"number",uniform:"amount",min:0,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0},width:{type:"number",min:0,step:1,update:a,defaultValue:0},height:{type:"number",min:0,step:1,update:a,defaultValue:0},black:{type:"color",uniform:"black",
defaultValue:[0,0,0,1]},white:{type:"color",uniform:"white",defaultValue:[1,1,1,1]}}}},{title:"Simplex Noise",description:"Generate Simplex Noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sketch",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nfloat res = resolution.x;\nfloat n0 = 97.0 / res;\nfloat n1 = 15.0 / res;\nfloat n2 = 97.0 / res;\nfloat n3 = 9.7 / res;\nfloat total = n2 + ( 4.0 * n0 ) + ( 4.0 * n1 );\nconst vec3 div3 = vec3(1.0 / 3.0);\nvoid main(void) {\n\tfloat offset, temp1, temp2;\n\tvec4 m, p0, p1, p2, p3, p4, p5, p6, p7, p8;\n\toffset = n3;\n\tp0=texture2D(source,vTexCoord);\n\tp1=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp2=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp3=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp4=texture2D(source,vTexCoord+vec2(-offset, offset));\n\toffset=n3*2.0;\n\tp5=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp6=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp7=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp8=texture2D(source,vTexCoord+vec2(-offset, offset));\n\tm = (p0 * n2 + (p1 + p2 + p3 + p4) * n0 + (p5 + p6 + p7 + p8) * n1) / total;\n\ttemp1 = dot(p0.rgb, div3);\n\ttemp2 = dot(m.rgb, div3);\n\tif (temp2 <= 0.0005) {\n\t\tgl_FragColor = vec4( 1.0, 1.0, 1.0, p0.a);\n\t} else {\n\t\tgl_FragColor = vec4( vec3(min(temp1 / temp2, 1.0)), p0.a);\n\t}\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Sketch",description:"Pencil/charcoal sketch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("split",function(){var a,b=[1,1],d=[1,1];this.resize=function(){var a,k;a=this.inputs.sizeMode;var g;g=this.inputs.sourceA;var l=this.inputs.sourceB;"a"===a||"b"===a?(k="a"===a?g:l)?(a=k.width,k=k.height):k=a=1:g?l?(k="union"===a?Math.max:Math.min,a=k(g.width,l.width),
k=k(g.height,l.height)):(a=g.width,k=g.height):l?(a=l.width,k=l.height):k=a=1;if(this.width!==a||this.height!==k)this.width=a,this.height=k,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=k,this.frameBuffer&&this.frameBuffer.resize(a,k),this.emit("resize"),this.setDirty();g&&(b[0]=g.width,b[1]=g.height);l&&(d[0]=l.width,d[1]=l.height);for(g=0;g<this.targets.length;g++)this.targets[g].resize()};return{initialize:function(f){f();this.uniforms.resolutionA=b;this.uniforms.resolutionB=d;a=this.baseShader},
commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform mat4 projection;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nuniform float angle;\nvarying float c;\nvarying float s;\nvarying float t;\nvoid main(void) {\n   c = cos(angle);\n   s = sin(angle);\n\tt = abs(c + s);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 adjustedTexCoord = (texCoord - 0.5) * resolution;\n\tvTexCoordA = adjustedTexCoord / resolutionA + 0.5;\n\tvTexCoordB = adjustedTexCoord / resolutionB + 0.5;\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying float c;\nvarying float s;\nvarying float t;\nuniform sampler2D sourceA;\nuniform sampler2D sourceB;\nuniform float split;\nuniform float angle;\nuniform float fuzzy;\nvec4 textureLookup(sampler2D tex, vec2 texCoord) {\n\tif (any(lessThan(texCoord, vec2(0.0))) || any(greaterThan(texCoord, vec2(1.0)))) {\n\t\treturn vec4(0.0);\n\t} else {\n\t\treturn texture2D(tex, texCoord);\n\t}\n}\nvoid main(void) {\n\tvec4 pixel1 = textureLookup(sourceA, vTexCoordA);\n\tvec4 pixel2 = textureLookup(sourceB, vTexCoordB);\n\tfloat mn = (split - fuzzy * (1.0 - split));\n\tfloat mx = (split + fuzzy * split);;\n\tvec2 coords = vTexCoord - vec2(0.5);\n\tcoords = vec2(coords.x * c - coords.y * s, coords.x * s + coords.y * c);\n\tfloat scale = max(abs(c - s), abs(s + c));\n\tcoords /= scale;\n\tcoords += vec2(0.5);\n\tfloat x = coords.x;;\n\tgl_FragColor = mix(pixel2, pixel1, smoothstep(mn, mx, x));\n}";
return b},draw:function(b,c,d,l,s){1<=d.split?(d.source=d.sourceB,s(a,c,d,l)):0>=d.split?(d.source=d.sourceA,s(a,c,d,l)):s(b,c,d,l)},inPlace:!1,requires:function(a,b){return"sourceA"===a&&1<=b.split||"sourceB"===a&&0>=b.split?!1:!0}}},{inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1,update:function(){this.resize()}},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1,update:function(){this.resize()}},sizeMode:{type:"enum",defaultValue:"a",options:["a","b","union","intersection"],
update:function(){this.resize()}},split:{type:"number",uniform:"split",defaultValue:0.5,min:0,max:1,updateSources:!0},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1}},description:"Split screen or wipe",title:"Split"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("throttle",function(){var a=0;return{draw:function(b,d,f,k,g){this.inputs.frameRate&&Date.now()-a>=1E3/this.inputs.frameRate&&(g(b,d,f,k),a=Date.now())},requires:function(b,d){return d.frameRate&&Date.now()-a>=1E3/d.frameRate?!0:!1}}},{inPlace:!0,commonShader:!0,title:"Throttle",
description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tone",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tvec3 sceneColor = light.rgb * sourcePixel.rgb;\n\tvec3 gray = vec3(dot(lumcoeff, sceneColor));\n\tvec3 muted = mix(sceneColor, gray, desat);\n\tvec3 tonedColor = mix(dark.rgb, light.rgb, gray);\n\tgl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,0.9,0.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[0.2,0.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:0.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tvglitch",function(){var a,c,d,f,k,g;return{initialize:function(c){var s,n,e,m;g=this.gl;a=this.height;m=[];n=0.3-0.02;e=0.8-0.2;for(s=0;20>s;s++)m.push(2*Math.random()-1),m.push(Math.random()*e+0.2),m.push(Math.random()*n+0.02),m.push(0.2*Math.random());d=g.createBuffer();
g.bindBuffer(g.ARRAY_BUFFER,d);g.bufferData(g.ARRAY_BUFFER,new Float32Array(m),g.STATIC_DRAW);d.itemSize=4;d.numItems=20;f=new b.util.ShaderProgram(g,"precision mediump float;\nattribute vec4 particle;\nuniform float time;\nuniform float height;\nvarying float intensity;\nvoid main(void) {\n\tfloat y = particle.x + time * particle.y;\n\ty = fract((y + 1.0) / 2.0) * 4.0 - 2.0;\n\tintensity = particle.w;\n\tgl_Position = vec4(0.0, -y , 1.0, 2.0);\n\tgl_PointSize = height * particle.z;\n}","precision mediump float;\nvarying float intensity;\nvoid main(void) {\n\tgl_FragColor = vec4(1.0);\n\tgl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));\n}");
k=new b.util.FrameBuffer(g,1,Math.max(1,this.height/2));c()},commonShader:!0,shader:function(a,c){c.fragment=["precision mediump float;\n#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D particles;\nuniform float time;\nuniform float scanlines;\nuniform float lineSync;\nuniform float lineHeight;\nuniform float distortion;\nuniform float vsync;\nuniform float bars;\nuniform float frameSharpness;\nuniform float frameShape;\nuniform float frameLimit;\nuniform vec4 frameColor;",
b.util.shader.noiseHelpers+b.util.shader.snoise2d+"void main(void) {","\tvec2 texCoord = vTexCoord;\n\tfloat drandom = snoise(vec2(time * 50.0, texCoord.y /lineHeight));\n\tfloat distortAmount = distortion * (drandom - 0.25) * 0.5;\n\tvec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));\n\tdistortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);\n\ttexCoord.x -= distortAmount;\n\ttexCoord.x = mod(texCoord.x, 1.0);\n\tfloat roll;\n\tif (vsync != 0.0) {\n\t\troll = fract(time / vsync);\n\t\ttexCoord.y = mod(texCoord.y - roll, 1.0);\n\t}\n\tvec4 pixel = texture2D(source, texCoord);\n\tfloat barsAmount = particleOffset.r;\n\tif (barsAmount > 0.0) {\n\t\tpixel = vec4(pixel.r + bars * barsAmount,pixel.g + bars * barsAmount,pixel.b + bars * barsAmount,pixel.a);\n\t}\n\tif (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {\n\t\tpixel.rgb *= (1.0 - scanlines);\n\t}\n\tfloat f = (1.0 - gl_FragCoord.x * gl_FragCoord.x) * (1.0 - gl_FragCoord.y * gl_FragCoord.y);\n\tfloat frame = clamp( frameSharpness * (pow(f, frameShape) - frameLimit), 0.0, 1.0);\n\tgl_FragColor = mix(frameColor, pixel, frame);\n}"].join("\n");
return c},resize:function(){k&&k.resize(1,Math.max(1,this.height/2))},draw:function(b,s,n,e,m){var t=c!==this.inputs.time,p;a!==this.height&&(a=this.height,t=!0);n.lineHeight=1/this.height;this.inputs.verticalSync?(p=0.2/this.inputs.verticalSync,n.vsync=p):(p=1,n.vsync=0);n.time=this.inputs.time%(1E3*p);n.distortion=Math.random()*this.inputs.distortion;t&&(this.inputs.lineSync||this.inputs.bars)&&(f.use(),g.viewport(0,0,1,this.height/2),g.bindFramebuffer(g.FRAMEBUFFER,k.frameBuffer),g.clear(g.COLOR_BUFFER_BIT|
g.DEPTH_BUFFER_BIT),g.enableVertexAttribArray(f.location.particle),g.bindBuffer(g.ARRAY_BUFFER,d),g.vertexAttribPointer(f.location.particle,d.itemSize,g.FLOAT,!1,0,0),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE),f.time.set(n.time),f.height.set(this.height),g.drawArrays(g.POINTS,0,20),c=this.inputs.time);n.particles=k.texture;m(b,s,n,e)},destroy:function(){d=null;k&&(k.destroy(),k=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",defaultValue:0},
distortion:{type:"number",defaultValue:0.1,min:0,max:1},verticalSync:{type:"number",defaultValue:0.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:0.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:0.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1},frameShape:{type:"number",uniform:"frameShape",min:0,max:2,defaultValue:0.27},frameLimit:{type:"number",uniform:"frameLimit",min:-1,max:1,defaultValue:0.34},frameSharpness:{type:"number",
uniform:"frameSharpness",min:0,max:40,defaultValue:8.4},frameColor:{type:"color",uniform:"frameColor",defaultValue:[0,0,0,1]}},title:"TV Glitch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vibrance",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat average = (color.r + color.g + color.b) / 3.0;\n\tfloat mx = max(color.r, max(color.g, color.b));\n\tfloat amt = (mx - average) * (-3.0 * amount);\n\tcolor.rgb = mix(color.rgb, vec3(mx), amt);\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:0,min:-1,max:1}},title:"Vibrance",description:"Non-peaking saturation effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vignette",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 pos = vTexCoord.xy - 0.5;\n\tfloat vignette = 1.0 - (dot(pos, pos) * amount);\n\tgl_FragColor = vec4(pixel.rgb * vignette, pixel.a);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("whitebalance",function(){function c(c,d){var e,x,v;if(k!==c||g!==d)if(k=c,g=d,x=Math.ceil(Math.log(Math.max(d,c))/s),e=Math.pow(2,x),e>m&&(x=Math.ceil(Math.log(m)/s),e=m),x++,l!==e){for(l=e;f.length>x;)f.pop().fb.destroy();
for(;f.length<x;)v=f.length,e=Math.pow(2,v),f.push({fb:new b.util.FrameBuffer(n.gl,e,e),opts:{width:e,height:e},uniforms:{level:f.length,offset:0.25/e,transform:a,projection:a,resolution:[e,e]}}),v&&(f[v-1].uniforms.source=f[v].fb.texture)}}var d,f=[],k,g,l,s=Math.log(2),n=this,e,m;return{initialize:function(a){e=this.gl;m=e.getParameter(e.MAX_TEXTURE_SIZE);this.inputs.auto&&c(this.width,this.height);a()},shader:function(a,c){var e=a.auto;e&&!d&&(d=new b.util.ShaderProgram(this.gl,c.vertex,"precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float offset;\nuniform int level;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord - vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset, -offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(-offset, offset));\n\tpixel /= 4.0;\n\tgl_FragColor = pixel;\n}"));
c.fragment=[e?"#define AUTO":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef AUTO\nuniform sampler2D whiteSource;\n#else\nuniform vec4 white;\n#endif\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n#ifdef AUTO\n\tvec4 white = texture2D(whiteSource, vTexCoord);\n#endif\n\tvec3 target = vec3(dot(white.rgb, luma));\n\tpixel.rgb = pixel.rgb * target / white.rgb;\n\tgl_FragColor = pixel;\n}"].join("\n");
return c},resize:function(){this.gl&&this.inputs.auto&&c(this.width,this.height)},draw:function(a,b,c,e,g){var k,l;if(this.inputs.auto){k=f.length-1;for(f[k].uniforms.source=c.source;0<=k;)l=f[k],g(d,b,l.uniforms,l.fb.frameBuffer,null,l.opts),k--;c.whiteSource=f[0].fb.texture}g(a,b,c,e)},destroy:function(){for(;f.length;)f.pop().destroy()},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},white:{type:"color",uniform:"white",defaultValue:[1,1,1]},auto:{type:"boolean",shaderDirty:!0,
defaultValue:!0}}}},{title:"White Balance"})});
