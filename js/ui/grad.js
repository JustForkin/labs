var GRAD={};GRAD.Create=function(t,o,s,i){if(this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.grad=null,this.pos=s.pos||[0,0],this.size=s.size||[this.canvas.width,this.canvas.height],this.grad="radial"==o?new GRAD.Radial(s.x0,s.y0,s.rad0,s.x1,s.y1,s.rad1):new GRAD.Linear(s.x0,s.y0,s.x1,s.y1),null!==i)for(var r=0;r<i.length;r++){var h=i[r];0==r&&(this.ctx.rect(this.pos[0],this.pos[1],this.size[0],this.size[1]),this.ctx.fillStyle="rgba("+h[1]+","+h[2]+","+h[3]+","+h[4]+")",this.ctx.fill()),this.grad.addColorStop(h[0],h[1],h[2],h[3],h[4]||255)}this.fill()},GRAD.Create.prototype={constructor:GRAD.Create,addColor:function(t,o,s,i,r){this.grad.addColorStop(t,o,s,i,r),this.fill()},fill:function(){this.grad.fillRect(this.ctx,this.pos[0],this.pos[1],this.size[0],this.size[1])},resize:function(){this.size=[this.canvas.width,this.canvas.height],this.fill()}},GRAD.Radial=function(t,o,s,i,r,h){this.x0=t,this.y0=o,this.x1=i,this.y1=r,this.rad0=s,this.rad1=h,this.colorStops=[]},GRAD.Radial.prototype={constructor:GRAD.Radial,addColorStop:function(t,o,s,i,r){if(!(0>t||t>1)){var h={ratio:t,r:o,g:s,b:i,a:r};if(t>=0&&1>=t)if(0==this.colorStops.length)this.colorStops.push(h);else{for(var l=0,a=!1,p=this.colorStops.length;!a&&p>l;)a=t<=this.colorStops[l].ratio,a||l++;a?t==this.colorStops[l].ratio?this.colorStops.splice(l,1,h):this.colorStops.splice(l,0,h):this.colorStops.push(h)}}},fillRect:function(t,o,s,r,h){if(0!=this.colorStops.length){var l,a,p,c,S,e,n,g,f,d,u,v,x,y,R,D,b,A,G,C,z,w,m,I,g,L,M,U,q,j=t.getImageData(o,s,r,h),k=(new Uint8Array(r*h*4),j.data),B=k.length,E=(this.x1-this.x0,this.y1-this.y0,[]),F=[],H=[],J=[],K=this.x1-this.x0,N=this.y1-this.y0,O=this.rad1-this.rad0;I=O*O-K*K-N*N;var P=2*this.rad0*(this.rad1-this.rad0),Q=this.rad0*this.rad0;if(0!=this.colorStops[0].ratio){var T={ratio:0,r:this.colorStops[0].r,g:this.colorStops[0].g,b:this.colorStops[0].b,a:this.colorStops[0].a};this.colorStops.splice(0,0,T)}if(1!=this.colorStops[this.colorStops.length-1].ratio){var T={ratio:1,r:this.colorStops[this.colorStops.length-1].r,g:this.colorStops[this.colorStops.length-1].g,b:this.colorStops[this.colorStops.length-1].b,a:this.colorStops[this.colorStops.length-1].a};this.colorStops.push(T)}for(i=0;B/4>i;i++){if(p=o+i%r,c=s+Math.floor(i/r),U=p-this.x0,q=c-this.y0,g=P+2*(U*K+q*N),L=Q-U*U-q*q,M=g*g-4*I*L,M>=0){if(S=(-g+Math.sqrt(M))/(2*I),0>S?S=0:S>1&&(S=1),1==S)z=this.colorStops.length-1;else for(z=0,w=!1;!w;)w=S<this.colorStops[z].ratio,w||z++;d=this.colorStops[z-1].r,u=this.colorStops[z-1].g,v=this.colorStops[z-1].b,D=this.colorStops[z-1].a,x=this.colorStops[z].r,y=this.colorStops[z].g,R=this.colorStops[z].b,b=this.colorStops[z].a,A=this.colorStops[z-1].ratio,G=this.colorStops[z].ratio,C=(S-A)/(G-A),e=d+(x-d)*C,n=u+(y-u)*C,g=v+(R-v)*C,f=D+(b-D)*C}else e=d,n=u,g=v,f=D;E.push(e),F.push(n),H.push(g),J.push(f)}var V,W,X,Y,Z=7/16,$=3/16,_=5/16,to=1/16,oo=B/4;for(i=0;oo>i;i++)V=i+1,X=i+r,W=X-1,Y=X+1,l=~~E[i],a=E[i]-l,E[V]+=Z*a,E[W]+=$*a,E[X]+=_*a,E[Y]+=to*a,l=~~F[i],a=F[i]-l,F[V]+=Z*a,F[W]+=$*a,F[X]+=_*a,F[Y]+=to*a,l=~~H[i],a=H[i]-l,H[V]+=Z*a,H[W]+=$*a,H[X]+=_*a,H[Y]+=to*a,l=~~J[i],a=J[i]-l,J[V]+=Z*a,J[W]+=$*a,J[X]+=_*a,J[Y]+=to*a;for(i=0;B>i;i+=4)m=i/4,k[i]=~~E[m],k[i+1]=~~F[m],k[i+2]=~~H[m],k[i+3]=~~J[m];t.putImageData(j,o,s)}}},GRAD.Linear=function(t,o,s,i){this.x0=t,this.y0=o,this.x1=s,this.y1=i,this.colorStops=[]},GRAD.Linear.prototype={constructor:GRAD.Linear,addColorStop:function(t,o,s,i,r){if(!(0>t||t>1)){var h={ratio:t,r:o,g:s,b:i,a:r};if(t>=0&&1>=t)if(0==this.colorStops.length)this.colorStops.push(h);else{for(var l=0,a=!1,p=this.colorStops.length;!a&&p>l;)a=t<=this.colorStops[l].ratio,a||l++;a?t==this.colorStops[l].ratio?this.colorStops.splice(l,1,h):this.colorStops.splice(l,0,h):this.colorStops.push(h)}}},fillRect:function(t,o,s,i,r){if(0!=this.colorStops.length){var h,l,a,p,c,S,e,n,g,f,d,u,v,x,y,R,D,b,A,G,C,z,w,m=t.getImageData(o,s,i,r),I=m.data,L=(new Uint8Array(i*r*4),I.length),M=this.x1-this.x0,U=this.y1-this.y0,q=1/(M*M+U*U),j=[],k=[],B=[],E=[];if(0!=this.colorStops[0].ratio){var F={ratio:0,r:this.colorStops[0].r,g:this.colorStops[0].g,b:this.colorStops[0].b,a:this.colorStops[0].a};this.colorStops.splice(0,0,F)}if(1!=this.colorStops[this.colorStops.length-1].ratio){var F={ratio:1,r:this.colorStops[this.colorStops.length-1].r,g:this.colorStops[this.colorStops.length-1].g,b:this.colorStops[this.colorStops.length-1].b,a:this.colorStops[this.colorStops.length-1].a};this.colorStops.push(F)}for(var H=0,J=L/4;J>H;H++){if(a=o+H%i,p=s+Math.floor(H/i),c=(M*(a-this.x0)+U*(p-this.y0))*q,0>c?c=0:c>1&&(c=1),1==c)C=this.colorStops.length-1;else for(C=0,z=!1;!z;)z=c<this.colorStops[C].ratio,z||C++;f=this.colorStops[C-1].r,d=this.colorStops[C-1].g,u=this.colorStops[C-1].b,R=this.colorStops[C-1].a,v=this.colorStops[C].r,x=this.colorStops[C].g,y=this.colorStops[C].b,D=this.colorStops[C].a,b=this.colorStops[C-1].ratio,A=this.colorStops[C].ratio,G=(c-b)/(A-b),S=f+(v-f)*G,e=d+(x-d)*G,n=u+(y-u)*G,g=R+(D-R)*G,j.push(S),k.push(e),B.push(n),E.push(g)}for(H=0,J=L/4;J>H;H++)h=~~j[H],l=j[H]-h,j[H+1]+=7/16*l,j[H-1+i]+=3/16*l,j[H+i]+=5/16*l,j[H+1+i]+=1/16*l,h=~~k[H],l=k[H]-h,k[H+1]+=7/16*l,k[H-1+i]+=3/16*l,k[H+i]+=5/16*l,k[H+1+i]+=1/16*l,h=~~B[H],l=B[H]-h,B[H+1]+=7/16*l,B[H-1+i]+=3/16*l,B[H+i]+=5/16*l,B[H+1+i]+=1/16*l,h=~~E[H],l=E[H]-h,E[H+1]+=7/16*l,E[H-1+i]+=3/16*l,E[H+i]+=5/16*l,E[H+1+i]+=1/16*l;for(H=0,J=L-4*i;J>H;H+=4)w=H/4,I[H]=~~j[w],I[H+1]=~~k[w],I[H+2]=~~B[w],I[H+3]=~~E[w];t.putImageData(m,0,0)}}};